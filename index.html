<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Point do Pastel — Sistema</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{--gold:#C8923A;--gold-light:#E8B96A;--bg:#0F0D0A;--bg2:#1A1712;--bg3:#252018;--bg4:#302A1E;--text:#F5EDD8;--text2:#B8A88A;--text3:#7A6A50;--success:#5C9E6A;--danger:#C05050;--info:#4A7FA5;--ifood:#EA1D2C;--delivery:#E8832A;--border:rgba(200,146,58,0.2);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;}
.sidebar{position:fixed;left:0;top:0;bottom:0;width:230px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;z-index:200;overflow-y:auto;transition:transform 0.3s ease;}
.sidebar.collapsed{transform:translateX(-230px);}
.logo{padding:14px 16px;border-bottom:1px solid var(--border);text-align:center;background:var(--bg3);position:relative;}
.logo img{width:150px;height:auto;object-fit:contain;}
.nav{flex:1;padding:10px 8px;display:flex;flex-direction:column;gap:2px;}
.nav-btn{display:flex;align-items:center;gap:9px;padding:9px 12px;border-radius:8px;background:none;border:none;cursor:pointer;color:var(--text2);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;transition:all 0.2s;text-align:left;width:100%;}
.nav-btn:hover{background:var(--bg3);color:var(--text);}
.nav-btn.active{background:linear-gradient(135deg,rgba(200,146,58,0.2),rgba(200,146,58,0.08));color:var(--gold);border:1px solid var(--border);}
.nav-btn .icon{font-size:15px;width:18px;text-align:center;}
.nav-section{font-size:10px;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;padding:10px 12px 3px;margin-top:4px;}
.main{margin-left:230px;padding:26px;min-height:100vh;transition:margin-left 0.3s ease;}
.main.full{margin-left:0;}
/* Botão hambúrguer fixo */
.menu-toggle{position:fixed;top:12px;left:12px;z-index:300;background:var(--bg2);border:1px solid var(--border);border-radius:8px;width:38px;height:38px;display:none;align-items:center;justify-content:center;cursor:pointer;font-size:18px;color:var(--gold);}
/* Overlay escuro atrás do menu no mobile */
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:150;}
.sidebar-overlay.open{display:block;}
/* Mobile */
@media(max-width:768px){
  .menu-toggle{display:flex;}
  .sidebar{transform:translateX(-230px);}
  .sidebar.open{transform:translateX(0);}
  .main{margin-left:0;padding:14px 12px;padding-top:58px;}
  .main.full{margin-left:0;}
  .pdv-grid{grid-template-columns:1fr;}
  .two-col{grid-template-columns:1fr;}
  .cards-grid{grid-template-columns:repeat(2,1fr);}
}
.page{display:none;}.page.active{display:block;}
.page-header{margin-bottom:22px;}
.page-header h2{font-family:'Playfair Display',serif;font-size:26px;}
.page-header p{color:var(--text3);font-size:13px;margin-top:3px;}
.header-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;}
.cards-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(165px,1fr));gap:12px;margin-bottom:22px;}
.stat-card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px;position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;top:0;right:0;width:45px;height:45px;border-radius:0 12px 0 45px;}
.stat-card.gold::before{background:rgba(200,146,58,0.12);}.stat-card.green::before{background:rgba(92,158,106,0.12);}.stat-card.red::before{background:rgba(192,80,80,0.12);}.stat-card.blue::before{background:rgba(74,127,165,0.12);}.stat-card.ifood::before{background:rgba(234,29,44,0.12);}
.stat-label{font-size:10px;color:var(--text3);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px;}
.stat-value{font-family:'Playfair Display',serif;font-size:22px;}
.stat-value.gold{color:var(--gold);}.stat-value.green{color:var(--success);}.stat-value.red{color:var(--danger);}.stat-value.ifood{color:var(--ifood);}
.stat-sub{font-size:11px;color:var(--text3);margin-top:3px;}
.table-wrap{background:var(--bg2);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
table{width:100%;border-collapse:collapse;}
thead tr{background:var(--bg3);}
th{padding:10px 14px;font-size:10px;color:var(--text3);letter-spacing:1px;text-transform:uppercase;text-align:left;font-weight:500;}
td{padding:10px 14px;font-size:13px;color:var(--text);border-top:1px solid rgba(200,146,58,0.07);vertical-align:middle;}
tr:hover td{background:rgba(200,146,58,0.03);}
.badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;}
.badge-gold{background:rgba(200,146,58,0.15);color:var(--gold);}.badge-green{background:rgba(92,158,106,0.15);color:var(--success);}.badge-red{background:rgba(192,80,80,0.15);color:var(--danger);}.badge-blue{background:rgba(74,127,165,0.15);color:var(--info);}.badge-ifood{background:rgba(234,29,44,0.15);color:var(--ifood);}.badge-delivery{background:rgba(232,131,42,0.15);color:var(--delivery);}
.btn{padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px;}
.btn-primary{background:var(--gold);color:#0F0D0A;}.btn-primary:hover{background:var(--gold-light);}
.btn-outline{background:none;border:1px solid var(--border);color:var(--text2);}.btn-outline:hover{border-color:var(--gold);color:var(--gold);}
.btn-danger{background:rgba(192,80,80,0.15);border:1px solid rgba(192,80,80,0.3);color:var(--danger);}
.btn-sm{padding:4px 10px;font-size:12px;}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-group label{font-size:11px;color:var(--text3);letter-spacing:0.5px;}
.form-group input,.form-group select,.form-group textarea{background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:9px 11px;border-radius:8px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none;transition:border 0.2s;}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--gold);}
.form-group select option{background:var(--bg3);}
.form-group textarea{resize:vertical;min-height:55px;}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.78);z-index:1000;align-items:center;justify-content:center;padding:16px;}
.modal-overlay.open{display:flex;}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:24px;width:100%;max-width:580px;max-height:92vh;overflow-y:auto;}
.modal h3{font-family:'Playfair Display',serif;font-size:19px;margin-bottom:16px;}
.modal-footer{display:flex;gap:10px;justify-content:flex-end;margin-top:18px;}
.tabs{display:flex;gap:3px;background:var(--bg3);padding:4px;border-radius:10px;margin-bottom:16px;flex-wrap:wrap;}
.tab-btn{flex:1;padding:7px 4px;border:none;background:none;cursor:pointer;border-radius:7px;color:var(--text3);font-family:'DM Sans',sans-serif;font-size:11px;font-weight:500;transition:all 0.2s;min-width:55px;}
.tab-btn.active{background:var(--bg4);color:var(--gold);box-shadow:0 1px 3px rgba(0,0,0,0.3);}
.search-bar{display:flex;gap:10px;margin-bottom:16px;align-items:center;}
.search-input{flex:1;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:9px 13px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;}
.search-input:focus{border-color:var(--gold);}
.stock-bar{height:4px;background:var(--bg4);border-radius:2px;margin-top:4px;overflow:hidden;}
.stock-fill{height:100%;border-radius:2px;}
.chart-bar-container{display:flex;flex-direction:column;gap:8px;}
.chart-bar-row{display:flex;align-items:center;gap:10px;}
.chart-bar-label{width:155px;font-size:12px;color:var(--text2);text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex-shrink:0;}
.chart-bar-track{flex:1;height:18px;background:var(--bg4);border-radius:4px;overflow:hidden;}
.chart-bar-fill{height:100%;border-radius:4px;display:flex;align-items:center;padding-left:7px;font-size:11px;font-weight:600;min-width:30px;}
.chart-bar-val{width:68px;font-size:12px;color:var(--text2);text-align:right;flex-shrink:0;}
.caixa-header{background:linear-gradient(135deg,rgba(200,146,58,0.15),rgba(200,146,58,0.05));border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:18px;display:flex;justify-content:space-between;align-items:center;}
.caixa-valor{font-family:'Playfair Display',serif;font-size:36px;color:var(--gold);}
.notif{position:fixed;top:20px;right:20px;background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:12px 18px;z-index:9999;font-size:13px;display:none;align-items:center;gap:10px;box-shadow:0 4px 20px rgba(0,0,0,0.4);max-width:320px;}
.notif.show{display:flex;animation:slideIn 0.3s ease;}.notif.success{border-color:rgba(92,158,106,0.4);}.notif.error{border-color:rgba(192,80,80,0.4);}
@keyframes slideIn{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}
/* PDV */
.pdv-grid{display:grid;grid-template-columns:1fr 360px;gap:16px;}
.pdv-products{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px;}
.pdv-cart{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px;display:flex;flex-direction:column;max-height:calc(100vh - 115px);overflow-y:auto;}
.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(108px,1fr));gap:7px;max-height:450px;overflow-y:auto;padding-right:2px;}
.product-card{background:var(--bg3);border:1px solid var(--border);border-radius:9px;padding:9px 7px;cursor:pointer;transition:all 0.2s;text-align:center;}
.product-card:hover{border-color:var(--gold);transform:translateY(-1px);}
.product-card:active{transform:scale(0.97);}
.product-card .pname{font-size:11px;color:var(--text);margin-bottom:4px;font-weight:500;line-height:1.3;min-height:28px;display:flex;align-items:center;justify-content:center;}
.product-card .pprice{font-size:13px;color:var(--gold);font-weight:600;}
.cart-items{flex:1;overflow-y:auto;min-height:80px;max-height:320px;margin-bottom:6px;border:1px solid var(--border);border-radius:8px;padding:4px 6px;background:var(--bg3);}
.cart-item{display:flex;align-items:flex-start;gap:6px;padding:7px 4px;border-bottom:1px solid rgba(200,146,58,0.1);}
.cart-item-info{flex:1;min-width:0;}
.cart-item-name{font-size:12px;color:var(--text);line-height:1.3;font-weight:500;}
.cart-item-detail{font-size:10px;color:var(--text3);margin-top:2px;line-height:1.4;}
.cart-item-qty{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-top:1px;}
.qty-btn{width:22px;height:22px;border-radius:50%;background:var(--bg4);border:1px solid var(--border);color:var(--text);cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;transition:all 0.15s;line-height:1;flex-shrink:0;}
.qty-btn:hover{background:var(--gold);color:#0F0D0A;border-color:var(--gold);}
.qty-btn.remove-btn{background:rgba(192,80,80,0.1);border-color:rgba(192,80,80,0.3);color:var(--danger);}
.qty-btn.remove-btn:hover{background:var(--danger);color:#fff;border-color:var(--danger);}
.cart-item-price{font-size:12px;color:var(--gold);min-width:52px;text-align:right;flex-shrink:0;font-weight:600;}
.cart-total{border-top:1px solid var(--border);padding-top:10px;}
.cart-total-row{display:flex;justify-content:space-between;font-size:13px;color:var(--text2);margin-bottom:5px;}
.cart-total-row.main{color:var(--text);font-size:15px;font-weight:700;}
.channel-selector{display:grid;grid-template-columns:1fr 1fr 1fr;gap:7px;margin-bottom:10px;}
.channel-btn{padding:9px 4px;border-radius:8px;border:1px solid var(--border);background:var(--bg3);cursor:pointer;text-align:center;transition:all 0.2s;font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;color:var(--text2);}
.channel-btn:hover{border-color:var(--gold);}
.channel-btn.active-balcao{border-color:var(--gold);background:rgba(200,146,58,0.1);color:var(--gold);}
.channel-btn.active-delivery{border-color:var(--delivery);background:rgba(232,131,42,0.1);color:var(--delivery);}
.channel-btn.active-ifood{border-color:var(--ifood);background:rgba(234,29,44,0.1);color:var(--ifood);}
.delivery-fields{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:11px;margin-bottom:8px;}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
.section-title{font-size:13px;font-weight:600;color:var(--text2);margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border);}
.empty-state{text-align:center;padding:28px;color:var(--text3);font-size:13px;}
.client-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:10px;}
.client-card{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:14px;cursor:pointer;transition:all 0.2s;}
.client-card:hover{border-color:var(--gold);}
.client-name{font-size:14px;font-weight:600;margin-bottom:4px;}
.client-info{font-size:12px;color:var(--text3);margin-bottom:2px;}
.config-section{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:14px;}
.config-section h3{font-size:15px;font-weight:600;margin-bottom:14px;}
/* Caixa status */
.caixa-tabs{display:flex;gap:8px;margin-bottom:14px;}
.caixa-tab{padding:7px 16px;border-radius:8px;border:1px solid var(--border);background:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;color:var(--text2);transition:all 0.2s;}
.caixa-tab.active{background:var(--gold);color:#0F0D0A;border-color:var(--gold);}
/* ADICIONAIS badge no carrinho */
.adicional-tag{display:inline-block;background:rgba(200,146,58,0.1);border:1px solid rgba(200,146,58,0.2);border-radius:4px;padding:1px 5px;font-size:10px;color:var(--gold);margin:1px 2px 1px 0;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
@media(max-width:1050px){.pdv-grid{grid-template-columns:1fr;}.two-col{grid-template-columns:1fr;}}
</style>
</head>
<body>
<button class="menu-toggle" id="menu-toggle" onclick="toggleSidebar()" aria-label="Menu">☰</button>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
<nav class="sidebar" id="sidebar">
  <div class="logo"><button onclick="closeSidebar()" style="position:absolute;top:8px;right:8px;background:none;border:none;color:var(--text3);font-size:18px;cursor:pointer;display:none;" id="sidebar-close">✕</button><img src="data:image/webp;base64,UklGRoJoAABXRUJQVlA4WAoAAAAIAAAApwIAfQEAVlA4IDpoAACwTgGdASqoAn4BPkUgjkSioiGUGa0YKAREsTd+PkzkcgE/f1f7Z2yGlfJ/3j9tv8T+4Py0cP9MnhD7J/gv8R/b/2r+WHY51N/w/uG+A3y/9d/1X97/dr/A//////dj/Pf7n82Pk7+g/+L/mP3S+gL+Rfz//P/3n/S/+f/Ef/////Vv/x/9R7p/3M/6XsD/pP9z/6v+H/fz5f/9B/6v9d7rv7j/pf+n/lv8h/8/oC/pP90/6H59fGz7Hf7pf/b3C/6N/nv/j65//0/3H/O///0uf1D/b//b/Tf8P///Q//RP8X/4/z////0Af/T2wv4B/8+r36r/470z9+v4b+3f4//o/43tYPVP7Z+3/Js9X/vfNH+O/bz9f/ef3Y/NT7sfzP/Z/y/iv8lP9v1Bfx/+f/5T+8fuZ/hv3l92XZdXB/4HqC+6/1X/gf3z8ffh/+S/6X+S9Uv3j/L/+L3AP11/4n3De2l4Wv5X/dftJ8AX8x/u//L/xH+h9xX/r/1/+3/d33T/Tv/q/0/+u+RX+ef23/rf4z21v//7o/3Q///uuftP/+yukG/cwu8Nid8lLfWmF3hsTvkpb60wu8NidST3Lauvkpb60wu8NfVRJovzkKB0iT7hKmKDDva4IjIfm8eR/assCESMbhvEt9aYXeGxJRbGKJWJb60wu8LnNy52rYpl8JJ4sepxbJbmwovRfAxTfdFqbeY2tMLvDYnfH1WxiiViW+tMLvC67ZlquK1py6ku/n/yJAAqgTZLZWfdCDnUcS31phd4a9rusS31phd4bE7yvixAPds0DfzxvPJoBfG/pCrt695l4bG5TC7w2J3q/fJKxLfWmF3hgYf4CXv9L9KuuY9NKqAGQcNuNlpNFqXzF/4a3Rz44AxibFhsTvkpbiLKF3hsTvkmdgmX956OLoY4LhOtaPhhS7rj4/070mju7fJxOMZhI9dGpXECxEDLfeGxO9X75JWJb60v2Fvrkaypav9rKoR/M9L7AYKGkQq5oaaxkWqfS6MK4vp4SWsjAW8QvsMeNZntswOj0hblDJNaoWGxO+SlvmTLXeGxO+NNM0hsM//6dHbtmwS7Sd1aTbIzuNFaIw4al5s2BBOQ1Cg1vwLObjp7UYTvWBxqxmlfCAYZNq33hsTvj6rYxRKxLaEapN3B46a25tU3Evq97YqLdETPaNAgi1DLd2OOfRj5MMyYuApgyqsHsE6OrgPFxr8j0Uzueh4xkCVbEqtT5P7Oj/7CR3hsTvVzS5Ay32DKJRzipwNmhTg/4GjqI7gPn0b+7JJC7+Humr+qgoc2v5qWw4C9PZGMXBtZ3HBkGP5iMZbbMlh9wKej8uvTFDBXNEvMy33hr3FCO8NiORhtrZNnLVWO7OrgQt4WPvKAvVc4bduWtBj4CR/vPuVn6nQtYOkKiy1TmXbLjIaPF1uWB9zk1BIHGPRhIgGPqlVFidXOYCIGWMhF353J+1YMnLkkd3Mo0GmfHH63pqHUVJq9XDdu0nSFDrGIALS7Btq5ameybRhcbBbvh00wUfVeRgxu8e/tBq6WUUAKF0JVZJqZBWxHCg4pVtCSsS3zLiriW+re4qLF7pgUF/hh/WGP/0PJfpzeENcBXpFbpJuoSuROw77IPl5nTaNjhw23/kt1skTdhqr24ke57caRRr14SL5X9mgDhBXFYQC+N+Kn4jiks0H82HKaf3mAmJG9PA2U4wuUHteeH+/sHUG3rxY1C9Rlmr4/8nuPmd3H4KOxXu7dfIBNf/gvqK9KCW5BvIRIaGU+PIR/gVoHQGtAC0EiBftUcGTrUj7NzXli5gKNVSyxML37FhPkBZqXcGE5w0RfBQEptLVakFmeb4I40f/zYqZNxtDvZU2y7BHegFtZPwszDJBpexWSqKD67dFWjQ3MTCWPuflyECQ78e4IQ9v/xLx+wtO2A+vAr1alYH9ZjsqmAffeOce7FzNG7YBYXs86w6d6v3ySEwy4v8rLz6SdYTEwssuiIQWVNTFxrmRF5c9Tm54FaRvQuz006KHdjG09jBeW+n5w4k5rePZ1SEUto37hx6dWPcZVOzjkB+QmgatKKJ7QP7ybBWSgm/+VY7ms1ldsSC+9kwmt1UofGe6gb7uT3+I8x9e/BmyoLrBfwmla/h3zKjG5kYbNh0g09q2giFsMCs4em1eVK/9xx2XEjxiFr9d0I+mqni0tlPjvHdQo2vnQhXu7demhF62lZrLbeXhF6JUIoKI6JbJz/N4dNuq7jFx1O8/PXzIQt7dOb//xxxeTzCrXDC/UiZTbhQRCl4IIptm6Qbfabe2V/9BDpOHUMvvJWaSfAen2uhZmGzW/IxJ/jesyQGFu487tcMdaQJ9dn6yCsLCLMHYROHYCzKrVHryxdSbeEBnTfQQa0tCBgAJhgl3042OVhzv61qQG8nMx3BFNGKWpSJmbh+quoNtFU2AF5ZMRHjyW0cNCHGEEHDmaKpBrX0N7VYqihReMcSo6XJYSvIXmqvGqg8RYkGweV4tQaooJ3QHo8TDHAkqY2oS3OfVqK73lP8/12nwEctdjvzKFx5niwQvSheg9u8kheR3JN5ovAdxPwkjENOR6BBs00za3JFR82gszTwkz/s/OR1A4WhqA02dJgGmq9xiHhLo0T6Q/IlU4cIQg/ScOcY0XN7qldB9TgRfj5UrKooVw+dRF2GZuOJPvT2a48UnU5aBhGYqXWw8BZDDR88nxi+6JFLGdJJ9qnm56YPVNLh5X/VgmK/zbudFtIobtniqJa/lMQ4eHtM4Zv2yMB9byqHoa6/yPlf/nbAx86FL4Af8sPsdws74h453apKL+AIN0DVwaSbAYoKcBFAo/ySq1YGWJ+ogEFChQ6PA41iXQtOTVYwGAx2wpGK/h2Hezd0ndKGDBVUynfGn/hpExMQTNkhJ/uQa6TtMhuF1WOv1L0yJGjmHrPMMMzCmlfAn8MrqqiAl88fhu/gab+dBqulci9vAJI6YpsoXFbD/Hw3nDHLvvcFtSs/Huols0jkYKHYUSoTmCddrKgKzsg/96Wu5uLID7CSq0N9LbJ/DhejWlnsfTMClbvr15ba6l8vGz9e11qtumJbpYgHPVifGhfmSXS6fQH/65CK/F2R2dWiJyuZj4neG8XNXBaUAZt+4f60MY7oNbdXaDc3y7epWoy7/fxRFtdW164t7cORcOJXJB7HtfKXIh/tyN0ixKLE8hOuZMzQacy6ahoKd+c9iQFYWB3b924F92Jiocj8kWiSmzvSH7eZ3KF2WjyQBSKys9XSV7pbU+ssN00iMv13v+MiCH1dVXvhfAqxJu/l9s+8JfPenp97LmAzH6lprUaj/yp/jbg1ZkLXUlYItt4KuvyDD2aMNpwxBG7Fy9pMrjNySnNpfjb/84g5uXdMRpZ1PsnOGrQX7q463XaZ3f965wm15nPjeMCpp3Op1ijXxuWnzXd7u3Xx3/ANJKyg+1Oluvlg8roPQ2uYpjNc6fZuxRpQYmc8fKnYxSd8vFch0o/HvDezYugLyaMlAJZ42SxKPuLwROfLqJxnLvYQH+0WG5iiVWq2MUSHCxZV57FYu7U2krEt9aYXeGxO+Sl5uSuneGMmAAP7w2LnftdjKn6oAAAABXi3XPw6CvN1gnkAAp7Oz4taXKN1xKQ2N97XPH+Dfq0nXQx1j2L23CenmDKIyDT6f5++O08qnD32XoG/FaJ7PuRQKSAoxGDC5k6XhN8lf/vTPeOS46xlZDQICTHZEVXZZDEDAzJ3X5fkeS99OT0jxoFTRgNGlNRPpO7cc+Z2IxMLATSLPwV3LF1b14SqfaOe6cL2urQ6/novB924EiHMFx8019Acki3ACzZgcRvUixO347oQC07u62IRxMFVD/P3KKteYLDKpaPDrYpZZuHqZl8k9iVC5tdMj+IdmhDivUkVhZv6N76Rc7g1wcpcRxOjWy4DFb1VayJjZXYBuyIvCC9dC0UblcUBg6sSpgLx0mOMGoucCkPxAzODAInfkt3X8iV1/Z/F2zH7d5IkjZLbLPZaPvcJAolfchUNdRiBau2evlikc2/U3JsRZk7dCL+GOilE5rEWxL1+qsNWZa9EOFGIrWyhqhZg3duIO7s31yAIA6r4oGwHZKIr9XjF9JUYSvAb6MQrB5Cz9yWr5ilTh8v297DzqUcuIRjM3/z4K9A3xl8DLsO5myJQNKIUsKU96+bW22ylAIQea8+E284w3VjiaOwBQnwONzeTMmWQEzjUGDIQAETXqH/2lAwtzIjKdCcVt1EC02NBlOIQ64+x303HvOarBWA4d/9qf/57+MxWKIrq3LxXTEdMyQkqoS4+1RCH65BHg3Y/GBdOwAplkgEaDu3TNictRZ2jAaIqcAQoQxks1PHzqsTcxnmkvg7wugWTJAgaQSyuiUBufGHRG9mOianzQ+m8yzde5axGIBbB/MuDzajjcil9KCrU2nxxe0k22NAz5uhQ0HXNM2VvtEfMYst9Ikyiz3JLmpYBYlWcmPcdd1UYtSvtn+yYC/5Cwcw2GKcE83KmGb3q7PSACqT1bc/RQUjcEYzGX5celCFJOP/VvtHV0N8nsY0u1iyjPtOYKJZW4LC/LbVfAjFpHI057HSgodVhDiTKe+f5mN0r/QAAWx43/gAHa9Zihd7j7qwnFwUP/bNDV9EAgJqwePpUZ225O8gRu4pobgLEkaN6tBYFoGxKfdf3Xd9ODVgShtRkc1C1ODSgcbUMO2TQ0DP9RFYavsUor5loDW17JlFyFklyH8o0G87kxoNfhr4zoIsXPRzChnLPUYIi9ItFW6lWQlgTBmMDzVfAmkyEa04Q6vs3AOt6lVoVTf4FsUbKPd3XoQGpgrrBvIChx6J4muXCSAIw7s11MdeQpRMwePg7i5vh6iT5mfMRQQ3q660MbWGTFHQCQHIsO7slrFdKJ3F6CWs9wgoZy4821TJxy0D/BWp55CWhy09O5biA2r3KZAD+QnHMmADlnnbDe3XGDDTBm24Zd2UTZDWZotptv6oVmApH4HsRbO4B4oy8dKJKBcIHDBXycc+J1XWuXAInGlrVgZytaHEepS7yugZzAZPHNPhDShpy9pr0ETAlCn910fVwJz1tHn2A2fj/A8SF65JP/LwrYvK0p54wtJrcQFAHP5wW2iAO18j+4f+oSfNhDFFsztIsJl8Dmne90BaMUgE7O0VDeZNwIduoUO5k84Ri5oMkdtWE3gPFs4Za4V7ZJfRoI4SM+7GKJfvstsvfFy2P8yPIN3a50GO4bbOIAYjiZxwPVxGKYh5P5IW+CXDmjVVDNDWlG8HS/5ezQX4Sa5HyMxb0rHUPyJvqJFmb0A3exZHXqdlhtLzbnMQ0B1rl0cTRkf1KlCkqmnq/+u2vqg6JRqqR4+mL/dysIMS/6Sl+DnVJtkS4ApiyUiUpTArNRcKt4kjjL7SPIq/7KmkuL1NyWgh2sQ9wv4SoxYV5khImOANEORo8Q+BUqHStymtExpfCJWS3z2+UeliTKm9yAV3TLBXR8ljDmCggRhMahjuByxzse47ZA0NBdqLpypN6yd+apdXkXkqNtMUBXx6rZF1tSECOicOI6VcAduwLniNgu1COSt5XcqH5Rv3zojtzc5hfi619ft3izkgREXzrpVOR4OiuwLbxWDbCUY1DRsxqwYwDTIZ0ZsTgcdt5/Zd4byAzeaq8HILJ7CPpOeUN49VyoafCZLTID15MQXblNK2i/IMYeK78Csq4wlEWfME68nKJqqvxNe1telKXSR9NxkAQ3zE/HgmWl4J+jFsL/7w1wudBpcmS3nrCm9ezWNg2PMHnHYGLBQgBCkJxzJgTAxKDar4ux55FLXtuxMzbJ99kXHWgHv130oevav1Ugzyh8WlFCfPXHhnwZQPAngcoSZvnOb+SSDmou7Ia/hrFQe7WyaX8bDGkA5JcmCRtvfKju6gyX5fcncTvun/9tsYlt4Qd7/5mPgghbhTCTKaCIg+qT93YZpx3ikp5zajbBKl8XgZZk9mtWL9pGDUNAqqKTYmot0GI6wDkL96x3h9mlei8emvnIQObaM5YUKL0KncB5YK6UHtFsozfWlJEJil7OdStHCK54oalJP0g1bV6pzqXmxOXoboE1QFYF6ZSrVPu2/RMBLw0kC9fOI97+LpmKbZABEde7C8tU9Q9HGiwGeFGMB24Nno+uy8Vtk6CGknTI/f6owvdSlrgOQ+Y22E6yqG0o6ukoW7xe/m3+1G3Sle08PGwMPRNZfxX9jY6tpu1EPTTcCwHqBL2VG7h4gIBOk2bY63rT/Myuoa7AOOKqSmm/zJ3pqP8VdFKngcmOr1T6mQukMk8ThAtUrsZHDxxPsrgilkrGQCNxiUVZRaZ/rvnztOWiToMYi5sEzx3exBfpURQeb5M6RcosNf5hDlXmTVg41mhvXLZ8eyF//EmafVAAmjDmTAGK9+jbU6bov/dcFcIXkcfjGKPx9IeLBLwPfch/4fEJu8awyqlEsIYTvp+Lhrbhjq+kyPLCd9V17dATgv5TfC12UpIOIrxmNTMy+BC678Eiv/Vzme3fWJplfphrSXe/NulYOTwy8oLMw4CySQKEW4GyplqDCMd1NpLwcz523FKIjj2oiz4+T0UAbFYV4QDwUBLEHiooCQ8mSQJcsyDBmUukKj4Rhk6Tfr8l95U84e4RKJw+58vq/+y1i14A4klkAra1O6r1Dv4WlNbzimscoQwa3OaGf/o/NhFKfaPROYggEx+DxDnEaQS9mpHYpUjRpqcp+abSZ3Ul+/JCr8NHrUGIAaE6o/oB0ugR6bE0ZmJ4EgcYjMSvGimMagdQWkQyeZKu5bma4PT3Rivu0r+UWxtmK6rNG047Doy5JUc41HvwqEU++lOkPTLctSCj6tmHb+Wad3kglr1ysewpG0s1AMK3BGM3bCnOoqQVc86HbJOHyqALeyLS/8HKQeNAdl9mYfPs++gh9iMqJy3FQuPsOcciyKmLEXKe2HIxGfRQNNSEFJdUyORmTSclkHznSoX/Drfl3LbTYqdHnwWy6sTfZICWGL4I5OpLgTv0hrYWqTCKfE5BsS7Gchl3bxFrUC7yknj1Kn6B8RdvSpgrBYUqooTHOpLpRrPSMLLW18WkB7a3ZF+SmkJS0mOhs5QmLEEBtHnmf4BO9ffQCtqz/FhgbV73HjRle1WDoFkCh54dOBxbReWerQ4rjx3+kkLF90zQIGWld30XzqluNrTsfc0hw7TRLRJQXQ6RqjUxrPRXJBE9Ps/6tIbAqtCTTUWPRdEAGjA7UTj6lcWI55Q0UgNcIEtVS2sPyEdaj6Ryzf2+qtOGdgVnGtNT7b190RXoKlH4hGiCStdnofJsc+4OjbROKeW/brJbQsVnkENzxRv73Vjt1Nwrf+qbCb3qg/P0OaSz6JA0PY3SJBz4pEhgTz/kFMtzXF8GkBZMbeBiugpC7DoI1NdDYu0RO+pyyuR8Mh1taMaRv1m86aPxzAvtmq09cDuhfTHzlU8+5PRXaBSrLLzmponEO1XW21LWgMiAAIsK29MiY2U7j1zNIZ+OzlSxgqvpZXSgNOJXnr0IIwK/a7EKSi1ttFJ8qqJDZzF+Cx5ZE989YwT2eFM9lcwmEfQfj4cCxaNME9HOiL8FjMAS8whNq0ICH6T92IQYCjXOODu/1SWV0AdiK2WkvRfhXvQ+6rnCGVV/5c+tKybohhhGCpBl9YCS4bzCqXPuNfIEHVZGY+yuBZEdwUJS2UJk0YRYOalBjfRVHjDzsJzRc1emLr8LoKf5doxCHMPXob9icdF2SGK4KsHJV2E7OZNxItTMHKkEt6rPstODXCJYF4zL+3mgfci77+ayNxCh2cptoclfyTih19DpGqlpCS5uTfSPRBQ+JbRRYTDXJbncDijXQX3UN4lRnyQ0g4MO6sfWk+zY27UtrWBjORTaa1se2j6YCxOFqQsgtUcWeA7Noy6Ir4irDyaEkY6mTCbK0EdvpCsGCe7EvFSbg/oIhx494Te1tqXnrM9urbujVyr5acJJ5E5c3GqvCPI6opvvJIFHBZsZMw2OmaiMVdz9MoIE8D/pwDoK9DzsuVAk4p7OT/PyNgN/qwddWfqra7c9Fk2mS8/YCFZQGXUdBz+a7wtBOhL+ccz4wPahnvre8KQiq4S1fohwLUEsc04+d2j3vdJoIoq0Csu0xY0XE8Pa4Zcolg3oWAOGChyiWN/wwUQKKW+yIVIXc7RBEdh2FD3+zDMgBVcFt37S3vcc6NV4vMRL2RJpvPQBI7twxjWezN6ll3bD4NxIZ/HFQzXKG5h25g5ZhGHhxqLz8yz/JEByApcVhKdhDOXuIG7nF6eR6Vf6EGpchfFLSptkYlw5Z5dOdgKob28kAmgYzVHs4JrBpIFWLQkOEItFaPAeKoqdrnOHcNAaMzcPAn2Qur/N2OTv9aE+/YEPYPzxt1FfvxQ7eLgZ/pHTRi6nenrH6nfrTb1OcGyguT/3ZeE3yPkn/D6GWlLHhEMqMkumNi9lInZcuqFeAGgVTQXwaTgQsT4T5o7xlhnXRZqpAPDXnqi4EQhaZPxnB+83twZniAz4LurNtZVzF+98kike3mgUW6/UBrajAAIA9tYYubxF4S6FvO6z8sj0C8+8rHPsoPEd7UgAAVEwBwKO+V5enjpAW7raWC8ofRMh0owaAAAb/Ist4dCwH+28atBImK/HNWSiDDEm5UTZoRu61iY7vixVxpzOrGk4SDyPm+IBbAJkQSIlPDcbB8tkv20Fad5VfmRRcwLxnKGDWGbZ0+OlJqCTevwe3PAJhLMctS71St6xJbCxd4wQgkwlfFqXLEAyxFDN/qNXG6wZxxOTPjzU1I3+DjXXSUOG1/MnwHesgfgn7yrO+nbo2xZlLZZWtnTtgOXvn90WK2+mi5mLRKhqa1Xp/UOpLA7yh+QtGJVVPyshxQSMMqhs6BBQ3Kh+kC/GAvmKXBspDNOjyySmPhoeuDDghRpN2S3KSyAmuOfiW3ash55skrKG5tmr9/3WdcwGR9AFi9+AZB1ctIQABH8TgElMd109S72yhIgREKtq3lgl2VfkeDg3tenpd4fJvOc0ge0YlZvJbR0CGFlO+V5vfQQtWhzFR1c8XiljCMiaqiAnkhAvBioXCWdvN+5t4JSQBdrPN7unGTl3SSWqFUnIaEZaBMeXGBLKuAtvkaLclOF6lJXWoWoKpbTt+jFLnxOX72q2JKxnOnKZ1x6lwokjJqz5lHwJBPifB5Eog1/FILs2u2AtTVXofg+cPGTNliEnvx9j3dSVd91XF3Upjs8J3Fpc7KtAXGr5BtMQju7yUOSM4wovGbaO4rIMmXTvf9tJM8m1sNoXvC/jn57WXBhBCPYr3HCukZ0wCMSver0CsofaVd6v+vmCrwAE7g9OtxdYMwGZ0W17bupHeCQXC7+RwydNh3RHXramfFBF0i5DnfI9dV1LGPdLo1FthSyBJaaClbBy9WAkG/UXxCTjbYZcE/H3v8xgKm1oq7V6AVXKPrPve//Hd3eZpPv+3/dlg12nh5dyRzg0MZfW/ADBIyxD7IDImVNh5iXYnDr6sRVoufAzjhNTQv6bq2ClV6yMWl85IA4YFb7nfOtuAyRgLPczXKEw3+C5SXWA6iVJSuIFiJ8iL3jROIQoKhsgIMAiUJsau/yuA/NzB71elsBMaK5PJtXmTHJKDh44V4rorIEL4+DQ250rTkm+z/ywiwwIU4b6NkyKA3bxxlrvU7pvdgAQ98AqLtVtS//zzoxRMaiTEcqp6S4j3knLxGpTwJp+OG31r+d2BZsmwumYOPrfzRv/s40qNy/si9TH+ngil07MrSAC/LMbJXFT1Bj73sUEYhxjzQm29uN4Ce83IRYoW/PuhwRtpK6luP3y8j9qb1LJ4BqPKgiGVWtSUy4BIVNI1GsmP0Cq8Movs6pmoIwBdcXdXdheooo3Wt3JJC5+1klBYoz14J9IkWrDMrqjrVDqWdIoWPoUNViDONu87oPW69Au+mZBwpiGxhohJBMXLdHqrsReAG2SgnJ2kfl1tMRDpHmAwbOzCjjHXrYuNDpvIIZhixLzpb4MZiIhHd7qHubTHNDujUTPxymJIGMSXhAID9fP22Vy2Bo4PD1cnrrHvHapVW/bysjF/jZsv8i+zI80kqgvBUQv4K8wV3OSRj4+pl1daHuusY405Z8Hb4Y0RlVxZk4suVoEzPrptaxWIU5P5mj0xgiT9sXhEGuGuZA5hQTUlMWMwGycvL/nIq7Do0qnm6JhHlXB2dkIuwWZusGccUKb2fIVQqQ6Lo5C7PgRvXpF6nsYd1kx3HD6fvByGWpMGVy6EFh3lfDxuziwNslAei+uxp+rJt8LLpLWZX1YrY46tzBbyX7UzTLn6ZSlzIRAopaetg3i9sN/pxkkHYK2L8Tb1lptUHUrACBm2Fwsl3lUgm28KrRw8QtA5ojwCzQ6AtP8xCP09yIIKe+j7pSX5TgjMfa4YCfyJYPANRgm4/rGcSuL+/CUu35IyEYwNYpNFnlLWooyeFfPgAlVfjXiZoIhMrTA2QDq4dEb9ES3Kr4hrogvgGQ9IXJvpch4u71nvYUD3RoM8nJkWXKXXN3Xrudn6kz8r1679azaRKPwnGJnUE2f9VNcZYbh6Hn1ID1HVIAEcQGYyhJ76P7Np2HprcmMOL0+6XNzOlHX9qaryvhOuFd2Du+ZNi8Snwfbsy8+lovKn6v2Aab2Zu+PGzqYkeWpoclDPOttUClC65iiYVyvr8nhyoOMbA0NUG6h6OW1Os/mBbEKxNAUjp1nMC1k+UwpnDC9RS4BiTW8Bj/IfLMunbvseMdkMBmQmj0LpdFLZYKBPaBonYvYKXvKjiYQhOBrP17yL5teODGUPu2qViAd48UaTvn6/t80y7zKLmKHGkkRXzB7Er+ULr2XzicuhYPSRHpku5wKdwpJaTbBIiV4PJP7TX2mtasSQleZA2FVFM42BraZcNMNRLER+otSGCPgrKtX6xHL8S/PpOZFrlVW3keFJl8HHfvxBJqJQjU3iOPNOCfOXAqnlfZ0wjxydcKLHhjFkj+YxtDuqfAyNHiT2pKXIVbxFQNivEg17+cOLAekegSxXLjxYQhvNQBSNjavUlYzST15q0RIQrR0AfHLoesjf+WnPttydf5Eolr4bA76E/vnxfvd/zj3UPgLm8Sj89GeMJ0Fzz6zx0oEdSYf9xgFApv3pnudBhZRI4Rwy0r07c9dyrE+tIXd5wv3+cB7PYc7Rkws+jRBzjoA/zvKjsO6w6yk5vCXbVKvV3Sdrj44i3TlZVV2pC5KZIZ6hGA9z0sisuNeB4YucDrmVED6YSPTdSMpo9uJQl7OULHFX1FjiQ7UjfAImOFVj/RwCzj+jV5aDluqWiDDRgXA32RWo0uFBNujeTLzReFB9TAS1uojjfhCaoIzXUX0BjlTPIzPBv2KtuPK/E5o33+SH38/vQjSFCpkx86moUi+ad/LW8Um5olgwY9n+jlu9lQ2d+TaTgimS9xEzjMIrnoI6U9W2OPSTB1+ckI52ehiOAZDiZxz5q+Iv/2vM/YqmCBhieiFhFRXYjtC6LoaMhoOE/G2JHgPeW1AmsYvOcHm8JTZhjsnpbeVOnd+qDaW3CyfbYELh3xQ6ldK1l+zp71DUrCd/g11ipNrXDf3tJJVPiBjyz3i+EsSDngZCY6MrOrNEJ+mo8uliYbZGzAyXg8AVWnYreePQsqm7HN7pQkgELpTKJtoiNfx88xTEV7tAxq2DVBXxPUaD3DDg5dLyOyGNHtHDwr8Dnssx0EGj510CRYvQ757JPlOhLufcuuCTW9GpVB2tQF7HYM5uO/7gqb5pwxOyGu3N3yi++IolUQRZaWKwQeg58Yo1RVgwkvaPalCwFoSAfWoyuVhJ4RpQmS5eGhwGHSbCTNjBVMkCo1Or4H4GnC97YXhVVoG1NxZ2KbcN0HSHS3GBQbbTOwEhLuR7f+mLTqE2GdWzkFnjviu7plVDDOodaX5R+XgEvcjxpDlZFI+jb64X+/SnoNwpjSKTtrTKOpPCyCgFwkvP1WSNFpqAU7opHrdetbyK1DXjl1Yj2vW9VOQ57F/hzT93lys+y9RbhVw/7Wx37QTnwDQBiq/MPtE/wCjcpJawyj/BfBPcfdyZLSz4Au3qTqL29VJfw7oinbKC71EwUSxaM3ObxMmnCZAxMjbjBaAz7o2DtGjBAKKNk1qx+Eeb1mTarEN2gECC1rKcaGs2Hr0gaUkH1LkAsFwnXrU1NkDp3O4rOMjVsEIsf04VNKV56gBEzs5STuS/0jL4LZIdg0YvzYf2HQv81lvETkKZIQHHewauUwEWWYN1YSlqE7yikB+bPFV1pk/ShIsn2ULrPRb6APk1I+UEDNcEdx2DDWF8syRjUjf6XbyR6Fl888Zwz4QGH3YfigeRtZ1niP8Jjmb2FoWtgsCIiGHQXxcXOTXTH2I9WCtR0I3QApTCTgvwT3BnQQg/LPR7Fn9L8D9nHYR2Ed8sDLvMoq9M/RjUOM3C4c51uox2IzXo6UlmJRrmoWrOJ2yjikllfZqwz3x7U6qT6LfxnCBCDEtf/5A8uus6hE7gi75+wxYQVvPGI5E3B223T4zrzLSj0xSB3ORtlmKSSm+/5U7fjuGEQpHcVUkm3vDWyzgJP6aP+0rnfyDPSdzHAVC4g+EX8EMEV/UUgpkrii21w1tvdrA8HX7fp79IojVAyHrMCkSIevpfosCiCeSs9H4tM488KPl/p6Hjl47/ZVhJQhjlVttx1Wh6m2q1vCDJkAbpNHrkIdV4KfHUqunNmagNGEY85Dpsg37guxtCTs5jJDmxK6CFEM8MJVpSDc/7h/mHRMmD/RNTR2N1VTOXzdlOnQ7KWz7IVZrbDXHVcMBJ4YzzTvmT1UZwDj2I093+bWIFwffED+m8yZCMnySAANRB9Mz/BoFCcaGjbDl8+Kp7mWkeuWhvBuqDw/tU2aw+NDb65k0XIEbXnTKOefkplE6SRPQLjbUwaKT16XFlpVmOd3Hm8nxyKAqIazzRF7mdikDhRYCbsoGc1MyZXmFa0NHUD82G9uDF9NWPKjaft62hN6pu4oiwQg04i3QmG+o2A2gDaYD7dHME5Bnl7mGD+Pefhfl64rdT55Omyjst3qqmUqniThDER77iK8TVPPAL25AHaYJSU6PKOM82DRvOL7UJa+hZDPqwNFwH02aREnA7fgdn4U7aFVgSoOQ2uik50n5ARmD1CjSDMAOHAlYuxH3GrtTYuuyTmJorxM/y0acUmHFEMEpG4nmn4aAe4iSaLMeEyOEHolbt7sqMLLfgeVVFFPa/lDd4ivQJCy9dX4vK6QrRz7G44LZIcS+7mWwFcGuSRSwaUzQGyVYtxW6Lwm8JBBW4vMDQauBQ5EfcyWuxHny6OnTcYkq/5iR7/gRekRnmfiToIlGjqrvELjiCD6Fn1VVx39tcnjrcwhQrEigEQ35JGblHNyQCMAk54yKx9RtJAYR2AGKqd6tbp0vJCPyL4vu2Y49UBVPi0yStz5tNFDVDRIM4DxI/2/NXLuMpYuRaUYX+nQwfnbh83qKOyPcOBMQxA7ZMAOYF8JeNJTy9AqJ4Ep5RFLQg6rVpe/KvoxexbScUR8SlEYwA+WBLEPTWQ7KBXlxeHxIZZMuHjExn4HvcXMb+ObEyDa6PUdeH5I3pEON6fWr1pBo2p640+ZuejofOEqevf41ctGRcqbw0CqKikWhkGDkM2VTcEjDMYmpf5rMPPQED+fBiJ3P+VB8SwI4FLdIy3b7IrM4EN+LSGeaaQLgBj8bdRB+99LYQYqM1WOJ1eU6m9wsNsJLIlXhQPWpfGgS2vMvtSCGFDkbsBamlmiHSY2Mnay/YuPDkqxSzyTMMMl+C4gof2vXAcooYWeQ5KEfK6XZjtxAStQRBUQHZ94SqEIK9xbGX+P00+T5NWIH0ILwBZ29pJ+g06DxzjyydLkglbkhQh7Kv9bvUWcevZAxwbtzretT940svosC4UXHdSeQ47OZr32FTu39sCpSCDWlKBHdPsKQvBl85KgDrdhu2jcvUsU566sZX/HeaoogE1U1Q0KlwJufT9X65MfYfhNRmbUbH27EtBLWjnjKBjstG56stAAnRe5BzCvp+LGJnD2HMwnzuzbD/wUgIbpfrqh+dIuRSIDCWbI4KloeS5BBM+35dUQNh2JkpmmHJ6yYd7NZOYM+LYmjuaxNypfEiBlvIeqpJTN74CngbXG4Fq50jPV6Y4pgtJ3lqg1MWPUgyG9YZCZcwYCVT9q3I3jF0tjx66124DHTr3F5D7Nusc5+E4INP4AHMPRAyWBvW/2AxWRRP2Z0y0gNFHPXEITAl1xeFjD/71bPj8XTEzUGusq/q2fzgDlyvmTezXn7ZA+4G7HYz1u+xATJyKYvuWeX6oO1mdT4TlRvwhtD/+5m3r5gAc02w3nzXZeUhmhYLMvVhAtePK4ZsBk98WZPSJ04+WG3ybMpBjPSULkpafnQBbz7rjBrLya3kJDnrHo5L+LIPd7LIRjvJpSrU40Rbz3UnAKrl1Y3Mh+1o00kdd1qmRzJKHDCxH49PkV5bti+8zpttEEy8msy5oOjUQWcQncjJI5e1c/QM0ekyD4WHhceDyCFfWvRrbMCbmEY9u2QXa7506NSyObCG4eWlJCYXpEfqPh/ysAhlOACH1wYWnZHN6XD98zYAtYnxNNE6pmqpQt7nEkE214A2jAaRRogftR0EN4Np48WH1/7MfgCv96ytY7bc68LHiXkEdZCOeb8ry5agA4fzEZIdWUePpPCRFj7elI4WPaEVLt8uaPsUlGAfroqzxKfM6N+noC2MjLDoo2N6vbVUlDcF8O9l0JlfP9WTxofJ30avLYWu57lpRHFDN0bSH3DxDfeI5gXOHiNCWomVF+pyXL8Ucxba3oNb0HDHSqyVDPPKhgglx3bL7JLg6A8C76yzmyWNn3ZBYwZbhLLbEbnwjJgJln04+rrktozBzQAwm/LX7ephNEH2etl/vkISkePT4WvR7Em2R0luNKeMmS2r5BcofuOtBmO9S8e3+BzfrC7too++kJjil2pnT5jlqPbqg4EA2a1FYmGN2YlLwpsVhQ/pm6eiFfCXJU9RfEgNQto9GzoQ9lz8MeVqSTzjJ8N2x3UE5UTOOtEbtEpORBUfW5A2Ik6jnc5u6f+I9ftWUQYqB63dSIKAgs84vbakcetuOhElDvSQA8igmIVBEYKEzIz1QoVjTwl2AKe/YwEATLFTGczHzQvTaxb5L3kw6Ob3dmtubbD+vy1Tqf/gd6zNY2u6ZxT2GeXlRhNoYdFECGWWccBaaPjqt/TG9sjzC9JKnTDxLbHuzYCUZssj3op1IePtSoh9rh8rlM8MOEGdyUaubrKhdwEIKe+DGJZUniqAE+Rvi2Fb7E5wFL2zQRQgxCMsi3yRD09RNyXcaAZtJUEQz4lYR+Z5fnHSLkerCOHk+yNjEU/w/GFbE3flXAPkqwQZhrSbixXBD57ijIt5O+4lXr7sigowXQdzz27KlGXYOz21N4mEC7Sq8jeDsrSEMzpyTG+usD+ncYzu1T0qw5L7t8l3ou7zSYcUtoOc3HVT7tpsOpoxwPvDUUrYk4snlEbRJAcwRTkwmV8AcBsL6kHLVOk08yZ/aFZhtJIwUyng3AK3Kj3HasUevChmB1wFzEmDCY7a+GzNfycvrVSXMqzFMAZ4L89NuuY1GKrdvI9GOEWD74tXUMDv9YLU4zJqsEJAfBgZ+E9peWaisr+qcD72wLv7Mp00conps5NAWqyTn20zPYO24d2iuswCaviDMtrwxp63LCX+qSdApXWbn2VqGq8imhUV6Dw/mGSgsySYhUtLWabI0HqTJZa9iQLtXwWhYJvuTN42kCOOwmuXUZEeX7aTiQtzcrtAAQHIBXSgvBXPoq7HRYDAYCCut2rzpYfv1Xb6aB3QyRIQ2ThuhDayr21pvuJSh5MoSkHozKAd7diMckwEB8ytF0PeysKMFBpIkPbgWJ/QDbn5/eBvhVbWqamf4nqxyda39FhbucX+yH6VIPQy6strTM18RJLCHLcPIVrKH/j1XfVthcllm4dR5sDYkPci1M6ZTcUSA/CgGp/s0VWKYcIP2EJMKo9wPHaRDD8HdqxzM/J/EMGMhArZ6shy3kxaIhDaGOiwmY/KSHoIdwCWZQJG3sPvKdepQaJq3sZtzSJzX/AjC1S8Kl8oZNQghbAQbcXQEfT3OYzC7kH+ZQvNKoALecdS4MeYsZinYu27EA+PMexpVr3YEB/6tqu/qIAd+qdSqSqGk1Jg/tKjgN3wtZTFx1NVrr+AEeFRQcB35iuDGIBkZlApFD6ut0O7LTgU4RObNqspRu+Ubj7/xE7fQ1Moi0QA/sA/7qP+MSnM7Ht7gElsy1TkAcqLQhDc08hGSo8y6T6UbKDX5Mt9QPLXG1+WjBqrhMfnPBqzsHApz4B2PS0gjZEmSlxO+cx+Wev5cCY/7BBe90dysyyZJm17LQuwvWSHd4/xNQtpOmL/vJCIPemIqqBBcAtUNpA/jg08dpgmY3V3FWco5VmocnhuxpuSSFLlhKxfxuGYEsm6HjMxQq6MEKWLxU5XkIq4TAkGMIngf82OJRptgq8cunDMQK/U0AevD8LMXkavW+sKq7VichnWjEnVzoWTfuRblGuBiXcRoLCy0TllJVBOBaidhlyQCtFPWAMzAmWxvEYGuWzUce1I+WVIJjANIJ+zBEQA9MW5XIdZXEUvC1ocLfrgpiTuto8S7l0CHX0z/aUZ5pF+0xI1CcBr/OomNaaImBz0iooLLa1HyRDlYERcueQqQNWYM0nMxj+ANqYPb7k/PxZ6aA5A4qZGCTru6y+zVK7vo+ItZDvIJR+q4uYfCDmBhxX934c/wCqlEuK5RmlZQm+3uxo0QXptH8iNTidtLJ8rsoY5CJUjnviZMbVbC0YJCSPt8J4wgxSPuEsXx8egydyc6VAYQqiqwRaZDwaPeThroJovvR+mTq0Gir78mYjeksuDMjheUjSsC0AD3GSHlKjQNkflPKzr84XOwqG9ERhUEvPfHu9k1P6UV6L/CKNqX3akshLRHiBdVM6jwihD9BjKwBeL3e/bYSEVbUjj+tg6j+WiYTDVj15CdZWP0fitHXM78PUDF9MtVxvbUoiDSIVtunaYNAgFgJuWeDWwQ9g1yBGZkF1QoHvLwXgjWDgkm4QjHNLaw721GhNDtqzdFv5/FI31trMVyyS2+u5KvUVzkf3tAzOSyFyxzk9bwD/L/0581UhFh/mU3I76DRHbBdKfafaIA8c8z7DM7xtwLqt5RGKjJgECg3RzfQqNzFUC5BcAfMf01xTd/ZsnsvdtkysjK6tZuAkyGJXL+Tifr4qmspuff1HF3nGmMfQxX+BJLd2YPNr7kHfRGgkSi2FKg1wEPiO59Od5JN4HHQoO4Lpj/ee6PY9P6D4oeqvHG+ixfa+FWqNqrDUEpz//W7egs3OlSEMDk4DJQH1liT+8tfGFKu2r87WV+1xD4bFV8gTbmqWchVNvdKOtl9bwqBppgNCbgCg3WMhfRjFQBnK41YZyzLAh47fjBmPxRo6qH86/zgYSAW3Ey8xpqnc6STjG0aPngRMTw/La/lPgRwZ+97wi8DMzv4X7X9sNnobBvn9Bhnf6nh9s1j+TDlkibcNz+qJUB7/UDa0YwJ+wlrQrdlB8HhuPI0URgxb08ys3DDrSvnhITtzNH4m/SDn8MP2HTYL346e6HY5EsZl+bNxtSzCJqhiNFXoQrhVNv6GONCRIOX1x+MTktrjcbIs8KIm7J0K40S+uFp9Dsc95SY+f3sc8IJSNwzQpeBHGUGC9WFiv1aouS52GSB0puUF/FGLE/10tJXdPbv3Ne0xYEcU+TR79ytrT0ZPp3mgIndgGz4vlUOgxR3deg+PL4saJFR51u5eLuda0GgWbQyGaTivuTNHWlug4WAjqCda4EY2tgId1rJucLyiqDbph2bwWHNR1K/AFs4DKjHl6Zohi3QpE5YljbJvf8Rg2SA+xMQsJxIGjP/pm7Qb6cfuOnE78va8ZcHrzor02NzsK345YWR/AcVzXyjTJnES+PmF+3A6on+7+DLOaWd0HnbDQS8mN+ZxT++HSKyQkpMMtf6/v2hP5ArkhRVmXAeF2vSBjlYQQK+/oWwxLY6v4E51xZdyDdulhh4JWJpKJrObvkT4dTDQMUcJPJFXTIQH8o4/uDir+4GysCWrivespypI2a6Twml/paEVd/9KJr1yN+AD03DyUdZ/lIP/X9F4kUgNleeMe6utVkuvWnCcTvTd9+obe2YYS9slXBx4ziD8ndi0h7LwjQ5NVk3Imq0DTX7Plm8bLv/LodPGcHw7qPPw+Tly+uEZsJhwWyEq99TtRkaZWlavz5TOraz5h2LNTA5tZPAcpTavdyUfdRNyXvQncjsDs5KsqwiFXHmxWzu6xaBJkjnuCxKMYUkz+UO0wQTab9SRIczwIeXOcvinI22vZs2f9Oki+kS8+DPuwt5UdYnCDQJPoo3n1Flpq6bxS0MRll61IaMUXzlItxi4WL117QG90n6WgXh82ilyzwgiAqvb71TP8XFrvcdReyUg1rXyxyYNHXFutIt7uqQvOrFJyrMjqC74gnEs6x4LJM1gWUCJUchGunlv7D+aFa7VkokaHh6/jhEC+U4iyxa/1xKEMzUEiYU7z7EXDzuY3iX1rVBLGbUeJfthdSxWBTRC8kVejWkc++apK9sbR/V0O7uMp1Tl+h3vcYTvvubkM8gpOSkoYyhVVkp2dux5KxAYsPaa3sdzU1xORELAr7n1qNUuCbTE8q3Ur7HVcRS6Ay1Aebg7WXrV0DnGgowqLVDmLjGievW9wDycq/qYhYr1TP822xbdJ/iZImEMrlwLjNhAIevY78Pf87KywVNyrlMBejStH69Zeb9Is0X1TJAGglGTijBkvPsxUFemN4AOkIFk30ZaBL3QFS9cPxHEluBovfDFMB0DSAjVj/HQbf3RPw5FeS+EmGzzMkAWepshwjTd4/O30zIz3gG0XYBwnnmf4T2S4tdfLfgUJXTsRuOJk7/ImEhUrI5Wj2Oy0369fe0mRbsfXCBANIfGcrPT6SpNZXUNP0U92pdLk72MTlDHiNf/EbmBpYZWe6XxjarQ37zmK8yVISJZCqFa42qakLRP94aSp5LCgIjIyqH5b9gNnlxVJ2GJ1sssJZAcutGunyKn2aCjuxDTh0WtZzNouwdtnmfpj83qXw165JfTJ2PFeFpvqHE6dMooXVQDHuea0AzpFmFqmFvkyhxXqHNs+XaKYW6Mi90rNBrmS5F6fZC8oIzfLzvBGZYaB4Cd1TLMFQOA4VR3fKfLFUkGsx1CiGam9Ak7+w1SCp1RTLMKH5lxhmgZb536cdfOQR1o5MP8voYCVQuwtW9emZBr3MRenqbAQh5icAB4J1kwsRlaaPhs/SkUIs6U5SWuD0AtiO11eUe6fViwA0Y8npkhqOT/xKEYLYZ6Ys+nPt5unNnvluk0DDDyk3znqqz3X+Nhj4ucvBbooxzKf4uG4ArF1m39uEqMOWLUGNASLRCM61CR3byG5zm2hNGilJQy7mZQwmojjRXGgbBCDg3rCEjmqv9b3WToG8YYyTJk01J1VTWoTst8DexTtHXKO6yKmwKH3wNFLCQU8WO2azt6oH3gG7CGQ7wz8oYoqFzKb6GGB5WzV2uv/7JmG/GDUAGV1hW9R6BNUqF7h9xgNgziAd9idMu4w+S3mTPsCKOrYTOKTpDme3Jc9mhHisAhNlFQWaTmVJ9ACVLN9pi4RvAOpYi+Ddpv2lacHYojC8MCDRaT08s3Z5gneSlfm68fu9HDqHwD4aqagKqBU00Qf+kMxK9TJfRVmJFmBNr4l6BrmOU0XFSW4BukNGuxtPd2Bfa4gcbuUpWuAKp7jqgfy+VmAOXH0EqHDSJ913JtGvPnUxiPvJPSRpLOKApFDL1d56L6HbmSdhpw69/jdz8MX6qDpbSGTMfyfpAQ9hwLyXbjUQecLSv/Aq6vCw9r0R72izB+Ox8ZlQSMgP1eyxhD0b/4NpNUP2zhY7LcGnX0xrwY4r+hqHR8pvZncy/pmLMbCW0Kw2tnah+NaJ0TcVLWQlSTGoKfB7RbdxLlVW4LCMGt574cSfLt8jBJ3cKy0TFhWCvahO8apKzNhOunRY2pJBT+u/oCw/YkS61mi3vR1wKv1gwGHqrpF5/XoFcIBwTi7oqWXkQbBq8v7qCxOooqJrWiKJmPeOsRJ62cp6VtM8cQG819EDasYvYIs73egBRf/fGougIz4w9w7TN017ntazZXppkJu+KpqgYEQ/kr+OAgLmvG84F/sLuJf85IOXKoQEIKsKmbqkzPP6VP1apWSKO61ztN2JqYgRtlhBqhFmGfhAJkweFGXG3943PDhljVPWkKClWJ2KUGdJ8WI9qJefIQml5Tg4CV/1e5BQN5zyneCwwqr6l717IVw6uXVWhxbOgrWbpiBkRZETqjiuPQLrMF3czBc+ad13ppZoQr252Jh2HljoOcuHdPifrlLJjoB+z5J7vQADGBUaYrEG8+ydD0RrzX4ooa+aFPUhvIjS836gm19JjGmw6O28vzjaOKHLfzsAI6ByDFArgHol0idPHt42k02EZTl2m78pptvjqKYNGXZz6tl8HteYza9XGtkcglM7VvYsfwaCtsA6zW6nFWXS7UB38OLeYsYbmbEUTLfRQUBtMbcTwEm6LmK8Q0/KhV0lxVJEKA7x5Gik7AFf5XuYinrDmOJr+TZucj+7kp53q1458fZyLG49owGgKZGbjLDXO4paxtI0zzIFJ1UOQkr3aE3yBJcp9B5hkV69vvs09Qzb/k34Ifcy/NAWJx9um6R1FWyL3Dk8kxvI44ch8w3Ou7r2OQ/RNvqvRCRYdjZv1OO0zOud5lKFOGReRJ3LEen7fdD6DAyw2wePyT3m2z8/fvoC1K4QKYni100m5zF8HZz5uqkcv8O/TmmtTIwtoe3a2vGX/Zu7G9PKV2DM9L5j+tnHua/KdjE3N7zEv4uQdkAyLrsLoqWv7zDH0FiQgKqGjtfonXNJ1fWAgpkGojg6VFoto+UvSH8I3+I/teMHaw0MOUsysUZRBza3vcxVUAN/DAGEn15zpdxKmc33CXO7fZRra2WprFnZYoh5lG7tAkTcMByMp8CM2dJrXCZx1zqrACWWUg6X5PztbEed+pEiD4sSIxHU/Lwz2wHRU76NrCTkw8CUTNqX1IquFu7tl7X3HWru947jefyKgw2uwF0BGOL+vT4PiOM1l7zxx1v96Zy4FBWsge6EYDqgBnVwTu6la/Boa9NNFH9iKRtuikwIGfAf6Z4rqDenpKyBfLxrWGMfmHDCrsmeOxZ4dQGbBflfTO1y/Xk1zKQo+A4gRgCYD6XckNzT9fVEMjMdCwpmlxMCkI/mr5fvyKO5L13wOVVh61x1RcvGSan7sVSkmkLKLC/262Ga5ZxeS1uTq04zOn2+MMQbpqFflDizyOA3HmIhohK2GB+tSEsJRJgEbRVKrnYyUX/LGf3Q4mxUel9WHyuNtc/h0I2shTUKc+lKoiaJyv1zb5eDs4zSh3vbijNaMjm4sDf8bNY5HymE8WfxFd5zhpBBIkv5KNjQxBWdCa5xemlRK5Kc0JmaBWyeTUoLIMZCFQng4kQY8ZA5joftrT1xZGrIcipMS2L4UOzT6qFHMB737zxpqxqp9aU+KW1ImzYtG2p5w3wXUVAFyWWjHigKszYUW+a3iqutfalEnDAiu8YEYOZlAaU7STlp9Zn8a92+9oQ20cHVdTMEePW1HJUrI+LQvI+J/yuKIdoRD5g3ipyXvly3PvjBAqb/wTGz9sdygMzSZhnDLhz/QrhUrcFeQry6KO24ghgr9AWVFzWt3Eju2Wsxz+ek7UXDhquVPMJ/0cdgwjdcNkYEanfvutPuMbnp0MfvoCWycQ1MKz0obDFBDEk6EOtpUK/84UzNrJMu+sPXhWqZA4baTIx39QcNXs9znPZ26kZFBSIMgHEjQsMZ2j22C5bHf/A/47Zgp02ZLe1nY9mqknLh1XKZY0TJySnjgEtSKHQcQsc+kS9ePRHLlv7+p9lPo3okpvcx+6Ppya34esXLFBp0+syQItZ6AlWqTxdP8j8PiX4LLdq7VDArMcEBE30lXtIpoFRK+dq6o6vcYktxGSvFeyORBVKEALKunhG7qZoD9S2efOJ5YfznJarxJAF2sZeTVV7Mb1BmMGlztIjUxD2hWlQfOr5gIhb7Wf9rcF5TzGT6LdeaX63tzB26lUF/NoCABrEqNfbq5mcOSexZOSggPNzwxJjPDzghSzqM6y1VR588lw88z17qea87X2RBm9DHeeHTfT6MkR494PaLrc6OP0weI6Rfx9UdGrC/xmzwj4OryU7RXtkRAig5ATq991AhKjjL1VUiEYM6m3r3QqKJgn8FpeKO7GPRY0vjyRGVUFG4lrggwq8ve1ulgzeH7+8ep3IowpMz2cL24aRf1D/nfY9VouxbTs69syQ4eG8mlRcPwfJpiwdrSK17j7xL4HRrGoenPMItc92Z+KEJhXRQ29HSUgTJS8N5Kl/Hsn5/otCsW4lVMlfGYRhaQpzLXUYx3VkvEVOQNQE+/Uibpj9X1MmZ+7qUs4SkUN2VHCUDMc+ojoRjLvxtGMHOmD0OfDghyTcB30uxP5m/75QAS2PRkIPQap1m97bMQBJWozXDLUsSnL6Hg+Tcf619shUeMjCRVzacy25quUS0XhLAR06/IWy7NW31h4e7X+SnTRnnr4aFOEBZtGhs9CA/4Tdmb4uwVW+Mcti7F9WLFFV674rLrsp0yYZDb0cutRUxfDss4gy20EuwJ55k+WAzGUbOhC4uRj0CGa79KOClhA9eDNa/5ut6d+cqWX0AWUj55E1zaqp5q82Px9pbndcZWLfOOzx+vqtwvWiiS4jx/tAa/Eh1MjJNIbQswVZlbnFBeu4N0dPjFuc/fVmYHNrZz1zKKXRbRFctUm3jmK3IPmeGWrbLZhbcgVtSj7DaCPedf4eiIYmpK8G482ks/JBIL+G7WKD/dfNCHiK1K/YmzbpXUU1NA7mjOweESa0zQ2E3z4J1a+k1lhI2gcvH7vrUxS7Px42vbmv4212P8V8xCq1xsyhD/QbctfJv5Kx4jgaTkrbeJJQ63fXXCl2O2iXS3ScisWfPz4hCBTfQ5RLvnUrylyFXU8cnngq64869Nc05N4jFlIgMSAY0EyzTQMijv350KdOshK+0OjwjHqOAJ55d/0gHubuoLwxZ5cKQqItWBm0MW9oZ5K3hZgjApe1yd3+ZkbIWXml0QBSEf4W31chaIszegNRSqy4RIxBHWi70pv1zM68TllH5aGB15tPUcllW42M/iRKZ6hIp7HSK4FKYuOM97Gne6tIIc5fy6uob/d3aXOhtfWo+n/xjoP7Hl9gnjINHlxxY/g8Gq0v/8EPXyNma0ltHzEuVw6Z8KncSTcWyMV88XY6xvJjruYb74uAvQgLctaOH5pwvyfjg4IJeCKwsPaTFmTpTbWK8dcVycZiPHyl1B64dohFT2Itls3hqxRUqvXQ55dxlrmCGsus9f6//DIs5caQ2WQLanMZmyAfQj4K6+9sP8mG0/LWSPHEOqbcgLuKkCg4s4oZ/+Kbyaw80bZwxJVnQuZVjnJpattRQu7BosGmQeIhn/cIh90D2M0hh5vUZmj+rLDlBNnDpgS/qUgHyjrBByRtPjDdqguL0Plm5RrlmYQ1krcib24LTrS9WXYy5MS8aOenRHvZcU6BVPSIcvvFPN/B5R7KpHyZdPigfYNyf/4M5TKSO1XvnrpRl5hKlox/xFtPXFowyRrTgtdFhC2zXf+DXTsC983EP9KvrxzkkI2pql1L4qopo+NeFYDwwAT+wERxQTlBd2KPzW83tiIU6I1SXRmDNjewwsHSpPSzWlf2J1aBSuBi105pWitKJRUJ7IgLH1nxR/OcOJzJpCI0tsq0Kzsjsw8Hg8BJxlLG3ok8KqBIbI6AXZQ9/gdyZbFF1C94503z3mhmcn0k4wWSRadHNEYVkZxSss60DNl3EyMc72uniKUzx5w6vCSiWUr0FgNG9u2stX3KmWI7qspcs7zbtfBLcREa80e6tjMfTEG6D/lQXfP+O4RSifYpu5Fm+jRS1V8XKh/TRo17FBwyXJWBRhIuPgP9lOP+z/3fOJAZUoueA/dbaq2C8xvVooyvgYdsOmNhA8Um3lniKEKC4rXmWU9alCTQhJHBDsmT3Uzz7yQ3FPoXYwCVV7vS1humcGcO+LB9IHBG5BYW1uoXgP5FzLXKb7QWqcjmnLlNGHUKoZdtqbsXrcyvzNeliEH1zV+zWJ4OzoCksAiosHTAiLNUkow7K5WzjMiCi3tOv6QXSaT8pcxGetFTxmq0bT++AKkUlw53y/w862I7/D69+WOlYMZPdbem2ILTmj50tWNGAhmvODdqB5qLBSpNQkx4zT+XbH7n4tKn9NRg4s12c59scX4tn/FC68LnrPjttwj/tG0fEp++TOf/BTxNlBbswra5SQFzxywPfAbuxTaxI88z/CdLbwNHWvWUPcTi+9FfgiSjl03K7fJx30yiO3m8QvNmKGD/VXiJBO71Iz+Iyk0sRwJE1oA0RQTtNBqcdkLTg86JqzZM0IdhkViNg+twaZAqzcQSaRn3hMBhp+ng7SMvAAOgkqw/5PJYR1yfqojAyDcLhLHtsidwOcqaTIf+b0hn4g1fFMz2xU6TzU8IPVeil86iJGRy6ZCG5pEuzKbSImr0N5oKd7ovbKnRA0+JmOFsa8/HPq/y/V8gaAkzzdineMOeEJ4Fo9sa2deI/NiqLmkN5UkjJdbQp3ZoKu8jrEUy6JXfnKUF+p3T70Tvfrp1mJg5Jimy+CSLu/zm7PFJ2VvL5vwgJFyAaxc/4wog/5c2FuDDzMPdokG2xg2E4LBIG6ISjmM51VRI+kgV7v+f1jaWwLpyXpFfHYeE853YlNUMw+TbGMQrQj8V7ESjK6XsumJzULrqZUMyepfFu+pUTk1vUBkTMDcwe4ly1bfKUaOcXmpw1yickj95p7M/oXGh109b1my4PRGBMZA61kAQoeh1fyjxZvBoNvJd2qqLslcKuhvLAqBYIg1WgBtKAjE8HxCsC3bxVnJ/cz3zNnbL9VfATH58HvmEqs3w09J5DORhb/QW3ILa8+FgyK1Td6Qrlxw7YTqnAPzC2mN7zpYSupLru4iJ6FUx3zSVEnfYHwgGAkw7ewlVzhZF2DJ7pyXsSWi92lON8rljrWe9DKiyZr00KfU3zljcDr5oyYdMmI06hLXQPHtKyUo/pl0VokJvq1BuzG+FxQwVIeTw/OpmGasQWI2B6AIwZacbGfefW3gVmhamFUsp2ZYiXhgs4ZvY11kuHWyiJGmJjqifhVCvufCkQtZEnR2Skw63Er5MQQK/2kDj4v+llI///kaK4DnL69scIjU1J/1PZDIkbov/vcOTNYHmC/BogwJJJD7j4UVnAcYMAsE/cPzWf20Y6j7NRX/STvD1xMu8m1k7BYIUmqFc4SaDkDmjVpgvI45mLt0rWKs6gnQKndActOjQlKQtJsAHfc7WPl7fNguAcsyRWtAfKvsyDgh3A10bYy4OS++veyMHWl2EOpu1tUPf7v0SKmHbJwt8fJVldn57BMqn75Dg2NJDHZiARyAEGOjGcRxwi9fssg7wFy6SIsalSkQqJ7zPLeTAym2BGU1HsI/WsYb2Ng2swQutkajSibO1sK6i13gC0oL3YurcbrdSizP8hCIXenOMQIq9oGOsQKXpX+1ilHqqx/brtIT9LzOCOlvqPySslyU13t6IoDWljyXYxAhoWEB4vEnA+0cQbfLFQHzkSu8kaseTuSABpXxdmr+PgFwOLT9jpYkw9oP5i+wme9uR09PQ72Rn9WPp6/hI8us0uQ46xLXZ6aZWNHYNqaMKETAc9UxIBzTKu1kCgQTZnmvB9QbCRoWFcmjF7oXdFdTpYhIqmSLQ4FVgdX7W3W7NWGVvxb6+fHb80o1NSV9+3Plo/DR0+nl39zmCfJZQeH0kMRn8lg8iFAsLHMe0byXgF3r7+nfrNH9P0hL6+fTynh/Mmnt0Bak3mNMuDzCji7ZRbQBSZToYnsCJ6fcxzrxG9bC+esVWyZgMG/3ZoW93BPLeLO7Sfw9SH8x0jBB9CXAcdeW9vu8Tca1VHrNYn69SluEjNuAEtKz5aFD0snU1h82HahMiVFXYLWRBWgSLBMTEplS8CrJlKNpfSw7MiiZ9KOUKu+XvzNBfucGmHVn5R0Qgzxfu0TgsFmXon/G4IOdka5nCQRQQAtflyjuRDHkXrU8gXu/fj9AnvTGlSPZkR/mqv/pnhKuofUkH/Cemih4R0ujtV3RvK3Ewi4D0R3qOvP1M9PJtYH/rrLABu2pRGEg63LNw/CaqTw748EGCW0ggYOjUWF1yD0x4lYzT7HPd2H8DyXeIKImSPf434Dfvw9HHfJ8ECrlPwQ52mvhGa8b6Cg0QwTvA77+sSxYzUcDbamhtW1IRjzuFgBs8pCa6BQ/eXB/EvnmKTctG2/7vkfdFhDB8NXHS0orr1A6mphykHLP2j49crMsnq/qRmqAIKMS+TRhhe13cv6QaT4IdNWEN9JC/XJ3SLDuYFKD3JrS11qpO4ZPI/U0ca5amKzQdDOle6/zxIzGyHYCf9vorFuVNSFyvxk5a+JHiYNdUyKmmapgpKjLI8aqxOkx5iJA6QkRz82C/s21XN7wm+p/CNc7UBMaHcx+0QJYOMXd8Hg0Qx+Hi0lTM7XU8JdtlTfzPlISz2gzzOFwkPy/cjLZ4NwDmT7N7j6ZZ/5/NX1RkykuWv+Y/vx74O3gONSB/1EdEbgWmgI+Q2xGREEW13WTahizngxTtDWS9Xo1Gokmc26UjZ7+gmRNH+nWbt/9x7vc6pwXHyCg13DaZb/hTaNjoRoxOuPW55CKjgO58xiaHEHSqHoLMb7fuFepNcJ/o1Nb2ixgML/2q6BEnu+NSwDqLRALdnQohJXiY5HGqijJ4+MEYLGreOt942idGNSx2OW4fjD3LVBWcg8gBFMTjhBflEozRmM13JWI6iP1gl8rgSklkDYETvn1Iox1jrEgpA4EmHLYsyNv/bYe41KIVhhFPl42K2ocb6anTZJnsxnt+/xxfKM0uVPaRvjCuz/WccamRnhsrwCy7HQa0flU9YU/yo0D35FiUj0wEprVpDjIqOl4wmQJbZO4sJtCBlPZKpt6+U3336ZajXP21ki0p0yen3/yi3w+LTPGT9kZrhMhvEAM/NOvISYTBYZHAPxJWgEwPAO6qv8MJjFW2J7A61p+Od+N8L3QQoHSQ+i+UdGqlx53G/aRGYnV2ndLjbbg/5QqBuAg1SxMMNiRay6UXo4Qn4acNb+jyItpFi4WKMh9NMcVtJxc5U7XilepjIRJneNwOiAD8NxNCHJQTNfFVCnwHf1ncZIUnOBSFgYGY6ftttDohEnqM9ETw/ErJkcYpWOGIQSdZ/3ZjMH1dAdTixCeddxMZEE715PqITfQ6UII0DoVyWcfVJ/s6mCPPYd+SXyKfCAgLnq1yNKUjN9YfaySVdvz/QvAV70U/82XLKRNjpSpnJcKbzhw0oXOf/Ns/OBHbc5wWOHE+eX51+aYPaji9MDqFGdkMRttsGf05z4O2YkBZAMWMEmhJHWF8jWKpXiOUfPyKabmnnnQXbm5+BBokOO+0GODqaLv5ghI46xBRx7F8F2TuvjCD2F4kuct8vhAtLx5v/MXhOyyMg26am3IZraYrn9JY5GvwYkklaRmshr2vrRVHYCl+nwQQM5+W7+HdnBW7bbqjJn7Ou3OdQzBqZRgSxKJoPqRyL1OBRKxUxVkeupp+1hFiySDHmDrydgqe+Iq9Ti//x5NIpOjTp0Y4tfIj2yx4g0AEEdil5Y2lkIHiJ23ZriWfevnmcDBfElAv381V+GngAbRZlvG+IeXZ9vi03aU8vyh3ldd0KsWnfFrD0ldzAetqwvs1XbirxfHVPjhlaUaNecCF5uj4mhgwvZ6DVXApOVNaZ4udbJ8Ea2CiahwA4CtU7VvwFdW8jtvbozHr+j7vAa3fTpMurEU9yMCvx3qq1nCo1cev6ajdNSHWo0XchO85Ztq0dcnIk6Iqez2jP3LZX6Q1N252hxyKw1E9D4FJLnu3FYizixPpLy8XubjRlIYlAESPs3bnDJIx3vHD1qjS09TT4/Aw0P23wrcs8QOqhUb/EpFjwnJWPQbztwYaPhN0RKq3U9kSeLXpbd33KbiUpBImjDJNeBwrtrAh9z9QwaHD9k59pZe/L1PYXBmHZVQphgUNCcVvo5CLqeXmnKIiOdNPUTxW919DcBIkNE20QbHIjsnAYh0tiqSpTJqcMZpDx7JPFeb9FUIP/tcN9lddt/EX0f2ax8qTT8JvEhf7Cta79QwyWWobqLT/P0RLx16Uvom3ciNdj6jgdAZXFtxeUpEN/HTrb8xboyT102KnjcbdomvbTue+t6EgK/E6KqeqT+VbbpmbEyGtNJt0KzG4U1jYVdS+nW+CI7mZsr280YOOB3IC+t8VTrxANovNOJ39RyRiDAcnNf0Sk9t8PWfugSqhLL+0AHED5HY89bWii7bt7tMWTZNxYZCdwlNkpHSL8XTu/qHZpHwqfUBfcqaOvGQsO45GyU+sjKuZnB2j6iiPR9SqvQHsRQtScwfwr/Km5FuLRNBxN2xFBE6sRT0nhcnqlY28KV6a3TO+06o2LOr18oZi2wqmdEXFqpzbJ/YEKORpJa+x4MDKepdKrEn+jpd1eXyVjfyvTCAvnaKZVue4IindidWZ++CY0WxyPlCrVyhWjbTUlyrePDNhEKyo1XOJcRODAp389TaEduUSKY0tpHAmCR539OpUxyjQxOUxDa4YmqInkFoWA6HLaJGnupNqpCuGIX7zhWexVpZKK3T3ExsvwUQZHYlUmcRKcVJTzXzzxFo3tmlZkRolJW+S8C35DJbbDjnvB8thKFAlGNRYds49cIAuO9DHXXbh31b9ZcRjWar1ZDDb2vfPnLzdlXL3Sk09I1evCDH8qBqi4ACvzPus8AO4njjvyGYY4XJW/XwppVhMl+7wVribvvkpK2rRwv/czuExEPu8g/H9WloOmhsgkM13uP5BVVWCeNHeBk3VihkMsyvEKL7C5KL7YNxUAjFep3RMvk6m2enn2k1tk2ZRgRYfQhsZJfQjUTkruMr1lq9RsDpczOr4fY2G7Am8UbMm4+3UcMayeCeAmtu59wwfgWz7V8I9KbQEfvPjdnbok9emu85xD9PdshGHdIelQkmSmxZqtkpWUQSKT2MX2SENOfoDgatl+/ciKzuCc58MS6B6xh9w0iq5HMcUiE+Tn3eKqpBrjMJQ8M2PaB2nqg6v+O8nGCtKkjl39BuEz74azunjRO3dojv+uE88lYFlxOFNKJt2NTbHg6KOk9+zni0KiFG39UMEVTDb4778wdJ1WTR7iUaP2dtmyEc7Soy6ta32aBf+2bKt23XW35lcc0CJckYWEbU7zNew2xfToIJBFPceLrElVvst78k2nIM+muyyFxn1FN8Azjk/cPGtFDm4rjn/heDmWIOCu5yxciDPFOfhZkKp+BsWz621ys3P+UKgCgPrz4iuGAogN4r1GQHz+hmAy6wp/+yYmS8bw0gak7Qd+gVE+7BLMU7Xs6qa1al3a4vA8QT/eM++0pjNp5HRae9MCzMv7/dMIuiQQ1yoMA8l+hT4a99VE8gZnf0eT10/3+6HScwV2IN1/YfUQGkgFSnwOG1Vezmi6HRu7poWV1j2o2U0Up8qGp4jdHwc2gQwUXL5jreA/RR/eqRB1sPnSewBgZLGANf5z+XAgM6QMOisyc2mOlYOAuX8N+dCq499uGw06sGSCbtQfIecwuzipI98af90cDJdQ21f5BFdKeVp15nYNcMJMav9EERZ7Ez6WmG22TFKnJK5PbgW2Kk0RPoWQm/IdYrYGmex2gJKfXDbbUn5ZwI3M0voAVbc7uXcVmHk05G/6udjLtSZTBSdrniLNd3pcgOJQCHwPsr/DLV9P/JhjiHv2UUFquAA7cOqiEDVDQKcdu3KeQGKeN7P1m/v0Ka9et2Pg3rPwWDaq51n285V4qhIIdnldtyaUurAGP6p5oEYr+ilAaJHv+vDZItk1GY+k+FBoKxPUogNfMQ387Z/iKvSH+R4Sgv5uX5Rz/NISdzDTfk1CWHwdHbemSK+2ZqoPNhK1qgLz8ryXfYvhG0F9OqHm27+vGxUhhhNpVJe+HtRCyfVlQW6Xu1lGOqbC/ARJ+pcBAZzfjA23p43FkvWeeMTeELrAmcEEtP5Xtf56Mms75ZIfzZwfdX0xEEyktKC/vsiDOYBHFftU1S5d9BRMJh5KC+lmKchKFTBy3UBvvEEuyLERsY3REP6AFTlFLuHM4a9jbtLcu2eeoUskjYexxfHmYTeC2po7O20SvKm/CcxvO2tzHyMvasdsLw1NSyIH2SMIpW47Pv1PLBGIFWko2FmV6WC51BnD434vizsVdsl8Q95n11g6rff4193GGzcbiDkvx7LjhFI/JhNaow3kHoAgQohhqYUt09r3BOGWwmn0K32/LG5aSTFe+0Wmfm4qPdAR+nAlcvVuO7aH6W/rn6n9LXKEmDrj5xewLCvPaOMMGM1Oi/HlS7CrPDfwObRhts2fmDVSrrFJ20E9zP+qUaHX35k8mqPZD76E3LF8O691J61AzO89W09ZjNYh3M9M/dTiBpw9q4oW02xBYcg7i7gVSdP47bMKQiGDzIdOESlMyMWZ9TsJZXG0eLJ3cOdpnHpbiGYk7RSaNJnKuMhDoO1CNmPCpyxUte4Xz5mjBVBf01I6CFABlT5VHxxXFli+cOZ98N96XQ/dxFGl4fIlGhp1T98dw+/bDlSuC2x0vij9q9+tPBmjS+MbrgBLA1cSwvKlBAn5OPFSOfcdA8uhf6XMtuq/yBoeJ+UpdrrCLQ4g6tXNJhu+u5ag2s+D8BQ9+RRdvIwFCgUwfsD2vkCexvHBPcrXJjJMwj5qIe3fttGa2MKOQrT1dh0Dd8p7out6poAueVBY2JIEqjSDdBUWLUgze/dmo83hJRgO8Xkzgi47aTFjXA+fr3iNvj94GfzPPwG3MF8ERL+3we/an2zK5Zpd9HMQcHB0HFSKPYLsMJjfNojnKDolzXmTd9MkXgXZQZkbfYpB2mkI8u5pnE9vOY9P/7y3onP2eEwa35P5qqkX7QMsopeAeyIByU24nILX6TCNpb9AE3tgl/DBYmyI2EBhvi/6z93Sp38cWJ/riYc/oWbNzs7O8HBCNGcAIjQmlJeg2GHBmpMndOryPWiDN04T8iipzczrygX2aIKIP13WggwoBx7gDLsDlIpC2Y76IbXXXCva44np8ZtiaV6L4XzUSkxTZi4BrtUr1xjbyg+I1I8/jGOAXa6ZTYNILX0YE74BlSwTY1SL7Ca8yiWJYqWVx8Um7hji+7Z3AB5T7KsDCNavELW7FPBFzj6TqYrCN/PcG2E8pMlH72PIoAb7WjUSnJNstO1PH8Qb3cDryYnB8GuNvdXAxk7BKSydyz13nKIqUBJLmQdvL1au4icsxenOi+JpbTFusYavVU/oI7OGsL/ae6kQ8+2VJX/WDgnZ9ruPOwYIv7xhFeb9joKo8wmsBnp3pPCbjKqXcM0hpYh6S5FEm6cvNAh5IrVbXRi9sRfv1QK6I20/WrTaCIMZ0ykuO+F0OC3cti7x1czAEBc7TXrPCVgj9DeAjXgT8ZzV8SF+WS+oTVm9AR4rfVmCZEnWCYqpHNUtlMN0dZaGeNAbmnDAH8KLyRjT/z43RsHtkzm3XanqG3l8PaiVxgBX+76iFyIPpdVR9ZfYCEdOylABBJk8kf7+pq5cBnvRzON4G3xUp1cWUqbXkFDYtUzkNEnDB3lMQvjRmrKnoXuJwjrLrLeO6A8X2SSFUUkFaib1LL3zrCTZJEWWNhGmrNFVE0lECyhSGJvp4eR8eL4pDLzcv1WaSGf0eH25fTCqN7NPR8qhOvGbQ3MkecjtXwQDmlg8FdRCI+L8Dzx+yjBU+5nXFC4DmeVPXvyK2EC2m4hBOClgkjYt0dWyw9UdI03wZmjcP5P2peQXMic95S+/RoO2yG2W44X2jqvlSQ+qr2ULyDq0U4TfwFlihG0RZvyg2J+2bHqEHbj9roC0JOkvOi1kHQ3Uj9hiakbAGcvYy4dfUGpLFp+Mp8MIhY+O1tAXz7b/RJ5CHSZGxWRQBr2IDEosYff7oyMh7Ca3qdpA6VkS+aOUaqXb/IJxU5kxZjVKYZ0FXiaiXNTxHn1ydu3LIRyjjfwRZMYnHgtWYqVHQbjnJIvHCuizw+L9c6don25hapU0ixm60fcsT1JFvp3RYPg1Y2arRXZnXGA/PrIx7pnVjAufqjttF+Jf+udLz84Y7gYeLfQaeB6/0oT3yvgYpKa5zLgqDNxpYFiLTSCU+ZZhUQp5bigLH7tORLDUjUBa9m9VXnRLZUhwl/gs6ii8Spz5kKgY++3KThxPk4/2U3VuH+GmouoWqbSi4eP3YECtprINmJtQBOVhQCc/Rn1M4kY5iS1vl1Hn/eZ3UX7Df6sVhQCD8WNTyeZGKT9/mGWHxgNtmovQAadbfIinpbt9V0iySn39CoC6nxCHfHtU+s1LEdzufYix6W73dDKiTusA/JETxbSLTugfL+xe6yJKZfBkBMCYJBhWEziZqdosBaROsW9+WGMciUmH5ZwP7EaJAA7zJLGEMShuRJZb8y4kY2HVOiayRoxZ2C/sosqYMfT957ihKq4gockiWHqNl/E4P2rs3mXFQoGcQQ69GT5xECHpI86Cj1BWZvhPWD822nHZW1tx7oGXK/Y7RM0UuCO906v6tdEnNZC3Ci5eGeRvifoewoAsuRY4w6m+0ooZjW3uRpIi01ire2J5uIDNIIgooocPud9+gG23XQdmtjbrwG3qNNo1dw1bTGQiteSbCsm+fxphzs+BAIQp9jJMOG4OrWSlU9Xxfy0h+eSQqHaG3UqkZIa7qxZE5qET+XzYlbKep8EhYHpHkBCppHTIj99bVskVPRjjgtQOqmFj1pmGK1CXHMZpU98jYcvQh6elR5+eO5doyfazZqL81G1uM2MLeJGKOjoOn9pSXKtH0fBITHbEHXGRMBOltTvQ4cS7g3cLOwxeYU5kFvGlPuiPCq5ZW8qiZDdQHF0oU0f65ixczGOFrHDe5fVyD8O3775Yngafzro4jYPfSE6V2CRBxAO6MbGGvfEYyKhdkgwr2eD4aUAKWJSZ+WiNFBjOt6uT+KfK3rx8BmDZgmDYChRitKJhpDwxj7LHvJ0W/A87GDEmuHDTb89d0SzHgfigp/I52DupOL1WbS93tM0fvI+FtUJJDJQbN3RcCGUddkdGeSfx5bI2QvM7AuSwuOrOyfW2BVW9NIKQ7EkyAhc48v9A8mTGU3Zp5sjFTp6RtTMMWy5dzGCbRg/wnlMCK9hccRrKL9CRoV0wyw5XYT9F/BaaZRYt3hMyzGhidsKLGgjoU3HnDKKtbA1zK82BlW/BclDAIcfstv2Iwa8gvd90Pvta57zoNREYCNHm9gTmr95qlCypwJZvh/NjLlehLRGEmYnOWxteBWXCVzdWNQ86+ulmulRyvkAyM/3t4ESHivVdnEuSizZxGSVq3eWta0ZSLmPtto3OJsqbk2x+umvSORX/M7nuMRqs4bFOloPqWxTK1Uhj8sKMvNCmhgkL2DzGKFtAeXVr14kE1vRWYaOiXukA2HRSEcD1NWWrBU01vEQwjlWd0fdU3TNUMJKH5r7Ult31P0KeWhOXc6gSymqh2PcuBnKEXRKOHua3VB4Mugvg3qGvtpduTeiMZHWXQPMfWZz+QNUGDQsM+bjKJ/9brr7N14hmpsZWUZZXPE3FmorGfnUyP95YRlBBxPylyY0OAcG8MeGLKP+XSweHDNGN5MzgPLub9q9DfMY7Bz09EfLI6rWwkWweqOO+MAtE7KmDmBV8+F6/eQc1WIAQbZ/dDvlbC4JcfdLJ2SwM+5pmVhWCqrfsOQRrxkFnBIuLjWqwXLYJTNXK/ZwYlmib0xKPE041OCfZET+sXBc+Ve9kHm6ctuWyaUHKIyErmC7f3fmDD2LEJexNl8aEo1xepLHinjCfdnnba3cccZfXi6mUQ1pn5Z1cbZ1o2ArGS1z+FL9KOxyd9wQ+bJwItMlTLgfQ9iWpgZJKpZBXZz1p19mAMjqBwu3aIJZd/3nkLUuTONrSjyeSpEtj/frpuoqmOKBLuBufPI2NfWvP1USKtt9mmHwwTYaO+lCIhqwcRkeMBcZG0TH4PMVNyMujU+2rKPATxePkzhZD33B9xgt+M9RgrWrnOpIPFuMhmqlkFAjvGAA6OrOis0T6rB6VAUGb8wEyKI9Tj0oMhH4LBqHnsRvvW6gq7nRgOWN/j1tG3kqpsaRmK+lkBdS4/DzMcKxZwfa8U+Y/WLbu1CCdxNpcP9oFaYgjWxSLC9+D9fhPdEFDNB0y+E3h93k9Lw/h177PhiRoHnmf4JYOGHjEcWhNp1op77ov40WR1Ava1qbf9cW5W9cNh9SAkQJiE8ADzeQX15jXiqe2CYGyHsvgVA8xws04zfASQTD/7rPbVG+NwucgriEc9bTyGwGh4g3eosF3n6qlVM/2LcJ+O62Ea7c2TjgAp0Rn2CWcISleFBOO+orXsYnwE7elJuneeptmHJ8lzcBbptL9FHko5RUNVSUiHiaIe3AqTkifXK1oco8SNj0T4Z3PoK5gg6Y7ZNtIZOp3S0fQuTNjvgw+Hp/nx6AVPPWIN3dXHt59f/5voxV/n079nDTddQoSM/Kp6XQiSdXBqoG2fe0cW0zYNBDCbZxVh1hZ9nobtN7MEKnd2SuNSCiD47O0zt0cIwbSk7qekirayPXBsExGCKiYZpMdmuF3WPsSeTtKAN8KZsvcDnscP5uBFUuJ4Qgw5fGM1lWT8O9mdagBt2R0bAwL+x61wz6ZVONTgAchKVVITCJbinfwMGLRwPkAABPMnQ5Kmzdzl9K5eMfET9XM2eSolCfbNCRflbFAAIlA4JcwJHtFF/KX0m2ijBnGuU6PiHpc6B0vMY17YmbdsJ1I6wU5g7OTWDkHHH1ruKACYolq9aOO+YoUD+4UROEZ2iAYvhpnLGdNBDT8hvxMsgEhPdzCU/gWFOnGcwql/pJMWYxI7HgxiNVSBtY6jHvKGK0yAw4+6FapBQtdZnlLDWCfmJryM4HgSpSIJ08T82VRqKgKciEluD8tebAJPIeCME2N4jzydt+QSdXoHPAmE5nhmSiP12zvBplINNK+dpmsfVOkdgZPPZhGUi/VeQqQMikBDZUcnQfNsWKI/qdxfFE+o9fRcOcAAAAAnZ4rJtua1hV4eQmH+XbGTRvaWgVKCSNjZVuF6vJ0Ee/7C3Horqi2z196rumE+hsKZVZ12CuYQuPQqcYkPWuibjvmRtxSofmFSkwaQE5mBBx97mNxI3/26ABiOJnHGHbQSJqF5fnAMgbRkpFcOOa471JF/bVOaofEtm164qqoYNnOad4rww1P5yTf688hlqza90qtVVcllpnX/mhnSCWfLDswbmtGqEJAIixOBjm0fCbs4fIsAAAAAAAFWbrAoAAABFWElGIgAAAElJKgAIAAAAAQAxAQIABwAAABoAAAAAAAAAR29vZ2xlAAA=" alt="Point do Pastel"></div>
  <div style="padding:6px 16px;font-size:11px;text-align:center;" id="sync-status">⏳ Conectando...</div>
  <div class="nav">
    <div class="nav-section">Principal</div>
    <button class="nav-btn active" onclick="nav('dashboard')"><span class="icon">📊</span> Dashboard</button>
    <button class="nav-btn" onclick="nav('vendas')"><span class="icon">🛒</span> PDV / Vendas</button>
    <div class="nav-section">Operacional</div>
    <button class="nav-btn" onclick="nav('delivery')"><span class="icon">🛵</span> Delivery</button>
    <button class="nav-btn" onclick="nav('clientes')"><span class="icon">👥</span> Clientes</button>
    <button class="nav-btn" onclick="nav('estoque')"><span class="icon">📦</span> Estoque</button>
    <button class="nav-btn" onclick="nav('entradas')"><span class="icon">📥</span> Entradas</button>
    <button class="nav-btn" onclick="nav('caixa')"><span class="icon">💰</span> Caixa</button>
    <div class="nav-section">Análise</div>
    <button class="nav-btn" onclick="nav('relatorios')"><span class="icon">📈</span> Relatórios</button>
    <button class="nav-btn" onclick="nav('produtos')"><span class="icon">🍽️</span> Cardápio</button>
    <button class="nav-btn" onclick="nav('cupons')"><span class="icon">🏷️</span> Cupons</button>
    <button class="nav-btn" onclick="nav('config')"><span class="icon">⚙️</span> Configurações</button>
  </div>
</nav>
<div class="notif" id="notif"></div>
<main class="main">
<!-- DASHBOARD -->
<section class="page active" id="page-dashboard">
  <div class="page-header"><div class="header-row"><div><h2>Dashboard</h2><p id="dashboard-date"></p></div><button class="btn btn-primary" onclick="nav('vendas')">➕ Nova Venda</button></div></div>
  <div class="cards-grid">
    <div class="stat-card gold"><div class="stat-label">Vendas Hoje</div><div class="stat-value gold" id="dash-vendas-hoje">R$ 0,00</div><div class="stat-sub" id="dash-qtd-hoje">0 pedidos</div></div>
    <div class="stat-card green"><div class="stat-label">Lucro Hoje</div><div class="stat-value green" id="dash-lucro-hoje">R$ 0,00</div><div class="stat-sub" id="dash-margem-hoje">Margem: 0%</div></div>
    <div class="stat-card ifood"><div class="stat-label">iFood Hoje</div><div class="stat-value ifood" id="dash-ifood-hoje">R$ 0,00</div><div class="stat-sub" id="dash-ifood-sub">0 pedidos</div></div>
    <div class="stat-card blue"><div class="stat-label">Delivery</div><div class="stat-value" id="dash-delivery-hoje" style="color:var(--delivery)">0</div><div class="stat-sub">pedidos</div></div>
    <div class="stat-card"><div class="stat-label">Saldo Caixa</div><div class="stat-value gold" id="dash-caixa">R$ 0,00</div></div>
    <div class="stat-card red"><div class="stat-label">Estoque Crítico</div><div class="stat-value red" id="dash-falta">0</div><div class="stat-sub">itens</div></div>
  </div>
  <div id="dash-diverg-lista" style="display:none;margin-top:12px;"></div>
  <div class="two-col">
    <div class="table-wrap"><div style="padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text2);">Últimas Vendas</div><table><thead><tr><th>Hora</th><th>Canal</th><th>Itens</th><th>Total</th></tr></thead><tbody id="dash-ultimas-vendas"></tbody></table></div>
    <div class="table-wrap"><div style="padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text2);">⚠️ Alertas de Estoque</div><table><thead><tr><th>Ingrediente</th><th>Qtd</th><th>Status</th></tr></thead><tbody id="dash-alertas"></tbody></table></div>
  </div>
  <div style="margin-top:14px;" class="table-wrap"><div style="padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text2);">🏆 Mais Vendidos</div><div style="padding:16px;" id="chart-mais-vendidos"><p class="empty-state">Faça vendas para ver o ranking!</p></div></div>
</section>

<!-- PDV -->
<section class="page" id="page-vendas">
  <div class="page-header"><h2>Ponto de Venda</h2><p>Balcão · Delivery · iFood</p></div>
  <div class="tabs" id="pdv-category-tabs"></div>
  <div class="pdv-grid">
    <div class="pdv-products">
      <input class="search-input" id="pdv-search" placeholder="🔍 Buscar produto..." oninput="filterPdvProducts()" style="width:100%;margin-bottom:10px;">
      <div class="product-grid" id="pdv-product-grid"></div>
    </div>
    <div class="pdv-cart">
      <div class="section-title" style="margin-bottom:8px;">Canal de Venda</div>
      <div class="channel-selector">
        <button class="channel-btn active-balcao" id="ch-balcao" onclick="setChannel('balcao')">🏪<br>Balcão</button>
        <button class="channel-btn" id="ch-delivery" onclick="setChannel('delivery')">🛵<br>Delivery</button>
        <button class="channel-btn" id="ch-ifood" onclick="setChannel('ifood')">🔴<br>iFood</button>
      </div>
      <div class="delivery-fields" id="delivery-fields" style="display:none;">
        <div class="form-group" style="margin-bottom:8px;"><label>Cliente</label><select id="delivery-cliente" onchange="preencherEndCliente()"><option value="">— Selecionar —</option></select></div>
        <div class="form-group" style="margin-bottom:8px;"><label>Endereço de Entrega</label><input type="text" id="delivery-endereco" placeholder="Rua, número, bairro..."></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
          <div class="form-group"><label>🏍️ Distância / Taxa Motoboy</label>
            <select id="delivery-taxa" onchange="renderCart()">
              <option value="4.00">até 1 km — R$ 4,00</option>
              <option value="5.50" selected>até 3 km — R$ 5,50</option>
              <option value="6.50">até 5 km — R$ 6,50</option>
              <option value="7.50">até 7 km — R$ 7,50</option>
              <option value="9.50">até 9 km — R$ 9,50</option>
              <option value="11.50">acima — R$ 11,50</option>
            </select>
          </div>
          <div class="form-group"><label>Previsão</label><input type="text" id="delivery-tempo" placeholder="Ex: 40 min"></div>
        </div>
      </div>
      <div class="delivery-fields" id="ifood-fields" style="display:none;background:rgba(234,29,44,0.05);border-color:rgba(234,29,44,0.25);">
        <div style="font-size:12px;color:var(--ifood);font-weight:600;margin-bottom:6px;">🔴 iFood</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
          <div class="form-group"><label>Loja</label>
            <select id="ifood-loja">
              <option value="grasi">Point do Pastel (Grasi)</option>
              <option value="vi">Point do Pastel (Vi)</option>
              <option value="acai">Açaí das 3 Irmãs</option>
            </select>
          </div>
          <div class="form-group"><label>Nº Pedido iFood</label>
            <input type="text" id="ifood-pedido" placeholder="Ex: #12345">
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;">
          <div class="form-group"><label>💳 Forma de Pagamento</label>
            <select id="ifood-pagamento" onchange="calcDescontoIfood()">
              <option value="dinheiro">💵 Dinheiro</option>
              <option value="debito">💳 Débito</option>
              <option value="credito">💳 Crédito</option>
              <option value="va">🛒 VA</option>
              <option value="vr">🍽️ VR</option>
              <option value="online">📱 Online (−3,5%)</option>
            </select>
          </div>
          <div class="form-group"><label>🏍️ Taxa Motoboy</label>
            <select id="ifood-taxa-motoboy" onchange="calcDescontoIfood()">
              <option value="0">Sem entrega</option>
              <option value="4.00">até 1 km — R$ 4,00</option>
              <option value="5.50" selected>até 3 km — R$ 5,50</option>
              <option value="6.50">até 5 km — R$ 6,50</option>
              <option value="7.50">até 7 km — R$ 7,50</option>
              <option value="9.50">até 9 km — R$ 9,50</option>
              <option value="11.50">acima — R$ 11,50</option>
            </select>
          </div>
        </div>
        <div class="form-group" style="margin-bottom:8px;">
          <label>🏷️ Promoções / Descontos (selecione todas que se aplicam)</label>
          <div style="display:flex;flex-direction:column;gap:5px;margin-top:4px;">
            <label style="display:flex;align-items:center;gap:7px;font-size:12px;cursor:pointer;padding:5px 8px;background:var(--bg4);border-radius:6px;">
              <input type="checkbox" id="ifd-desc-loja5" onchange="calcDescontoIfood()" style="accent-color:var(--ifood);">
              Desconto R$5,00 — pago pela loja
            </label>
            <label style="display:flex;align-items:center;gap:7px;font-size:12px;cursor:pointer;padding:5px 8px;background:var(--bg4);border-radius:6px;">
              <input type="checkbox" id="ifd-desc-ifood" onchange="calcDescontoIfood()" style="accent-color:var(--ifood);">
              Desconto total — pago pelo iFood (loja recebe cheio)
            </label>
            <label style="display:flex;align-items:center;gap:7px;font-size:12px;cursor:pointer;padding:5px 8px;background:var(--bg4);border-radius:6px;">
              <input type="checkbox" id="ifd-desc-misto" onchange="calcDescontoIfood()" style="accent-color:var(--ifood);">
              Desconto misto — R$5,00 loja + restante iFood
            </label>
            <label style="display:flex;align-items:center;gap:7px;font-size:12px;cursor:pointer;padding:5px 8px;background:var(--bg4);border-radius:6px;">
              <input type="checkbox" id="ifd-frete-ifood" onchange="calcDescontoIfood()" style="accent-color:var(--ifood);">
              Entrega grátis — paga pelo iFood
            </label>
            <label style="display:flex;align-items:center;gap:7px;font-size:12px;cursor:pointer;padding:5px 8px;background:var(--bg4);border-radius:6px;">
              <input type="checkbox" id="ifd-frete-loja" onchange="calcDescontoIfood()" style="accent-color:var(--ifood);">
              Entrega grátis — paga pela loja
            </label>
          </div>
        </div>
        <div id="ifood-resumo" style="background:var(--bg4);border-radius:8px;padding:8px 10px;font-size:12px;display:none;">
          <div style="font-weight:600;color:var(--ifood);margin-bottom:5px;">📊 Resumo iFood</div>
          <div style="display:flex;justify-content:space-between;margin-bottom:2px;"><span>Valor do pedido</span><span id="ifd-r-pedido">R$ 0,00</span></div>
          <div style="display:flex;justify-content:space-between;margin-bottom:2px;color:var(--danger);" id="ifd-r-desc-loja-row"><span>(-) Desc. loja</span><span id="ifd-r-desc-loja">R$ 0,00</span></div>
          <div style="display:flex;justify-content:space-between;margin-bottom:2px;color:var(--danger);" id="ifd-r-taxa-online-row"><span>(-) Taxa online 3,5%</span><span id="ifd-r-taxa-online">R$ 0,00</span></div>
          <div style="display:flex;justify-content:space-between;margin-bottom:2px;color:var(--danger);" id="ifd-r-motoboy-row"><span>(-) Motoboy</span><span id="ifd-r-motoboy">R$ 0,00</span></div>
          <div style="display:flex;justify-content:space-between;font-weight:700;color:var(--success);border-top:1px solid var(--border);padding-top:4px;margin-top:4px;"><span>= Líquido loja</span><span id="ifd-r-liquido">R$ 0,00</span></div>
        </div>
      </div>
      <div class="section-title" style="margin-top:8px;">🛒 Carrinho</div>
      <div class="cart-items" id="cart-items"><div class="empty-state" style="padding:18px;">Nenhum item adicionado</div></div>
      <div class="cart-total">
        <div class="cart-total-row"><span>Subtotal</span><span id="cart-subtotal">R$ 0,00</span></div>
        <div class="cart-total-row" id="cupom-row" style="display:none;color:var(--success);"><span id="cupom-label">🏷️ Cupom</span><span id="cart-desconto">- R$ 0,00</span></div>
        <div class="cart-total-row" id="ifood-custo-row" style="display:none;color:var(--danger);font-size:11px;"><span>⚠️ Custo loja iFood</span><span id="ifood-custo-val">R$ 0,00</span></div>
        <div class="cart-total-row" id="delivery-taxa-row" style="display:none;color:var(--delivery);"><span>🛵 Taxa de entrega</span><span id="cart-taxa-entrega">R$ 0,00</span></div>
        <div class="cart-total-row main"><span>TOTAL</span><span id="cart-total">R$ 0,00</span></div>
        <div style="border-top:1px dashed var(--border);margin-top:8px;padding-top:8px;">
          <div class="cart-total-row" style="font-size:11px;color:var(--text3);"><span>🧾 Custo estimado</span><span id="cart-custo-est">R$ 0,00</span></div>
          <div class="cart-total-row" style="font-size:12px;font-weight:600;"><span>💰 Lucro previsto</span><span id="cart-lucro-est" style="color:var(--success);">R$ 0,00</span></div>
        </div>
        <div style="margin-top:10px;">
          <div style="display:flex;gap:6px;margin-bottom:8px;align-items:flex-end;">
            <div class="form-group" style="flex:1;margin:0;"><label>Cupom de Desconto</label><input type="text" id="cupom-input" placeholder="Código do cupom" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()"></div>
            <button class="btn btn-outline btn-sm" style="padding:9px 12px;" onclick="aplicarCupom()">Aplicar</button>
          </div>
          <div id="cupom-status" style="font-size:11px;margin-bottom:8px;display:none;"></div>
          <div class="form-group" style="margin-bottom:8px;" id="pagamento-wrap">
            <label>Forma de Pagamento</label>
            <select id="cart-pagamento" onchange="calcTroco()">
              <option value="dinheiro">💵 Dinheiro</option>
              <option value="cartao_credito">💳 Crédito</option>
              <option value="cartao_debito">💳 Débito</option>
              <option value="vale_refeicao">🍽️ VR — Vale Refeição</option>
              <option value="vale_alimentacao">🛒 VA — Vale Alimentação</option>
              <option value="pix">📱 Pix</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:8px;" id="troco-wrap"><label>Valor Recebido (R$)</label><input type="number" id="cart-recebido" placeholder="Ex: 20.00" oninput="calcTroco()"></div>
          <div id="troco-display" style="font-size:13px;margin-bottom:8px;display:none;padding:6px 10px;border-radius:6px;background:var(--bg3);"></div>
          <div class="form-group" style="margin-bottom:8px;"><label>Observação do Pedido</label><textarea id="cart-obs" placeholder="Ex: sem cebola, bem passado..." style="min-height:42px;font-size:12px;"></textarea></div>
          <button class="btn btn-primary" style="width:100%;justify-content:center;padding:11px;margin-bottom:6px;" onclick="finalizarVenda()">✅ Finalizar Venda</button>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">
            <button class="btn btn-outline" style="justify-content:center;font-size:12px;" onclick="imprimirPedido()">🖨️ Imprimir</button>
            <button class="btn btn-outline" style="justify-content:center;font-size:12px;" onclick="limparCarrinho()">🗑️ Limpar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- DELIVERY -->
<section class="page" id="page-delivery">
  <div class="page-header"><div class="header-row"><div><h2>Delivery</h2><p>Pedidos de hoje</p></div><button class="btn btn-primary" onclick="nav('vendas');setChannel('delivery')">➕ Novo Pedido</button></div></div>
  <div class="tabs" style="margin-bottom:14px;">
    <button class="tab-btn active" id="del-tab-pedidos" onclick="setDeliveryTab('pedidos',this)">📋 Pedidos</button>
    <button class="tab-btn" id="del-tab-motoboy" onclick="setDeliveryTab('motoboy',this)">🏍️ Motoboy</button>
  </div>
  <div class="cards-grid" style="grid-template-columns:repeat(4,1fr);">
    <div class="stat-card"><div class="stat-label">Aguardando</div><div class="stat-value gold" id="del-aguardando">0</div></div>
    <div class="stat-card"><div class="stat-label">Em Rota</div><div class="stat-value" id="del-rota" style="color:var(--delivery);">0</div></div>
    <div class="stat-card green"><div class="stat-label">Entregues</div><div class="stat-value green" id="del-entregues">0</div></div>
    <div class="stat-card ifood"><div class="stat-label">iFood</div><div class="stat-value ifood" id="del-ifood">0</div></div>
  </div>
  <div id="del-panel-pedidos">
    <div id="delivery-tbody"></div>
  </div>
  <div id="del-panel-motoboy" style="display:none;">
    <div class="cards-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:14px;">
      <div class="stat-card gold"><div class="stat-label">Total Entregas</div><div class="stat-value gold" id="mb-total-entregas">0</div></div>
      <div class="stat-card green"><div class="stat-label">Valor a Repassar</div><div class="stat-value green" id="mb-valor-repasse">R$ 0,00</div></div>
      <div class="stat-card"><div class="stat-label">Taxa Média</div><div class="stat-value" id="mb-taxa-media">R$ 0,00</div></div>
    </div>
    <div class="config-section" style="margin-bottom:14px;">
      <h3 style="margin-bottom:12px;">⚙️ Configurar Motoboy</h3>
      <div class="form-grid">
        <div class="form-group"><label>Nome do Motoboy</label><input type="text" id="mb-nome" placeholder="Ex: João" oninput="renderMotoboy()"></div>
        <div class="form-group"><label>Taxa por entrega (R$)</label><input type="number" id="mb-taxa-fixa" value="0" step="0.50" oninput="renderMotoboy()" placeholder="0 = usa taxa do pedido"></div>
      </div>
    </div>
    <div class="table-wrap">
      <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
        <span style="font-size:13px;font-weight:600;color:var(--text2);">🏍️ Entregas do Dia</span>
        <button class="btn btn-outline btn-sm" onclick="imprimirFechamentoMotoboy()">🖨️ Imprimir Fechamento</button>
      </div>
      <table><thead><tr><th>Hora</th><th>Cliente</th><th>Endereço</th><th>Itens</th><th>Taxa</th><th>Total Pedido</th></tr></thead>
      <tbody id="mb-tbody"></tbody></table>
      <div style="padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
        <span style="font-size:13px;color:var(--text2);">Total a repassar ao motoboy:</span>
        <span style="font-size:18px;font-weight:700;color:var(--gold);" id="mb-total-display">R$ 0,00</span>
      </div>
    </div>
  </div>
</section>

<!-- CLIENTES -->
<section class="page" id="page-clientes">
  <div class="page-header"><div class="header-row"><div><h2>Clientes</h2></div><button class="btn btn-primary" onclick="abrirNovoCliente()">➕ Novo Cliente</button></div></div>
  <div class="search-bar"><input class="search-input" placeholder="🔍 Buscar por nome, telefone ou bairro..." id="clientes-search" oninput="renderClientes()"></div>
  <div class="client-grid" id="clientes-grid"><div class="empty-state" style="grid-column:1/-1;">Nenhum cliente cadastrado</div></div>
</section>

<!-- ESTOQUE -->
<section class="page" id="page-estoque">
  <div class="page-header"><div class="header-row"><div><h2>Estoque</h2></div><button class="btn btn-primary" onclick="abrirModalEstoque()">➕ Atualizar</button></div></div>
  <div class="search-bar">
    <input class="search-input" placeholder="🔍 Buscar ingrediente..." id="estoque-search" oninput="filterEstoque()">
    <select id="estoque-filter" onchange="filterEstoque()" style="background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:9px 11px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;">
      <option value="todos">Todos</option><option value="critico">⚠️ Crítico</option><option value="baixo">🟡 Baixo</option><option value="ok">✅ OK</option>
    </select>
  </div>
  <div class="table-wrap"><table><thead><tr><th>Ingrediente</th><th>Sistema</th><th>Físico</th><th>Divergência</th><th>Unidade</th><th>Situação</th><th>Ações</th></tr></thead><tbody id="estoque-tbody"></tbody></table></div>
</section>

<!-- ENTRADAS -->
<section class="page" id="page-entradas">
  <div class="page-header"><div class="header-row"><div><h2>Entradas</h2><p>Compras e abastecimento</p></div><button class="btn btn-primary" onclick="openModal('modal-entrada')">➕ Registrar Compra</button></div></div>
  <div id="alertas-estoque-banner" style="display:none;background:rgba(192,80,80,0.1);border:1px solid rgba(192,80,80,0.3);border-radius:10px;padding:12px 16px;margin-bottom:14px;font-size:13px;color:var(--danger);"></div>
  <div class="table-wrap"><table><thead><tr><th>Data</th><th>Ingrediente</th><th>Qtd</th><th>Valor Unit.</th><th>Total</th><th>Fornecedor</th></tr></thead><tbody id="entradas-tbody"></tbody></table></div>
</section>

<!-- CAIXA -->
<section class="page" id="page-caixa">
  <div class="page-header"><div class="header-row"><div><h2>Caixa</h2></div><div style="display:flex;gap:8px;"><button class="btn btn-outline" onclick="openModal('modal-sangria')">📤 Sangria</button><button class="btn btn-primary" onclick="openModal('modal-reforco')">📥 Reforço</button></div></div></div>
  <div class="caixa-header">
    <div><div style="font-size:12px;color:var(--text3);">Saldo atual</div><div class="caixa-valor" id="caixa-saldo">R$ 0,00</div></div>
    <div style="text-align:right;"><div class="stat-sub">Entradas: <span id="caixa-entradas" style="color:var(--success);">R$ 0,00</span></div><div class="stat-sub" style="margin-top:4px;">Saídas: <span id="caixa-saidas" style="color:var(--danger);">R$ 0,00</span></div></div>
  </div>
  <div class="caixa-tabs">
    <button class="caixa-tab active" onclick="filtrarCaixa('tudo',this)">Tudo</button>
    <button class="caixa-tab" onclick="filtrarCaixa('entrada',this)">📥 Entradas</button>
    <button class="caixa-tab" onclick="filtrarCaixa('saida',this)">📤 Saídas</button>
    <button class="caixa-tab" onclick="filtrarCaixa('hoje',this)">Hoje</button>
  </div>
  <div class="table-wrap"><table><thead><tr><th>Data/Hora</th><th>Tipo</th><th>Descrição</th><th>Canal</th><th>Valor</th><th>Pgto</th></tr></thead><tbody id="caixa-tbody"></tbody></table></div>
</section>

<!-- RELATÓRIOS -->
<section class="page" id="page-relatorios">
  <div class="page-header"><div class="header-row"><div><h2>Relatórios</h2></div><div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;"><button class="btn btn-outline btn-sm" onclick="abrirFechamentoIfood()" style="border-color:rgba(234,29,44,0.5);color:var(--ifood);">🔴 Fechamento iFood</button><select id="rel-periodo" onchange="gerarRelatorio()" style="background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:9px 11px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;"><option value="hoje">Hoje</option><option value="semana">Essa semana</option><option value="mes">Esse mês</option><option value="tudo">Tudo</option></select></div></div></div>
  <div class="cards-grid" id="rel-cards"></div>
  <div class="two-col" style="margin-top:14px;">
    <div class="table-wrap"><div style="padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text2);">📊 Vendas por Canal</div><div style="padding:16px;" id="rel-canais"></div></div>
    <div class="table-wrap"><div style="padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text2);">💳 Formas de Pagamento</div><div style="padding:16px;" id="rel-pagamentos"></div></div>
  </div>
  <div style="margin-top:14px;" class="table-wrap"><div style="padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text2);">🏆 Ranking de Produtos</div><div style="padding:16px;" id="rel-ranking"></div></div>
  <div style="margin-top:14px;" class="table-wrap">
    <div style="padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
      <span style="font-size:13px;font-weight:600;color:var(--text2);">🔴 iFood por Loja</span>
      <span style="font-size:11px;color:var(--text3);">Mensalidade: R$120 quando faturar acima de R$1.000/mês por loja</span>
    </div>
    <div style="padding:16px;" id="rel-ifood-lojas"></div>
  </div>
</section>

<!-- CARDÁPIO -->
<section class="page" id="page-produtos">
  <div class="page-header">
    <div class="header-row">
      <div><h2>Cardápio</h2><p>Produtos, preços e receitas</p></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn btn-outline" onclick="openModal('modal-nova-categoria')">➕ Categoria</button>
        <button class="btn btn-primary" onclick="openModal('modal-novo-produto')">➕ Produto</button>
      </div>
    </div>
  </div>
  <div class="tabs" id="cardapio-tabs"></div>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Produto</th><th>Preço</th><th>Custo</th><th>Margem</th><th>Estoque</th><th>Ações</th></tr></thead>
      <tbody id="cardapio-tbody"></tbody>
    </table>
  </div>
</section>

<!-- CONFIG -->
<section class="page" id="page-config">
  <div class="page-header"><h2>Configurações</h2></div>
  <div class="config-section"><h3>🏪 Dados da Loja</h3>
    <div class="form-grid">
      <div class="form-group"><label>Nome</label><input type="text" id="config-nome" value="Point do Pastel" oninput="salvarConfig()"></div>
      <div class="form-group"><label>Telefone / WhatsApp</label><input type="text" id="config-tel" placeholder="(11) 99999-9999" oninput="salvarConfig()"></div>
      <div class="form-group" style="grid-column:span 2;"><label>Endereço</label><input type="text" id="config-endereco" oninput="salvarConfig()"></div>
      <div class="form-group" style="grid-column:span 2;"><label>Chave PIX</label><input type="text" id="config-pix" value="41.918.705/0001-70 — Vivian de Souza Honorato" oninput="salvarConfig()"></div>
    </div>
  </div>
  <div class="config-section" style="border-color:rgba(192,80,80,0.3);">
    <h3 style="color:var(--danger);">🗑️ Dados de Teste</h3>
    <p style="font-size:13px;color:var(--text2);margin-bottom:12px;">Remove todas as vendas, movimentos de caixa e entradas. Mantém clientes, estoque, cupons e configurações.</p>
    <button class="btn btn-danger" onclick="resetarDados()">🗑️ Limpar Dados de Teste</button>
  </div>
  <div class="config-section"><h3>🛵 Delivery</h3>
    <div class="form-grid"><div class="form-group"><label>Taxa padrão (R$)</label><input type="number" id="config-delivery-taxa" value="5.00" step="0.50" oninput="salvarConfig()"></div></div>
    <p style="font-size:12px;color:var(--text3);margin-top:8px;">ℹ️ iFood: preços já incluem custo da taxa. Nenhum desconto aplicado.</p>
  </div>
</section>

<!-- CUPONS -->
<section class="page" id="page-cupons">
  <div class="page-header"><div class="header-row"><div><h2>Cupons de Desconto</h2><p>Crie e gerencie cupons para seus clientes</p></div><button class="btn btn-primary" onclick="openModal('modal-novo-cupom')">➕ Novo Cupom</button></div></div>
  <div class="cards-grid" style="grid-template-columns:repeat(4,1fr);">
    <div class="stat-card gold"><div class="stat-label">Total Cupons</div><div class="stat-value gold" id="cup-total">0</div></div>
    <div class="stat-card green"><div class="stat-label">Ativos</div><div class="stat-value green" id="cup-ativos">0</div></div>
    <div class="stat-card"><div class="stat-label">Usados</div><div class="stat-value" id="cup-usados">0</div></div>
    <div class="stat-card red"><div class="stat-label">Desconto Total</div><div class="stat-value red" id="cup-desconto-total">R$ 0</div></div>
  </div>
  <div class="table-wrap"><table>
    <thead><tr><th>Código</th><th>Tipo</th><th>Desconto</th><th>Validade</th><th>Uso</th><th>Cliente</th><th>Status</th><th>Ações</th></tr></thead>
    <tbody id="cupons-tbody"></tbody>
  </table></div>
</section>
</main>

<!-- ═══════════ MODALS ═══════════ -->

<!-- CLIENTE -->
<div class="modal-overlay" id="modal-cliente" onclick="if(event.target===this)closeModal('modal-cliente')">
  <div class="modal"><h3>👤 <span id="modal-cliente-title">Novo Cliente</span></h3>
    <input type="hidden" id="cli-edit-id">
    <div class="form-grid">
      <div class="form-group"><label>Nome *</label><input type="text" id="cli-nome" placeholder="Nome completo"></div>
      <div class="form-group"><label>Telefone / WhatsApp</label><input type="text" id="cli-tel" placeholder="(11) 99999-9999"></div>
      <div class="form-group" style="grid-column:span 2;"><label>Endereço</label><input type="text" id="cli-end" placeholder="Rua, número, complemento"></div>
      <div class="form-group"><label>Bairro</label><input type="text" id="cli-bairro"></div>
      <div class="form-group"><label>CEP</label><input type="text" id="cli-cep"></div>
      <div class="form-group"><label>Taxa de Entrega (R$)</label><input type="number" id="cli-taxa" step="0.50"></div>
      <div class="form-group"><label>Observações</label><textarea id="cli-obs" placeholder="Preferências, alergias..."></textarea></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('modal-cliente')">Cancelar</button><button class="btn btn-primary" onclick="salvarCliente()">Salvar</button></div>
  </div>
</div>

<!-- CLIENTE DETALHE -->
<div class="modal-overlay" id="modal-cliente-detalhe" onclick="if(event.target===this)closeModal('modal-cliente-detalhe')">
  <div class="modal" id="modal-cliente-detalhe-content"></div>
</div>

<!-- ESTOQUE -->
<div class="modal-overlay" id="modal-estoque" onclick="if(event.target===this)closeModal('modal-estoque')">
  <div class="modal"><h3 id="modal-est-title">📦 Atualizar Estoque</h3>
    <input type="hidden" id="est-ingrediente">
    <div class="form-group" style="margin-bottom:6px;">
      <label>Ingrediente</label>
      <div id="est-nome-display" style="padding:8px 10px;background:var(--bg3);border-radius:8px;font-weight:600;color:var(--gold);">—</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px;">
      <div class="form-group">
        <label>Estoque atual (sistema)</label>
        <div id="est-atual-display" style="padding:8px 10px;background:var(--bg3);border-radius:8px;color:var(--text2);">—</div>
      </div>
      <div class="form-group">
        <label>Preço de compra (R$/un)</label>
        <input type="number" id="est-preco" step="0.01" min="0" placeholder="0,00">
      </div>
    </div>
    <div style="background:var(--bg3);border-radius:10px;padding:12px;margin-bottom:8px;">
      <div style="font-size:12px;font-weight:600;color:var(--text2);margin-bottom:8px;">Como deseja atualizar?</div>
      <div style="display:flex;gap:6px;margin-bottom:10px;">
        <button id="est-btn-definir" class="btn btn-primary btn-sm" onclick="setModoEstoque('definir')" style="flex:1;">📌 Definir quantidade</button>
        <button id="est-btn-adicionar" class="btn btn-outline btn-sm" onclick="setModoEstoque('adicionar')" style="flex:1;">➕ Adicionar ao estoque</button>
      </div>
      <div id="est-modo-label" style="font-size:12px;color:var(--text3);margin-bottom:6px;">Ex: comprei 5kg hoje, defina o total atual</div>
      <input type="number" id="est-qtd" step="0.001" min="0" placeholder="0.000" style="width:100%;background:var(--bg2);border:1px solid var(--border);color:var(--text);padding:10px;border-radius:8px;font-size:14px;outline:none;box-sizing:border-box;">
    </div>
    <div class="form-group">
      <label>Estoque mínimo (alerta)</label>
      <input type="number" id="est-minimo" step="0.1" min="0" placeholder="0">
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-estoque')">Cancelar</button>
      <button class="btn btn-primary" onclick="atualizarEstoque()">Salvar</button>
    </div>
  </div>
</div>

<!-- ENTRADA -->
<div class="modal-overlay" id="modal-entrada" onclick="if(event.target===this)closeModal('modal-entrada')">
  <div class="modal"><h3>📥 Registrar Compra</h3>
    <div class="form-grid">
      <div class="form-group" style="grid-column:span 2;"><label>Ingrediente</label><select id="ent-ingrediente" onchange="autoFillPreco()"></select></div>
      <div class="form-group"><label>Quantidade</label><input type="number" id="ent-qtd" min="0.1" step="0.1"></div>
      <div class="form-group"><label>Valor Unitário (R$)</label><input type="number" id="ent-preco" step="0.01"></div>
      <div class="form-group" style="grid-column:span 2;"><label>Fornecedor (opcional)</label><input type="text" id="ent-fornecedor"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('modal-entrada')">Cancelar</button><button class="btn btn-primary" onclick="registrarEntrada()">Registrar</button></div>
  </div>
</div>

<!-- SANGRIA -->
<div class="modal-overlay" id="modal-sangria" onclick="if(event.target===this)closeModal('modal-sangria')">
  <div class="modal"><h3>📤 Sangria de Caixa</h3>
    <div class="form-grid">
      <div class="form-group"><label>Valor (R$)</label><input type="number" id="sangria-valor" step="0.01"></div>
      <div class="form-group"><label>Motivo</label><input type="text" id="sangria-motivo"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('modal-sangria')">Cancelar</button><button class="btn btn-danger" onclick="registrarSangria()">Confirmar</button></div>
  </div>
</div>

<!-- REFORÇO -->
<div class="modal-overlay" id="modal-reforco" onclick="if(event.target===this)closeModal('modal-reforco')">
  <div class="modal"><h3>📥 Reforço de Caixa</h3>
    <div class="form-grid">
      <div class="form-group"><label>Valor (R$)</label><input type="number" id="reforco-valor" step="0.01"></div>
      <div class="form-group"><label>Origem</label><input type="text" id="reforco-origem"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('modal-reforco')">Cancelar</button><button class="btn btn-primary" onclick="registrarReforco()">Confirmar</button></div>
  </div>
</div>

<!-- NOVO CUPOM -->
<div class="modal-overlay" id="modal-novo-cupom" onclick="if(event.target===this)closeModal('modal-novo-cupom')">
  <div class="modal"><h3>🏷️ Novo Cupom</h3>
    <div class="form-grid">
      <div class="form-group"><label>Código *</label><input type="text" id="cup-codigo" placeholder="Ex: PROMO10" style="text-transform:uppercase;" oninput="this.value=this.value.toUpperCase().replace(/\s/g,'')"></div>
      <div class="form-group"><label>Tipo de Desconto</label>
        <select id="cup-tipo" onchange="toggleCupomTipo()">
          <option value="percentual">% Percentual</option>
          <option value="fixo">R$ Valor Fixo</option>
          <option value="frete">🛵 Frete Grátis</option>
        </select>
      </div>
      <div class="form-group" id="cup-valor-wrap"><label id="cup-valor-label">Desconto (%)</label><input type="number" id="cup-valor" min="1" max="100" placeholder="Ex: 10"></div>
      <div class="form-group"><label>Usos Máximos</label><input type="number" id="cup-usos" placeholder="Vazio = ilimitado" min="1"></div>
      <div class="form-group"><label>Validade (opcional)</label><input type="date" id="cup-validade"></div>
      <div class="form-group"><label>Valor Mínimo do Pedido (R$)</label><input type="number" id="cup-minimo" placeholder="0 = sem mínimo" min="0" step="0.50"></div>
      <div class="form-group" style="grid-column:span 2;"><label>Cliente específico (opcional)</label>
        <select id="cup-cliente"><option value="">Qualquer cliente</option></select>
      </div>
      <div class="form-group" style="grid-column:span 2;"><label>Observação</label><input type="text" id="cup-obs" placeholder="Ex: Aniversário da Maria"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('modal-novo-cupom')">Cancelar</button><button class="btn btn-primary" onclick="salvarCupom()">Criar Cupom</button></div>
  </div>
</div>

<!-- NOVA CATEGORIA -->
<div class="modal-overlay" id="modal-nova-categoria" onclick="if(event.target===this)closeModal('modal-nova-categoria')">
  <div class="modal"><h3>➕ Nova Categoria</h3>
    <div class="form-group"><label>Nome da Categoria *</label><input type="text" id="nova-cat-nome" placeholder="Ex: Especiais Doces"></div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-nova-categoria')">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarNovaCategoria()">Criar</button>
    </div>
  </div>
</div>

<!-- NOVO PRODUTO -->
<div class="modal-overlay" id="modal-novo-produto" onclick="if(event.target===this)closeModal('modal-novo-produto')">
  <div class="modal"><h3 id="modal-prod-title">➕ Novo Produto</h3>
    <input type="hidden" id="prod-edit-id">
    <div class="form-grid">
      <div class="form-group"><label>Nome *</label><input type="text" id="prod-nome" placeholder="Ex: Carne com Queijo"></div>
      <div class="form-group"><label>Categoria *</label>
        <select id="prod-categoria"></select>
      </div>
      <div class="form-group"><label>Preço de Venda (R$) *</label><input type="number" id="prod-preco" step="0.50" min="0" placeholder="0,00"></div>
      <div class="form-group"><label>Custo Estimado (R$)</label><input type="number" id="prod-custo" step="0.01" min="0" placeholder="0,00"></div>
    </div>
    <div class="form-group" style="margin-top:4px;">
      <label>Estoque atual (unidades, opcional)</label>
      <input type="number" id="prod-estoque" min="0" placeholder="Deixe vazio = sem controle de unidades">
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-novo-produto')">Cancelar</button>
      <button class="btn btn-primary" onclick="salvarProduto()">Salvar</button>
    </div>
  </div>
</div>

<!-- RECEITA DO PRODUTO -->
<div class="modal-overlay" id="modal-receita" onclick="if(event.target===this)closeModal('modal-receita')">
  <div class="modal" style="max-width:520px;"><h3>🧾 Receita — <span id="receita-prod-nome"></span></h3>
    <p style="font-size:12px;color:var(--text3);margin-bottom:12px;">Defina os ingredientes usados neste produto. O estoque será descontado automaticamente a cada venda.</p>
    <input type="hidden" id="receita-prod-id">
    <div id="receita-ingredientes-lista" style="margin-bottom:12px;"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:8px;align-items:end;margin-bottom:12px;">
      <div class="form-group" style="margin:0;"><label>Ingrediente</label>
        <select id="rec-ing-sel">
          <option value="">— Selecionar —</option>
        </select>
      </div>
      <div class="form-group" style="margin:0;"><label>Quantidade usada</label>
        <input type="number" id="rec-ing-qty" step="0.001" min="0" placeholder="Ex: 0.150">
      </div>
      <button class="btn btn-primary btn-sm" onclick="addIngredienteReceita()" style="padding:9px 12px;">＋</button>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-receita')">Fechar</button>
      <button class="btn btn-primary" onclick="salvarReceita()">Salvar Receita</button>
    </div>
  </div>
</div>

<!-- FECHAMENTO SEMANAL IFOOD -->
<div class="modal-overlay" id="modal-fechamento-ifood" onclick="if(event.target===this)closeModal('modal-fechamento-ifood')">
  <div class="modal" style="max-width:600px;"><h3>🔴 Fechamento Semanal iFood</h3>
    <div style="display:flex;gap:8px;margin-bottom:14px;align-items:flex-end;flex-wrap:wrap;">
      <div class="form-group" style="margin:0;"><label>Semana de</label><input type="date" id="fif-inicio"></div>
      <div class="form-group" style="margin:0;"><label>até</label><input type="date" id="fif-fim"></div>
      <button class="btn btn-primary btn-sm" onclick="calcFechamentoIfood()">Calcular</button>
    </div>
    <div id="fif-resultado"></div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-fechamento-ifood')">Fechar</button>
      <button class="btn btn-primary" onclick="imprimirFechamentoIfood()">🖨️ Imprimir</button>
    </div>
  </div>
</div>

<!-- EDITAR PRODUTO CARDÁPIO -->
<div class="modal-overlay" id="modal-editar-produto" onclick="if(event.target===this)closeModal('modal-editar-produto')">
  <div class="modal"><h3>✏️ Editar Produto</h3>
    <input type="hidden" id="edit-prod-id"><input type="hidden" id="edit-prod-cat">
    <div style="margin-bottom:12px;font-size:13px;color:var(--text2);" id="edit-prod-nome-label"></div>
    <div class="form-grid">
      <div class="form-group"><label>Preço de Venda (R$)</label><input type="number" id="edit-prod-preco" step="0.50"></div>
      <div class="form-group"><label>Custo Estimado (R$)</label><input type="number" id="edit-prod-custo" step="0.01"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('modal-editar-produto')">Cancelar</button><button class="btn btn-primary" onclick="salvarEdicaoProduto()">Salvar</button></div>
  </div>
</div>

<!-- ADICIONAR AO CARRINHO (modal de configuração do item) -->
<div class="modal-overlay" id="modal-add-item" onclick="if(event.target===this)closeModal('modal-add-item')">
  <div class="modal" id="modal-add-item-content"></div>
</div>
<script>

// ═══════════════════════════════
// MENU LATERAL RESPONSIVO
// ═══════════════════════════════
function toggleSidebar(){
  const sb = document.getElementById('sidebar');
  const ov = document.getElementById('sidebar-overlay');
  const cl = document.getElementById('sidebar-close');
  const isMobile = window.innerWidth <= 768;
  if(isMobile){
    sb.classList.toggle('open');
    ov.classList.toggle('open');
    if(cl) cl.style.display = sb.classList.contains('open') ? 'block' : 'none';
  } else {
    sb.classList.toggle('collapsed');
    document.querySelector('.main').classList.toggle('full');
  }
}
function closeSidebar(){
  const sb = document.getElementById('sidebar');
  const ov = document.getElementById('sidebar-overlay');
  const cl = document.getElementById('sidebar-close');
  sb.classList.remove('open');
  ov.classList.remove('open');
  if(cl) cl.style.display = 'none';
}
// closeSidebar chamado diretamente na nav (ver função nav abaixo)

// ═══════════════════════════════
// FIREBASE REST API (sem CDN)
// ═══════════════════════════════
const FB_PROJECT = 'point-do-pastel-1';
const FB_APIKEY  = 'AIzaSyCeO6Ki9h7lJt5gBb6WLQikSn7rJj0kzg0';
const FB_BASE    = `https://firestore.googleapis.com/v1/projects/${FB_PROJECT}/databases/(default)/documents/pdp`;

let firebaseOnline = false;
let _pollTimers = {};

function showSyncStatus(online){
  firebaseOnline = online;
  const el = document.getElementById('sync-status');
  if(!el) return;
  el.textContent = online ? '☁️ Online' : '💾 Offline';
  el.style.color  = online ? 'var(--success)' : 'var(--gold)';
}

// Converte valor JS → Firestore field value
function toFV(v){
  if(v===null||v===undefined) return {nullValue:null};
  if(typeof v==='boolean') return {booleanValue:v};
  if(typeof v==='number')  return {doubleValue:v};
  if(typeof v==='string')  return {stringValue:v};
  if(Array.isArray(v))     return {arrayValue:{values:v.map(toFV)}};
  if(typeof v==='object')  return {mapValue:{fields:Object.fromEntries(Object.entries(v).map(([k,vv])=>[k,toFV(vv)]))}};
  return {stringValue:String(v)};
}

// Converte Firestore field value → valor JS
function fromFV(fv){
  if(!fv) return null;
  if('nullValue'    in fv) return null;
  if('booleanValue' in fv) return fv.booleanValue;
  if('integerValue' in fv) return Number(fv.integerValue);
  if('doubleValue'  in fv) return fv.doubleValue;
  if('stringValue'  in fv) return fv.stringValue;
  if('arrayValue'   in fv) return (fv.arrayValue.values||[]).map(fromFV);
  if('mapValue'     in fv) return Object.fromEntries(Object.entries(fv.mapValue.fields||{}).map(([k,v])=>[k,fromFV(v)]));
  return null;
}

async function fbSave(colecao, dados){
  try{
    const url = `${FB_BASE}/${colecao}?key=${FB_APIKEY}`;
    // Use PATCH to create or update
    const body = {fields:{ dados:{stringValue:JSON.stringify(dados)}, ts:{doubleValue:Date.now()} }};
    const r = await fetch(
      `https://firestore.googleapis.com/v1/projects/${FB_PROJECT}/databases/(default)/documents/pdp/${colecao}?key=${FB_APIKEY}`,
      {method:'PATCH', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)}
    );
    if(!r.ok) throw new Error(await r.text());
  } catch(e){ console.warn('fbSave error:', colecao, e.message); }
}

async function fbLoad(colecao){
  try{
    const r = await fetch(
      `https://firestore.googleapis.com/v1/projects/${FB_PROJECT}/databases/(default)/documents/pdp/${colecao}?key=${FB_APIKEY}`
    );
    if(r.status===404) return null;
    if(!r.ok) throw new Error(await r.text());
    const doc = await r.json();
    if(doc.fields && doc.fields.dados){
      return JSON.parse(doc.fields.dados.stringValue);
    }
  } catch(e){ console.warn('fbLoad error:', colecao, e.message); }
  return null;
}

// Polling a cada 8s para simular tempo real (REST não suporta WebSocket)
function fbListen(colecao, callback){
  let lastTs = 0;
  const poll = async () => {
    try{
      const r = await fetch(
        `https://firestore.googleapis.com/v1/projects/${FB_PROJECT}/databases/(default)/documents/pdp/${colecao}?key=${FB_APIKEY}`
      );
      if(!r.ok) return;
      const doc = await r.json();
      if(doc.fields && doc.fields.ts){
        const ts = doc.fields.ts.doubleValue || Number(doc.fields.ts.integerValue) || 0;
        if(ts > lastTs){
          lastTs = ts;
          if(doc.fields.dados) callback(JSON.parse(doc.fields.dados.stringValue));
        }
      }
    } catch(e){}
  };
  poll();
  _pollTimers[colecao] = setInterval(poll, 8000);
}
</script>

<script>
// ═══════════════════════════════
// DADOS DO CARDÁPIO
// ═══════════════════════════════
const PASTEIS_SIMPLES = [
  'Carne','Frango','Mussarela','Calabresa','Pizza','Bauru',
  'Carne c/ Mussarela','Carne c/ Ovo','Frango c/ Catupiry','Frango c/ Cheddar',
  'Calabresa c/ Mussarela','2 Queijos','Portuguesa','Brócolis c/ Bacon',
  'Pastel Hot Dog','Strogonoff','Carne Louca','Camarão c/ Mussarela',
  'Escondidinho de Carne','Escondidinho de Frango'
];

const ADICIONAIS_ACAI = [
  {id:'aad1',nome:'Nutella',preco:12,custo:3},
  {id:'aad2',nome:'Kit Kat',preco:6,custo:2},
  {id:'aad3',nome:'Ovomaltine',preco:6,custo:1.5},
  {id:'aad4',nome:'Brigadeiros',preco:5,custo:1.5},
  {id:'aad5',nome:'Granola',preco:3,custo:0.8},
  {id:'aad6',nome:'Leite condensado',preco:2,custo:0.5},
];

const ADICIONAIS_CALDO = [
  {id:'cad1',nome:'Gelo',preco:0,custo:0},
  {id:'cad2',nome:'Limão',preco:0,custo:0.2},
  {id:'cad3',nome:'Abacaxi',preco:1,custo:0.5},
  {id:'cad4',nome:'Gengibre',preco:0,custo:0.2},
];

const ADICIONAIS_PASTEL = [
  {id:'pad1',nome:'Milho',preco:3,custo:0.5},
  {id:'pad2',nome:'Tomate',preco:3,custo:0.5},
  {id:'pad3',nome:'Azeitona',preco:3,custo:0.8},
  {id:'pad4',nome:'Ovo',preco:3,custo:0.7},
  {id:'pad5',nome:'Cheddar extra',preco:3,custo:1},
  {id:'pad6',nome:'Bacon extra',preco:5,custo:1.5},
  {id:'pad7',nome:'Mussarela extra',preco:5,custo:1.5},
  {id:'pad8',nome:'Catupiry extra',preco:5,custo:1.5},
];

const TAMANHOS_ACAI = [
  {id:'300ml',nome:'300ml',preco:19,custo:4.26},
  {id:'500ml',nome:'500ml',preco:22,custo:7.10},
  {id:'700ml',nome:'700ml',preco:27,custo:9.94},
];

const TAMANHOS_CALDO = [
  {id:'cc300',nome:'300ml',preco:10,custo:1.5},
  {id:'cc500',nome:'500ml',preco:14,custo:2.5},
  {id:'cc1L',nome:'1 Litro',preco:20,custo:4},
];

let CATEGORIAS_DATA = {
  'Trad. Salgados':[
    {id:'ts1',nome:'Carne',preco:15,custo:3.83},{id:'ts2',nome:'Frango',preco:15,custo:3.31},
    {id:'ts3',nome:'Mussarela',preco:15,custo:3.49},{id:'ts4',nome:'Calabresa',preco:15,custo:3.19},
    {id:'ts5',nome:'Pizza',preco:15,custo:3.74},{id:'ts6',nome:'Bauru',preco:15,custo:5.50},
  ],
  '2 Recheios':[
    {id:'r1',nome:'Carne c/ Mussarela',preco:17,custo:6.53},{id:'r2',nome:'Carne c/ Ovo',preco:17,custo:4.58},
    {id:'r3',nome:'Carne c/ Azeitona',preco:17,custo:4.13},{id:'r4',nome:'Frango c/ Catupiry',preco:17,custo:4.98},
    {id:'r5',nome:'Frango c/ Cheddar',preco:17,custo:4.56},{id:'r6',nome:'Calabresa c/ Mussarela',preco:17,custo:4.54},
    {id:'r7',nome:'Calabresa c/ Cheddar',preco:17,custo:4.44},{id:'r8',nome:'2 Queijos',preco:17,custo:5.16},
  ],
  'Novidades R$19':[
    {id:'n1',nome:'Strogonoff',preco:19,custo:7.50},{id:'n2',nome:'Lasanha',preco:19,custo:6.78},
    {id:'n3',nome:'Carne Louca',preco:19,custo:6.50},{id:'n4',nome:'Camarão c/ Mussarela',preco:19,custo:9.94},
    {id:'n5',nome:'Camarão c/ Catupiry',preco:19,custo:10.26},{id:'n6',nome:'Camarão c/ Cheddar',preco:19,custo:9.80},
    {id:'n7',nome:'Escondidinho de Carne',preco:19,custo:6.78},{id:'n8',nome:'Escondidinho de Frango',preco:19,custo:6.50},
    {id:'n9',nome:'Escondidinho de Calabresa',preco:19,custo:6.40},{id:'n10',nome:'Mexidão',preco:19,custo:6.20},
  ],
  'Especiais R$19':[
    {id:'e1',nome:'Portuguesa',preco:19,custo:9.72},{id:'e2',nome:'Brócolis c/ Bacon e Mussarela',preco:19,custo:4.82},
    {id:'e3',nome:'Brócolis c/ Bacon e Catupiry',preco:19,custo:5.50},{id:'e4',nome:'Brócolis c/ Bacon e Cheddar',preco:19,custo:5.10},
    {id:'e5',nome:'Pastel Hot Dog',preco:19,custo:6.65},{id:'e6',nome:'Vegetariano',preco:19,custo:4.50},
  ],
  'Especial 30cm':[
    {id:'g1',nome:'Carne 1 — 30cm',preco:30,custo:7.50},{id:'g2',nome:'Carne 2 — 30cm',preco:30,custo:7.80},
    {id:'g3',nome:'Frango — 30cm',preco:30,custo:6.80},{id:'g4',nome:'Calabresa — 30cm',preco:30,custo:7.20},
    {id:'g5',nome:'Portuguesa — 30cm',preco:30,custo:9.50},{id:'g6',nome:'Pizza — 30cm',preco:30,custo:5.50},
  ],
  'Pastéis Doces':[
    {id:'d1',nome:'Chocolate Preto',preco:15,custo:1.29},{id:'d2',nome:'Choc. Preto c/ Morango',preco:15,custo:2.00},
    {id:'d3',nome:'Banana c/ Canela',preco:15,custo:1.94},{id:'d4',nome:'Romeu e Julieta',preco:15,custo:1.40},
    {id:'d5',nome:'Prestígio Trad.',preco:15,custo:1.65},{id:'d6',nome:'Brigadeiro Gourmet',preco:18,custo:2.50},
    {id:'d7',nome:'Brigadeiro c/ Morango',preco:18,custo:3.00},{id:'d8',nome:'Ninho',preco:18,custo:2.50},
    {id:'d9',nome:'Ninho c/ Morango',preco:18,custo:3.00},{id:'d10',nome:'Paçoca',preco:18,custo:2.80},
    {id:'d11',nome:'Beijinho',preco:18,custo:2.60},{id:'d12',nome:'Prestígio Brigadeiro',preco:18,custo:2.80},
  ],
  'Batata Frita':[
    {id:'f1',nome:'Simples P',preco:18,custo:3.35},{id:'f2',nome:'Simples M',preco:21,custo:4.95},{id:'f3',nome:'Simples G',preco:25,custo:7.20},
    {id:'f4',nome:'Cheddar e Bacon P',preco:21,custo:5.50},{id:'f5',nome:'Cheddar e Bacon M',preco:24,custo:7.50},{id:'f6',nome:'Cheddar e Bacon G',preco:28,custo:10.00},
    {id:'f7',nome:'3 Queijos P',preco:21,custo:5.50},{id:'f8',nome:'3 Queijos M',preco:24,custo:7.50},{id:'f9',nome:'3 Queijos G',preco:28,custo:10.00},
    {id:'f10',nome:'Pizza P',preco:21,custo:5.20},{id:'f11',nome:'Pizza M',preco:24,custo:7.20},{id:'f12',nome:'Pizza G',preco:28,custo:10.00},
  ],
  'Hot Dogs':[
    {id:'h1',nome:'Hot Dog Básico',preco:18,custo:5.12},{id:'h2',nome:'Hot Dog Duplo',preco:20,custo:5.66},
    {id:'h3',nome:'Hot Dog Salada',preco:20,custo:5.60},{id:'h4',nome:'Cheddar e Bacon',preco:22,custo:7.08},
  ],
  'Açaí / Sorvete':[
    {id:'ac1',nome:'Açaí / Cupuaçu / Sorvete',preco:19,custo:4.26,tipo:'acai'},
  ],
  'Caldo de Cana':[
    {id:'cc1',nome:'Caldo de Cana',preco:10,custo:1.5,tipo:'caldo'},
  ],
  'Bolo de Pote':[
    {id:'bp1',nome:'Ninho',preco:13,custo:4.00},{id:'bp2',nome:'Ninho c/ Morango',preco:13,custo:4.50},
    {id:'bp3',nome:'Ninho c/ Abacaxi',preco:13,custo:4.30},{id:'bp4',nome:'Brigadeiro',preco:13,custo:3.80},
    {id:'bp5',nome:'Brigadeiro c/ Morango',preco:13,custo:4.30},{id:'bp6',nome:'Brigadeiro c/ Amendoim',preco:13,custo:4.20},
    {id:'bp7',nome:'Prestígio',preco:13,custo:3.90},{id:'bp8',nome:'Paçoca',preco:13,custo:4.10},{id:'bp9',nome:'Beijinho',preco:13,custo:3.90},
  ],
  'Bebidas':[
    {id:'b1',nome:'Suco Natural 500ml',preco:10,custo:2.50},{id:'b2',nome:'Refrigerante Lata',preco:6.50,custo:2.50},
    {id:'b3',nome:'Refrigerante 600ml',preco:8.50,custo:3.00},{id:'b4',nome:'Coca-Cola 1L',preco:11,custo:5.00},
    {id:'b5',nome:'Kuat 2L',preco:10,custo:5.50},{id:'b6',nome:'Fanta 2L',preco:13,custo:6.00},{id:'b7',nome:'Coca-Cola 2,5L',preco:17,custo:9.00},
  ],
  'Combos':[
    {id:'c1',nome:'Casal Simples (2 pastéis trad.)',preco:28,custo:7.00,tipo:'combo',qtdPasteis:2,tiposPasteis:['trad']},
    {id:'c2',nome:'Casal Caprichado (2 pastéis 2 recheios)',preco:32,custo:13.00,tipo:'combo',qtdPasteis:2,tiposPasteis:['2r']},
    {id:'c3',nome:'Casal c/ Caldo (2 trad. + 1L caldo)',preco:45,custo:11.00,tipo:'combo',qtdPasteis:2,tiposPasteis:['trad'],inclui:'1L Caldo de Cana'},
    {id:'c4',nome:'Família (4 pastéis trad.)',preco:54,custo:14.00,tipo:'combo',qtdPasteis:4,tiposPasteis:['trad']},
    {id:'c5',nome:'Pra Galera (6 pastéis trad.)',preco:80,custo:21.00,tipo:'combo',qtdPasteis:6,tiposPasteis:['trad']},
  ],
};

const INGREDIENTES_BASE=[
  {id:'i1',nome:'Massa p/ pastel',unidade:'kg',estoque:5,minimo:3,preco_ref:20},
  {id:'i2',nome:'Carne moída',unidade:'kg',estoque:3,minimo:2,preco_ref:38},
  {id:'i3',nome:'Mussarela',unidade:'kg',estoque:2,minimo:1.5,preco_ref:45},
  {id:'i4',nome:'Frango desfiado',unidade:'kg',estoque:3,minimo:2,preco_ref:18},
  {id:'i5',nome:'Calabresa',unidade:'kg',estoque:2,minimo:1,preco_ref:30},
  {id:'i6',nome:'Catupiry',unidade:'kg',estoque:1,minimo:0.5,preco_ref:60},
  {id:'i7',nome:'Cheddar',unidade:'kg',estoque:1.5,minimo:0.5,preco_ref:25},
  {id:'i8',nome:'Requeijão',unidade:'kg',estoque:1,minimo:0.5,preco_ref:25},
  {id:'i9',nome:'Presunto',unidade:'kg',estoque:1,minimo:0.5,preco_ref:32},
  {id:'i10',nome:'Palmito',unidade:'kg',estoque:0.5,minimo:0.5,preco_ref:51},
  {id:'i11',nome:'Bacon',unidade:'kg',estoque:0.5,minimo:0.3,preco_ref:30},
  {id:'i12',nome:'Camarão',unidade:'kg',estoque:0.5,minimo:0.5,preco_ref:52},
  {id:'i13',nome:'Salsicha',unidade:'kg',estoque:1,minimo:0.5,preco_ref:18},
  {id:'i14',nome:'Pão de Hot Dog',unidade:'pct',estoque:3,minimo:2,preco_ref:7.5},
  {id:'i15',nome:'Batata frita',unidade:'kg',estoque:5,minimo:3,preco_ref:30},
  {id:'i16',nome:'Açaí',unidade:'kg',estoque:3,minimo:2,preco_ref:142},
  {id:'i17',nome:'Chocolate preto',unidade:'kg',estoque:1,minimo:0.5,preco_ref:35},
  {id:'i18',nome:'Chocolate branco',unidade:'kg',estoque:1,minimo:0.5,preco_ref:40},
  {id:'i19',nome:'Doce de leite',unidade:'kg',estoque:1,minimo:0.5,preco_ref:27},
  {id:'i20',nome:'Leite condensado',unidade:'kg',estoque:2,minimo:1,preco_ref:3.5},
  {id:'i21',nome:'Coco ralado',unidade:'kg',estoque:0.5,minimo:0.3,preco_ref:40},
  {id:'i22',nome:'Goiabada',unidade:'kg',estoque:0.5,minimo:0.3,preco_ref:20},
  {id:'i23',nome:'Morango',unidade:'kg',estoque:1,minimo:0.5,preco_ref:7},
  {id:'i24',nome:'Catchup',unidade:'kg',estoque:2,minimo:1,preco_ref:10},
  {id:'i25',nome:'Mostarda',unidade:'kg',estoque:2,minimo:1,preco_ref:10},
  {id:'i26',nome:'Maionese',unidade:'kg',estoque:2,minimo:1,preco_ref:10},
  {id:'i27',nome:'Batata palha',unidade:'kg',estoque:1,minimo:0.5,preco_ref:30},
  {id:'i28',nome:'Milho',unidade:'kg',estoque:2,minimo:1,preco_ref:4.5},
  {id:'i29',nome:'Ovo',unidade:'dz',estoque:2,minimo:1,preco_ref:15},
  {id:'i30',nome:'Óleo de fritura',unidade:'L',estoque:5,minimo:3,preco_ref:8},
  {id:'i31',nome:'Caldo de cana',unidade:'kg',estoque:10,minimo:5,preco_ref:3},
  {id:'i32',nome:'Leite em pó',unidade:'kg',estoque:1,minimo:0.5,preco_ref:30},
  {id:'i33',nome:'Granola',unidade:'kg',estoque:1,minimo:0.3,preco_ref:25},
  {id:'i34',nome:'Amendoim',unidade:'kg',estoque:1,minimo:0.5,preco_ref:15},
  {id:'i35',nome:'Banana',unidade:'kg',estoque:2,minimo:1,preco_ref:4},
  {id:'i36',nome:'Canela em pó',unidade:'kg',estoque:0.3,minimo:0.1,preco_ref:30},
  {id:'i37',nome:'Massa brigadeiro',unidade:'kg',estoque:1,minimo:0.5,preco_ref:15},
  {id:'i38',nome:'Suco (polpa)',unidade:'kg',estoque:3,minimo:1,preco_ref:8},
  {id:'i39',nome:'Refrigerante lata',unidade:'un',estoque:24,minimo:12,preco_ref:2.5},
  {id:'i40',nome:'Azeitona',unidade:'kg',estoque:0.5,minimo:0.2,preco_ref:20},
];

// ═══════════════════════════════
// STATE
// ═══════════════════════════════
let state={vendas:[],entradas:[],caixa:[],estoque:[],clientes:[],pedidosDelivery:[],cupons:[],cardapio_extra:{},receitas:{}};
let config={deliveryTaxa:5,nome:'Point do Pastel',tel:'',endereco:'',pix:'41.918.705/0001-70 — Vivian de Souza Honorato'};
let CATEGORIAS = JSON.parse(JSON.stringify(CATEGORIAS_DATA));
let carrinho=[];
let cupomAtivo=null;
let canal='balcao';
let pdvCat=Object.keys(CATEGORIAS)[0];
let cardapioCat=Object.keys(CATEGORIAS)[0];
let caixaFiltro='tudo';

function loadState(){
  // Load from localStorage first (fast, offline fallback)
  try{
    const s=JSON.parse(localStorage.getItem('pdp_v6')||'{}');
    state.vendas=s.vendas||[];state.entradas=s.entradas||[];state.caixa=s.caixa||[];
    state.estoque=s.estoque||JSON.parse(JSON.stringify(INGREDIENTES_BASE));
    state.clientes=s.clientes||[];state.pedidosDelivery=s.pedidosDelivery||[];state.cupons=s.cupons||[];state.cardapio_extra=s.cardapio_extra||{};state.receitas=s.receitas||{};
    if(s.config)config={...config,...s.config};
    if(s.precos){
      Object.entries(s.precos).forEach(([cat,prods])=>{
        if(CATEGORIAS[cat])prods.forEach(sp=>{const p=CATEGORIAS[cat].find(x=>x.id===sp.id);if(p){p.preco=sp.preco;p.custo=sp.custo;}});
      });
    }
  }catch(e){state.estoque=JSON.parse(JSON.stringify(INGREDIENTES_BASE));}
}

async function loadStateFirebase(){
  try {
    // Load all collections in parallel
    const [vendas,entradas,caixa,estoque,clientes,delivery,cupons,cfg,precos,cex,rec] = await Promise.all([
      fbLoad('vendas'), fbLoad('entradas'), fbLoad('caixa'), fbLoad('estoque'),
      fbLoad('clientes'), fbLoad('pedidosDelivery'), fbLoad('cupons'),
      fbLoad('config'), fbLoad('precos'), fbLoad('cardapio_extra'), fbLoad('receitas')
    ]);
    if(vendas)state.vendas=vendas;
    if(entradas)state.entradas=entradas;
    if(caixa)state.caixa=caixa;
    if(estoque){ state.estoque = estoque && estoque.data ? estoque.data : estoque; }
    if(clientes)state.clientes=clientes;
    if(delivery)state.pedidosDelivery=delivery;
    if(cupons)state.cupons=cupons;
    if(cfg)config={...config,...cfg};
    if(cex)state.cardapio_extra=cex;
    if(rec)state.receitas=rec;
    if(precos){
      Object.entries(precos).forEach(([cat,prods])=>{
        if(CATEGORIAS[cat])prods.forEach(sp=>{const p=CATEGORIAS[cat].find(x=>x.id===sp.id);if(p){p.preco=sp.preco;p.custo=sp.custo;}});
      });
    }
    showSyncStatus(true);
    // Refresh all views
    aplicarConfig();renderPdvTabs();renderPdvProducts();renderEstoque();renderEntradas();
    renderCaixa();renderCardapioTabs();renderCardapio();renderClientes();renderDelivery();
    updateDashboard();renderCupons();renderAlertasEntradas();
    // Start realtime listeners
    startRealtimeListeners();
  } catch(e){
    console.warn('Firebase load failed, using local:', e);
    showSyncStatus(false);
  }
}

function startRealtimeListeners(){
  // Listen to vendas, caixa, delivery in real time (most frequently updated)
  fbListen('vendas', data=>{ state.vendas=data; localStorage.setItem('pdp_v6_vendas', JSON.stringify(data)); updateDashboard(); renderCaixa(); });
  fbListen('clientes', data=>{ state.clientes=data; renderClientes(); });
  fbListen('pedidosDelivery', data=>{ state.pedidosDelivery=data; renderDelivery(); });
  fbListen('cupons', data=>{ state.cupons=data; renderCupons(); });
  fbListen('caixa', data=>{ state.caixa=data; renderCaixa(); updateDashboard(); });
  fbListen('estoque', raw=>{ 
    const data = raw && raw.data ? raw.data : raw;
    const ts = raw && raw.ts ? raw.ts : 0;
    const agora = Date.now();
    const editadoHa = agora - (window._estoqueEditadoEm||0);
    // Só atualiza do Firebase se: não editou nos últimos 30s E Firebase é mais recente que o local
    if(editadoHa > 30000){
      state.estoque = data;
      renderEstoque(); updateDashboard();
    }
  });
}
function saveState(){
  const precos={};
  Object.entries(CATEGORIAS).forEach(([cat,prods])=>{precos[cat]=prods.map(p=>({id:p.id,preco:p.preco,custo:p.custo}));});
  // Save locally always (fast + offline fallback)
  try{localStorage.setItem('pdp_v6',JSON.stringify({...state,config,precos}));}catch(e){}
  if(firebaseOnline){fbSave('cardapio_extra',state.cardapio_extra);fbSave('receitas',state.receitas);}
  // Save to Firebase (async, non-blocking)
  if(firebaseOnline){
    fbSave('vendas', state.vendas);
    fbSave('entradas', state.entradas);
    fbSave('caixa', state.caixa);
    fbSave('estoque', {data: state.estoque, ts: Date.now()});
    fbSave('clientes', state.clientes);
    fbSave('pedidosDelivery', state.pedidosDelivery);
    fbSave('cupons', state.cupons);
    fbSave('config', config);
    fbSave('precos', precos);
  }
}

document.addEventListener('DOMContentLoaded',()=>{
  loadState();
  document.getElementById('dashboard-date').textContent=new Date().toLocaleDateString('pt-BR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  aplicarConfig();renderPdvTabs();renderPdvProducts();renderEstoque();renderEntradas();renderCupons();
  renderCaixa();renderCardapioTabs();renderCardapio();renderClientes();renderDelivery();updateDashboard();
  loadStateFirebase();
});

// ═══════════════════════════════
// HELPERS
// ═══════════════════════════════
function fmtM(v){return 'R$ '+parseFloat(v||0).toFixed(2).replace('.',',');}
function todayISO(){return new Date().toISOString().split('T')[0];}
function fmtDT(iso){const d=new Date(iso);return d.toLocaleDateString('pt-BR')+' '+d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});}
function fmtH(iso){return new Date(iso).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});}
function getAllProducts(){return Object.values(getCategorias()).flat();}
function canalLabel(c){return c==='ifood'?'<span class="badge badge-ifood">🔴 iFood</span>':c==='delivery'?'<span class="badge badge-delivery">🛵 Delivery</span>':'<span class="badge badge-gold">🏪 Balcão</span>';}

// ═══════════════════════════════
// NAV
// ═══════════════════════════════
function nav(page){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  if(window.innerWidth <= 768) closeSidebar();
  const btn=document.querySelector(`.nav-btn[onclick="nav('${page}')"]`);if(btn)btn.classList.add('active');
  if(page==='relatorios')gerarRelatorio();
  if(page==='dashboard')updateDashboard();
  if(page==='delivery'){renderDelivery();
    // Atualiza contador a cada 60s enquanto na aba delivery
    if(window._deliveryTimer)clearInterval(window._deliveryTimer);
    window._deliveryTimer=setInterval(()=>{
      const pg=document.getElementById('page-delivery');
      if(pg&&pg.classList.contains('active'))renderDelivery();
      else clearInterval(window._deliveryTimer);
    },60000);
  }
  if(page==='config')carregarConfig();
  if(page==='cupons'){renderCupons();const sel=document.getElementById('cup-cliente');sel.innerHTML='<option value="">Qualquer cliente</option>'+[...state.clientes].sort((a,b)=>a.nome.localeCompare(b.nome,'pt-BR')).map(c=>`<option value="${c.id}">${c.nome}</option>`).join('');}
  if(page==='entradas'){renderEntradas();renderAlertasEntradas();}
}

// ═══════════════════════════════
// CONFIG
// ═══════════════════════════════
function salvarConfig(){
  config.deliveryTaxa=parseFloat(document.getElementById('config-delivery-taxa').value)||5;
  config.nome=document.getElementById('config-nome').value||'Point do Pastel';
  config.tel=document.getElementById('config-tel').value||'';
  config.endereco=document.getElementById('config-endereco').value||'';
  config.pix=document.getElementById('config-pix').value||'';
  aplicarConfig();saveState();
}
function carregarConfig(){
  document.getElementById('config-delivery-taxa').value=config.deliveryTaxa;
  document.getElementById('config-nome').value=config.nome;
  document.getElementById('config-tel').value=config.tel;
  document.getElementById('config-endereco').value=config.endereco;
  document.getElementById('config-pix').value=config.pix;
}
function aplicarConfig(){document.getElementById('delivery-taxa').value=config.deliveryTaxa;}

// ═══════════════════════════════
// DASHBOARD
// ═══════════════════════════════
function updateDashboard(){
  const hoje=todayISO();
  const vH=state.vendas.filter(v=>v.data.startsWith(hoje));
  const totV=vH.reduce((s,v)=>s+v.total,0);
  // Custo real calculado por receita/ingredientes
  const totC=vH.reduce((s,v)=>s+calcCustoVenda(v),0);
  const lucro=Math.round((totV-totC)*100)/100;
  const margem=totV>0?((lucro/totV)*100).toFixed(1):0;
  document.getElementById('dash-vendas-hoje').textContent=fmtM(totV);
  document.getElementById('dash-qtd-hoje').textContent=vH.length+' pedido(s)';
  document.getElementById('dash-lucro-hoje').textContent=fmtM(lucro);
  document.getElementById('dash-margem-hoje').textContent='Margem real: '+margem+'%';
  const vIF=vH.filter(v=>v.canal==='ifood');
  document.getElementById('dash-ifood-hoje').textContent=fmtM(vIF.reduce((s,v)=>s+v.total,0));
  document.getElementById('dash-ifood-sub').textContent=vIF.length+' pedido(s)';
  // Divergências de estoque
  const divergencias = state.estoque.filter(i=>i.fisico!==undefined && Math.abs(i.fisico-i.estoque)>0.001);
  const cardDiv = document.getElementById('dash-diverg-card');
  const listaDiv = document.getElementById('dash-diverg-lista');
  if(cardDiv){
    if(divergencias.length>0){
      cardDiv.style.display='block';
      document.getElementById('dash-diverg-val').textContent=divergencias.length;
      document.getElementById('dash-diverg-sub').textContent='ingredientes divergentes';
      if(listaDiv){
        listaDiv.style.display='block';
        listaDiv.innerHTML='<div style="background:rgba(220,53,69,0.08);border:1px solid rgba(220,53,69,0.3);border-radius:10px;padding:12px;"><div style="font-weight:600;color:var(--danger);margin-bottom:8px;">⚠️ Divergências de Estoque</div>'+
          divergencias.map(i=>{
            const diff=Math.round((i.fisico-i.estoque)*1000)/1000;
            return `<div style="display:flex;justify-content:space-between;font-size:12px;padding:4px 0;border-bottom:1px solid var(--border);">
              <span>${i.nome}</span>
              <span>Sistema: ${i.estoque} / Físico: ${i.fisico} / <strong style="color:var(--danger);">${diff>0?'+':''}${diff} ${i.unidade}</strong></span>
            </div>`;
          }).join('')+'</div>';
      }
    } else {
      cardDiv.style.display='none';
      if(listaDiv) listaDiv.style.display='none';
    }
  }
  document.getElementById('dash-delivery-hoje').textContent=vH.filter(v=>v.canal==='delivery').length;
  document.getElementById('dash-caixa').textContent=fmtM(calcSaldo());
  document.getElementById('dash-falta').textContent=state.estoque.filter(i=>i.estoque<=i.minimo).length;
  const tb=document.getElementById('dash-ultimas-vendas');
  const rec=[...state.vendas].reverse().slice(0,6);
  tb.innerHTML=rec.length?rec.map(v=>`<tr><td>${fmtH(v.data)}</td><td>${canalLabel(v.canal)}</td><td style="font-size:11px;color:var(--text3);">${v.itens.map(i=>i.nome.split(' ')[0]).join(', ').substring(0,28)}</td><td style="color:var(--gold);font-weight:600">${fmtM(v.total)}</td></tr>`).join(''):'<tr><td colspan="4" class="empty-state">Sem vendas hoje</td></tr>';
  const al=state.estoque.filter(i=>i.estoque<=i.minimo*1.3);
  document.getElementById('dash-alertas').innerHTML=al.length?al.map(i=>`<tr><td>${i.nome}</td><td>${i.estoque} ${i.unidade}</td><td><span class="badge ${i.estoque<=i.minimo?'badge-red':'badge-gold'}">${i.estoque<=i.minimo?'⚠️ Crítico':'🟡 Baixo'}</span></td></tr>`).join(''):'<tr><td colspan="3" class="empty-state">Estoque OK ✅</td></tr>';
  const cnt={};state.vendas.forEach(v=>v.itens.forEach(i=>{cnt[i.nome]=(cnt[i.nome]||0)+i.qty;}));
  const srt=Object.entries(cnt).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const el=document.getElementById('chart-mais-vendidos');
  if(!srt.length){el.innerHTML='<p class="empty-state">Faça vendas para ver o ranking!</p>';return;}
  const mx=srt[0][1];const cores=['#C8923A','#E8B96A','#5C9E6A','#4A7FA5','#9C7AB5','#C05050','#6B8F71','#8FA8C8'];
  el.innerHTML='<div class="chart-bar-container">'+srt.map(([n,q],i)=>`<div class="chart-bar-row"><div class="chart-bar-label">${n}</div><div class="chart-bar-track"><div class="chart-bar-fill" style="width:${(q/mx*100).toFixed(0)}%;background:${cores[i%8]};color:#0F0D0A;">${q}x</div></div></div>`).join('')+'</div>';
}

// ═══════════════════════════════
// PDV — CANAL
// ═══════════════════════════════
function setChannel(c){
  canal=c;
  ['balcao','delivery','ifood'].forEach(x=>document.getElementById('ch-'+x).className='channel-btn'+(x===c?' active-'+c:''));
  document.getElementById('delivery-fields').style.display=c==='delivery'?'block':'none';
  document.getElementById('ifood-fields').style.display=c==='ifood'?'block':'none';
  document.getElementById('delivery-taxa-row').style.display=c==='delivery'?'flex':'none';
  document.getElementById('pagamento-wrap').style.display=c==='ifood'?'none':'block';
  renderCart();
}

// ═══════════════════════════════
// PDV — PRODUTOS
// ═══════════════════════════════
function renderPdvTabs(){document.getElementById('pdv-category-tabs').innerHTML=Object.keys(CATEGORIAS).map(c=>`<button class="tab-btn ${c===pdvCat?'active':''}" onclick="setPdvCat('${c}')">${c}</button>`).join('');}
function setPdvCat(c){pdvCat=c;renderPdvTabs();renderPdvProducts();}
function filterPdvProducts(){renderPdvProducts();}
function renderPdvProducts(){
  const s=(document.getElementById('pdv-search').value||'').toLowerCase();
  const _allCats=getCategorias();
  const prods=s?Object.values(_allCats).flat().filter(p=>p.nome.toLowerCase().includes(s)):(_allCats[pdvCat]||[]);
  document.getElementById('pdv-product-grid').innerHTML=prods.map(p=>`<div class="product-card" onclick="abrirModalItem('${p.id}','${p.id.startsWith('c')?'Combos':pdvCat}')"><div class="pname">${p.nome}</div><div class="pprice">${fmtM(p.preco)}</div></div>`).join('')||'<div class="empty-state">Nenhum produto</div>';
}

// ═══════════════════════════════
// MODAL ADICIONAR ITEM
// ═══════════════════════════════
function abrirModalItem(prodId, catHint){
  // Encontrar produto em todas as categorias
  let prod=null, cat=catHint;
  for(const [c,prods] of Object.entries(getCategorias())){
    const found=prods.find(p=>p.id===prodId);
    if(found){prod=found;cat=c;break;}
  }
  if(!prod)return;
  // Verificar estoque
  if(!temEstoque(prod)){
    showNotif(`⛔ "${prod.nome}" sem estoque!`,'error');
    return;
  }

  const tipo=prod.tipo||'normal';

  // Produtos simples sem configuração especial — adiciona direto
  if(tipo==='normal' && cat!=='Combos' && cat!=='Açaí / Sorvete' && cat!=='Caldo de Cana'){
    // Mostrar modal com adicionais de pastel e observação
    const isPastelSalgado=['Trad. Salgados','2 Recheios','Novidades R$19','Especiais R$19','Especial 30cm'].includes(cat);
    const isPastelDoce=['Pastéis Doces'].includes(cat);
    if(isPastelSalgado){
      abrirModalPastel(prod, false);
    } else if(isPastelDoce){
      abrirModalPastel(prod, true);
    } else {
      // Adiciona direto sem modal
      addToCartDirect(prod,1,[]);
    }
    return;
  }

  if(tipo==='acai'){abrirModalAcai(prod);return;}
  if(tipo==='caldo'){abrirModalCaldo(prod);return;}
  if(tipo==='combo'){abrirModalCombo(prod);return;}
  addToCartDirect(prod,1,[]);
}

function abrirModalPastel(prod, isDoce){
  const el=document.getElementById('modal-add-item-content');
  el.innerHTML=`
    <h3>🥟 ${prod.nome}</h3>
    ${!isDoce ? `
    <div style="margin-bottom:12px;">
      <div class="section-title">Adicionais (opcional)</div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;" id="pasteis-adicionais">
        ${ADICIONAIS_PASTEL.map(a=>`
          <label style="display:flex;align-items:center;gap:5px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:5px 9px;cursor:pointer;font-size:12px;">
            <input type="checkbox" value="${a.id}" style="accent-color:var(--gold);">
            ${a.nome} ${a.preco>0?'<span style="color:var(--gold);">+'+fmtM(a.preco)+'</span>':'<span style="color:var(--text3);">grátis</span>'}
          </label>`).join('')}
      </div>
    </div>` : ''}
    <div class="form-group" style="margin-bottom:4px;">
      <label>Observação (opcional)</label>
      <input type="text" id="item-obs" placeholder="${isDoce ? 'Ex: sem açúcar, caprichar no recheio...' : 'Ex: bem passado, sem pimenta...'}" style="background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:8px;font-size:13px;outline:none;width:100%;">
    </div>
    <div id="item-preco-total" style="margin-top:10px;font-size:15px;font-weight:700;color:var(--gold);">${fmtM(prod.preco)}</div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-add-item')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarPastel('${prod.id}')">Adicionar ao Carrinho</button>
    </div>`;
  // update price on check (só salgados têm checkboxes)
  if(!isDoce){
    el.querySelectorAll('input[type=checkbox]').forEach(cb=>{
      cb.addEventListener('change',()=>{
        const adics=ADICIONAIS_PASTEL.filter(a=>el.querySelector(`input[value="${a.id}"]`)?.checked);
        const extra=adics.reduce((s,a)=>s+a.preco,0);
        el.querySelector('#item-preco-total').textContent=fmtM(prod.preco+extra);
      });
    });
  }
  openModal('modal-add-item');
}

function confirmarPastel(prodId){
  let prod=null;
  for(const prods of Object.values(CATEGORIAS)){const f=prods.find(p=>p.id===prodId);if(f){prod=f;break;}}
  if(!prod)return;
  const el=document.getElementById('modal-add-item-content');
  // Só busca adicionais se o checkbox existir (pastéis salgados)
  const adics=ADICIONAIS_PASTEL.filter(a=>el.querySelector(`input[value="${a.id}"]`)?.checked);
  const obs=document.getElementById('item-obs').value;
  addToCartDirect(prod,1,adics,obs);
  closeModal('modal-add-item');
}

function abrirModalAcai(prod){
  const el=document.getElementById('modal-add-item-content');
  el.innerHTML=`
    <h3>🍨 ${prod.nome}</h3>
    <div style="margin-bottom:12px;">
      <div class="section-title">Tamanho *</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;" id="acai-tamanhos">
        ${TAMANHOS_ACAI.map((t,i)=>`
          <label style="flex:1;min-width:80px;display:flex;flex-direction:column;align-items:center;gap:4px;background:var(--bg3);border:2px solid ${i===0?'var(--gold)':'var(--border)'};border-radius:8px;padding:10px 6px;cursor:pointer;font-size:12px;transition:border 0.2s;" id="tam-lbl-${t.id}">
            <input type="radio" name="acai-tam" value="${t.id}" ${i===0?'checked':''} style="display:none;" onchange="updateAcaiPreco()">
            <span style="font-weight:700;font-size:14px;">${t.nome}</span>
            <span style="color:var(--gold);font-weight:600;">${fmtM(t.preco)}</span>
          </label>`).join('')}
      </div>
    </div>
    <div style="margin-bottom:12px;">
      <div class="section-title">Adicionais (opcional)</div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;">
        ${ADICIONAIS_ACAI.map(a=>`
          <label style="display:flex;align-items:center;gap:5px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:5px 9px;cursor:pointer;font-size:12px;">
            <input type="checkbox" value="${a.id}" style="accent-color:var(--gold);" onchange="updateAcaiPreco()">
            ${a.nome} <span style="color:var(--gold);">+${fmtM(a.preco)}</span>
          </label>`).join('')}
      </div>
    </div>
    <div class="form-group" style="margin-bottom:4px;">
      <label>Observação</label>
      <input type="text" id="item-obs" placeholder="Ex: mais açaí, sem granola...">
    </div>
    <div id="item-preco-total" style="margin-top:10px;font-size:15px;font-weight:700;color:var(--gold);">${fmtM(TAMANHOS_ACAI[0].preco)}</div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-add-item')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarAcai()">Adicionar</button>
    </div>`;
  // Radio visual highlight
  el.querySelectorAll('input[name="acai-tam"]').forEach(r=>{
    r.addEventListener('change',()=>{
      TAMANHOS_ACAI.forEach(t=>{const lbl=document.getElementById('tam-lbl-'+t.id);if(lbl)lbl.style.borderColor=r.value===t.id?'var(--gold)':'var(--border)';});
      updateAcaiPreco();
    });
  });
  openModal('modal-add-item');
}

function updateAcaiPreco(){
  const el=document.getElementById('modal-add-item-content');if(!el)return;
  const tamId=el.querySelector('input[name="acai-tam"]:checked')?.value;
  const tam=TAMANHOS_ACAI.find(t=>t.id===tamId)||TAMANHOS_ACAI[0];
  const adics=ADICIONAIS_ACAI.filter(a=>el.querySelector(`input[value="${a.id}"]`)?.checked);
  const extra=adics.reduce((s,a)=>s+a.preco,0);
  const pr=el.querySelector('#item-preco-total');if(pr)pr.textContent=fmtM(tam.preco+extra);
}

function confirmarAcai(){
  const el=document.getElementById('modal-add-item-content');
  const tamId=el.querySelector('input[name="acai-tam"]:checked')?.value;
  const tam=TAMANHOS_ACAI.find(t=>t.id===tamId)||TAMANHOS_ACAI[0];
  const adics=ADICIONAIS_ACAI.filter(a=>el.querySelector(`input[value="${a.id}"]`)?.checked);
  const obs=document.getElementById('item-obs').value;
  const prod={id:'acai_'+Date.now(),nome:'Açaí '+tam.nome,preco:tam.preco,custo:tam.custo};
  addToCartDirect(prod,1,adics,obs);
  closeModal('modal-add-item');
}

function abrirModalCaldo(prod){
  const el=document.getElementById('modal-add-item-content');
  el.innerHTML=`
    <h3>🎋 Caldo de Cana</h3>
    <div style="margin-bottom:12px;">
      <div class="section-title">Tamanho *</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        ${TAMANHOS_CALDO.map((t,i)=>`
          <label style="flex:1;min-width:80px;display:flex;flex-direction:column;align-items:center;gap:4px;background:var(--bg3);border:2px solid ${i===0?'var(--gold)':'var(--border)'};border-radius:8px;padding:10px 6px;cursor:pointer;font-size:12px;" id="ctam-lbl-${t.id}">
            <input type="radio" name="caldo-tam" value="${t.id}" ${i===0?'checked':''} style="display:none;" onchange="updateCaldoPreco()">
            <span style="font-weight:700;font-size:14px;">${t.nome}</span>
            <span style="color:var(--gold);font-weight:600;">${fmtM(t.preco)}</span>
          </label>`).join('')}
      </div>
    </div>
    <div style="margin-bottom:12px;">
      <div class="section-title">Adicionais (opcional)</div>
      <div style="display:flex;flex-wrap:wrap;gap:6px;">
        ${ADICIONAIS_CALDO.map(a=>`
          <label style="display:flex;align-items:center;gap:5px;background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:5px 9px;cursor:pointer;font-size:12px;">
            <input type="checkbox" value="${a.id}" style="accent-color:var(--gold);">
            ${a.nome} ${a.preco>0?'<span style="color:var(--gold);">+'+fmtM(a.preco)+'</span>':'<span style="color:var(--text3);">grátis</span>'}
          </label>`).join('')}
      </div>
    </div>
    <div class="form-group" style="margin-bottom:4px;"><label>Observação</label><input type="text" id="item-obs" placeholder="Ex: bem gelado..."></div>
    <div id="item-preco-total" style="margin-top:10px;font-size:15px;font-weight:700;color:var(--gold);">${fmtM(TAMANHOS_CALDO[0].preco)}</div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-add-item')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarCaldo()">Adicionar</button>
    </div>`;
  el.querySelectorAll('input[name="caldo-tam"]').forEach(r=>{
    r.addEventListener('change',()=>{
      TAMANHOS_CALDO.forEach(t=>{const lbl=document.getElementById('ctam-lbl-'+t.id);if(lbl)lbl.style.borderColor=r.value===t.id?'var(--gold)':'var(--border)';});
      updateCaldoPreco();
    });
  });
  openModal('modal-add-item');
}
function updateCaldoPreco(){
  const el=document.getElementById('modal-add-item-content');if(!el)return;
  const tamId=el.querySelector('input[name="caldo-tam"]:checked')?.value;
  const tam=TAMANHOS_CALDO.find(t=>t.id===tamId)||TAMANHOS_CALDO[0];
  const adics=ADICIONAIS_CALDO.filter(a=>el.querySelector(`input[value="${a.id}"]`)?.checked);
  const extra=adics.reduce((s,a)=>s+a.preco,0);
  const pr=el.querySelector('#item-preco-total');if(pr)pr.textContent=fmtM(tam.preco+extra);
}
function confirmarCaldo(){
  const el=document.getElementById('modal-add-item-content');
  const tamId=el.querySelector('input[name="caldo-tam"]:checked')?.value;
  const tam=TAMANHOS_CALDO.find(t=>t.id===tamId)||TAMANHOS_CALDO[0];
  const adics=ADICIONAIS_CALDO.filter(a=>el.querySelector(`input[value="${a.id}"]`)?.checked);
  const obs=document.getElementById('item-obs').value;
  const prod={id:'caldo_'+Date.now(),nome:'Caldo de Cana '+tam.nome,preco:tam.preco,custo:tam.custo};
  addToCartDirect(prod,1,adics,obs);
  closeModal('modal-add-item');
}

// ═══════════════════════════════
// COMBO — escolher pastéis
// ═══════════════════════════════
function abrirModalCombo(combo){
  const qtd=combo.qtdPasteis||2;
  // Montar lista de pastéis disponíveis para o combo
  let listaPasteis=[];
  const trad=CATEGORIAS['Trad. Salgados']||[];
  const dois=CATEGORIAS['2 Recheios']||[];
  if(combo.tiposPasteis&&combo.tiposPasteis.includes('trad'))listaPasteis=[...trad];
  if(combo.tiposPasteis&&combo.tiposPasteis.includes('2r'))listaPasteis=[...listaPasteis,...dois];
  if(!listaPasteis.length)listaPasteis=[...trad,...dois];

  // Gerar seletores para cada pastel do combo
  let selects='';
  for(let i=0;i<qtd;i++){
    selects+=`<div class="form-group"><label>Pastel ${i+1}</label>
      <select id="combo-pastel-${i}" style="background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:9px 11px;border-radius:8px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none;">
        ${listaPasteis.map(p=>`<option value="${p.id}">${p.nome}</option>`).join('')}
      </select></div>`;
  }

  const el=document.getElementById('modal-add-item-content');
  el.innerHTML=`
    <h3>🎁 ${combo.nome}</h3>
    <div style="background:rgba(200,146,58,0.08);border:1px solid var(--border);border-radius:8px;padding:10px;margin-bottom:14px;font-size:12px;color:var(--text2);">
      Escolha os <strong style="color:var(--gold);">${qtd} pastéis</strong> do seu combo
      ${combo.inclui?'<br>Inclui também: <strong>'+combo.inclui+'</strong>':''}
    </div>
    <div class="form-grid">${selects}</div>
    <div class="form-group" style="margin-top:10px;"><label>Observação (opcional)</label>
      <input type="text" id="item-obs" placeholder="Ex: bem passado, sem pimenta...">
    </div>
    <div style="margin-top:10px;font-size:15px;font-weight:700;color:var(--gold);">${fmtM(combo.preco)}</div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-add-item')">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarCombo('${combo.id}')">Adicionar ao Carrinho</button>
    </div>`;
  openModal('modal-add-item');
}

function confirmarCombo(comboId){
  let combo=null;
  for(const prods of Object.values(CATEGORIAS)){const f=prods.find(p=>p.id===comboId);if(f){combo=f;break;}}
  if(!combo)return;
  const qtd=combo.qtdPasteis||2;
  const pasteisSel=[];
  let allProds=getAllProducts();
  for(let i=0;i<qtd;i++){
    const sel=document.getElementById(`combo-pastel-${i}`);
    if(sel){const p=allProds.find(x=>x.id===sel.value);if(p)pasteisSel.push(p.nome);}
  }
  const obs=document.getElementById('item-obs').value;
  const detalhe=pasteisSel.join(', ')+(combo.inclui?' + '+combo.inclui:'');
  const adics=[];// sem adicionais extras no combo
  addToCartDirect({...combo,nome:combo.nome},1,adics,obs,detalhe);
  closeModal('modal-add-item');
}

// ═══════════════════════════════
// CARRINHO
// ═══════════════════════════════
function addToCartDirect(prod,qty,adics,obs,detalhe){
  const extraPreco=adics.reduce((s,a)=>s+a.preco,0);
  const extraCusto=adics.reduce((s,a)=>s+a.custo,0);
  const uid='cart_'+Date.now()+'_'+Math.random().toString(36).slice(2,6);
  carrinho.push({
    uid,id:prod.id,nome:prod.nome,
    preco:prod.preco+extraPreco,custo:(prod.custo||0)+extraCusto,
    qty:qty||1,adics:adics||[],obs:obs||'',detalhe:detalhe||''
  });
  renderCart();
  showNotif(`${prod.nome} adicionado! 🛒`,'success');
}

function updateCartQty(uid,d){
  const idx=carrinho.findIndex(i=>i.uid===uid);if(idx===-1)return;
  carrinho[idx].qty+=d;
  if(carrinho[idx].qty<=0)carrinho.splice(idx,1);
  renderCart();
}

function renderCart(){
  const el=document.getElementById('cart-items');
  if(!carrinho.length){el.innerHTML='<div class="empty-state" style="padding:18px;">Nenhum item adicionado</div>';
  }else{
    el.innerHTML=carrinho.map(i=>{
      const adicsStr=i.adics&&i.adics.length?i.adics.map(a=>`<span class="adicional-tag">+${a.nome}</span>`).join(''):'';
      const det=i.detalhe?`<div class="cart-item-detail" style="color:var(--text2);">📋 ${i.detalhe}</div>`:'';
      const obsStr=i.obs?`<div class="cart-item-detail">💬 ${i.obs}</div>`:'';
      return `<div class="cart-item">
        <div class="cart-item-info">
          <div class="cart-item-name">${i.nome}</div>
          ${det}${adicsStr?`<div style="margin-top:2px;">${adicsStr}</div>`:''}${obsStr}
        </div>
        <div class="cart-item-qty">
          <button class="qty-btn remove-btn" onclick="updateCartQty('${i.uid}',-1)">−</button>
          <span style="font-size:13px;min-width:18px;text-align:center;font-weight:600;">${i.qty}</span>
          <button class="qty-btn" onclick="updateCartQty('${i.uid}',1)">+</button>
        </div>
        <div class="cart-item-price">${fmtM(i.preco*i.qty)}</div>
      </div>`;
    }).join('');
  }
  const sub=carrinho.reduce((s,i)=>s+i.preco*i.qty,0);
  const taxaDel=canal==='delivery'?parseFloat(document.getElementById('delivery-taxa').value||0):0;
  let desconto=0;
  if(cupomAtivo){
    if(cupomAtivo.tipo==='percentual')desconto=sub*(cupomAtivo.valor/100);
    else if(cupomAtivo.tipo==='fixo')desconto=Math.min(cupomAtivo.valor,sub);
    else if(cupomAtivo.tipo==='frete')desconto=taxaDel;
    desconto=Math.round(desconto*100)/100;
  }
  const total=Math.max(0,(canal==='delivery'?sub+taxaDel:sub)-desconto);
  document.getElementById('cart-subtotal').textContent=fmtM(sub);
  document.getElementById('cart-taxa-entrega').textContent=fmtM(taxaDel);
  document.getElementById('cart-total').textContent=fmtM(total);
  const cupRow=document.getElementById('cupom-row');
  if(cupomAtivo&&desconto>0){
    cupRow.style.display='flex';
    document.getElementById('cupom-label').textContent='🏷️ '+cupomAtivo.codigo;
    document.getElementById('cart-desconto').textContent='- '+fmtM(desconto);
  }else{cupRow.style.display='none';}
  calcTroco();
  if(canal==='ifood') calcDescontoIfood();
  // Custo e lucro previsto
  const custoEst = calcCustoCarrinho();
  const totalAtual = carrinho.reduce((s,i)=>s+i.preco*i.qty,0);
  const lucroEst = Math.round((totalAtual - custoEst)*100)/100;
  const elCusto = document.getElementById('cart-custo-est');
  const elLucro = document.getElementById('cart-lucro-est');
  if(elCusto) elCusto.textContent = fmtM(custoEst);
  if(elLucro){
    elLucro.textContent = fmtM(lucroEst);
    elLucro.style.color = lucroEst >= 0 ? 'var(--success)' : 'var(--danger)';
  }
}

function calcTroco(){
  if(canal==='ifood'){document.getElementById('troco-wrap').style.display='none';document.getElementById('troco-display').style.display='none';calcDescontoIfood();return;}
  const pag=document.getElementById('cart-pagamento').value;
  const tw=document.getElementById('troco-wrap'),td=document.getElementById('troco-display');
  if(pag==='dinheiro'){
    tw.style.display='flex';
    const rec=parseFloat(document.getElementById('cart-recebido').value)||0;
    const sub=carrinho.reduce((s,i)=>s+i.preco*i.qty,0);
    const taxaDel=canal==='delivery'?parseFloat(document.getElementById('delivery-taxa').value||0):0;
    if(rec>0){const t=rec-(sub+taxaDel);td.style.display='block';td.textContent=t>=0?`Troco: ${fmtM(t)}`:'⚠️ Valor insuficiente';td.style.color=t>=0?'var(--success)':'var(--danger)';}
    else td.style.display='none';
  }else{tw.style.display='none';td.style.display='none';}
}

function finalizarVenda(){
  if(!carrinho.length){showNotif('Adicione itens ao carrinho!','error');return;}
  if(canal==='delivery'&&!document.getElementById('delivery-endereco').value){showNotif('Informe o endereço de entrega!','error');return;}
  const sub=carrinho.reduce((s,i)=>s+i.preco*i.qty,0);
  const cst=carrinho.reduce((s,i)=>s+(i.custo||0)*i.qty,0);
  const taxaDel=canal==='delivery'?parseFloat(document.getElementById('delivery-taxa').value||0):0;
  let desconto=0;
  if(cupomAtivo){
    if(cupomAtivo.tipo==='percentual')desconto=sub*(cupomAtivo.valor/100);
    else if(cupomAtivo.tipo==='fixo')desconto=Math.min(cupomAtivo.valor,sub);
    else if(cupomAtivo.tipo==='frete')desconto=taxaDel;
    desconto=Math.round(desconto*100)/100;
    // Invalidar cupom de uso único
    const cup=state.cupons.find(x=>x.codigo===cupomAtivo.codigo);
    if(cup){cup.usosFeitos=(cup.usosFeitos||0)+1;if(cup.usosMax&&cup.usosFeitos>=cup.usosMax)cup.ativo=false;}
  }
  const total=Math.max(0,(canal==='delivery'?sub+taxaDel:sub)-desconto);
  const pag=canal==='ifood'?'ifood':document.getElementById('cart-pagamento').value;
  const clienteId=canal==='delivery'?document.getElementById('delivery-cliente').value:'';
  const endereco=canal==='delivery'?document.getElementById('delivery-endereco').value:'';
  const ifoodNum=canal==='ifood'?document.getElementById('ifood-pedido').value:'';
  const obs=document.getElementById('cart-obs').value;
  const taxaMotoboy = canal==='delivery' ? taxaDel : canal==='ifood' ? parseFloat(document.getElementById('ifood-taxa-motoboy').value||0) : 0;
  // Dados extras iFood
  const ifoodLoja    = canal==='ifood' ? document.getElementById('ifood-loja').value : '';
  const ifoodPagto   = canal==='ifood' ? document.getElementById('ifood-pagamento').value : '';
  const ifoodPromos  = canal==='ifood' ? {
    descLoja5:  document.getElementById('ifd-desc-loja5').checked,
    descIfood:  document.getElementById('ifd-desc-ifood').checked,
    descMisto:  document.getElementById('ifd-desc-misto').checked,
    freteIfood: document.getElementById('ifd-frete-ifood').checked,
    freteLoja:  document.getElementById('ifd-frete-loja').checked,
  } : {};
  // Calcular custo real da loja (desconto loja + taxa online + motoboy se pago pela loja)
  let custoIfoodLoja = 0;
  if(canal==='ifood'){
    const subIfood = carrinho.reduce((s,i)=>s+i.preco*i.qty,0);
    if(ifoodPromos.descLoja5) custoIfoodLoja += 5;
    if(ifoodPromos.descMisto) custoIfoodLoja += 5;
    if(ifoodPagto==='online') custoIfoodLoja += Math.round(subIfood*0.035*100)/100;
    if(ifoodPromos.freteLoja) custoIfoodLoja += taxaMotoboy;
  }
  const venda={id:Date.now(),data:new Date().toISOString(),itens:carrinho.map(i=>({...i})),subtotal:sub,total,desconto,cupom:cupomAtivo?.codigo||'',custo:cst,canal,pagamento:canal==='ifood'?ifoodPagto:pag,taxaDelivery:taxaDel,taxaMotoboy,clienteId,endereco,ifoodNumero:ifoodNum,ifoodLoja,ifoodPagto,ifoodPromos,custoIfoodLoja,obs,status:canal==='delivery'||canal==='ifood'?'aguardando':''};
  state.vendas.push(venda);
  if(canal==='delivery'||canal==='ifood')state.pedidosDelivery.push({...venda});
  state.caixa.push({id:Date.now()+1,data:new Date().toISOString(),tipo:'entrada',descricao:`Venda #${state.vendas.length}${ifoodNum?' ('+ifoodNum+')':''}`,valor:total,pagamento:pag,canal});
  if(clienteId){const cli=state.clientes.find(c=>c.id==clienteId);if(cli){cli.totalCompras=(cli.totalCompras||0)+total;cli.qtdPedidos=(cli.qtdPedidos||0)+1;cli.ultimoPedido=new Date().toISOString();}}
  abaterEstoque(venda.itens);cupomAtivo=null;limparCarrinho();saveState();updateDashboard();renderCaixa();renderDelivery();renderCupons();renderCardapio();renderEstoque();
  showNotif(`Venda de ${fmtM(total)} finalizada! ✅`,'success');
}

function imprimirPedido(){
  if(!carrinho.length){showNotif('Carrinho vazio!','error');return;}
  const sub=carrinho.reduce((s,i)=>s+i.preco*i.qty,0);
  const taxaDel=canal==='delivery'?parseFloat(document.getElementById('delivery-taxa').value||0):0;
  let desconto=0;
  if(cupomAtivo){
    if(cupomAtivo.tipo==='percentual')desconto=sub*(cupomAtivo.valor/100);
    else if(cupomAtivo.tipo==='fixo')desconto=Math.min(cupomAtivo.valor,sub);
    else if(cupomAtivo.tipo==='frete')desconto=taxaDel;
    desconto=Math.round(desconto*100)/100;
  }
  const total=Math.max(0,(canal==='delivery'?sub+taxaDel:sub)-desconto);
  const agora=new Date().toLocaleString('pt-BR');
  const canalNome={balcao:'Balcão',delivery:'Delivery',ifood:'iFood'}[canal];
  const end=canal==='delivery'?document.getElementById('delivery-endereco').value:'';
  const pagSel=document.getElementById('cart-pagamento');
  const pag=canal==='ifood'?'iFood':pagSel.options[pagSel.selectedIndex].text;
  const obs=document.getElementById('cart-obs').value;
  let rows='';
  carrinho.forEach(i=>{
    const adicsStr=i.adics&&i.adics.length?' (+'+i.adics.map(a=>a.nome).join(', ')+')':'';
    const detHtml=i.detalhe?`<br><span style='color:#555;font-size:10px;'>📋 ${i.detalhe}</span>`:'';
    const obsHtml=i.obs?`<br><span style='color:#555;font-size:10px;'>💬 ${i.obs}</span>`:'';
    rows+=`<tr><td style="padding:4px 0;font-size:12px;vertical-align:top;">${i.nome}${adicsStr}${detHtml}${obsHtml}</td><td style="text-align:center;width:28px;font-size:12px;vertical-align:top;">${i.qty}x</td><td style="text-align:right;width:65px;font-size:12px;vertical-align:top;font-weight:600;">${fmtM(i.preco*i.qty)}</td></tr>`;
  });
  const pw=window.open('','_blank','width=380,height=750');
  if(!pw){showNotif('Permita pop-ups para imprimir!','error');return;}
  pw.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Pedido</title>
  <style>
    *{box-sizing:border-box;}
    body{font-family:'Courier New',monospace;font-size:12px;margin:0;padding:10px;color:#000;max-width:300px;}
    h2{text-align:center;font-size:15px;margin:0 0 2px;font-family:sans-serif;}
    .centro{text-align:center;font-size:11px;color:#444;margin-bottom:6px;}
    hr{border:none;border-top:1px dashed #000;margin:5px 0;}
    table{width:100%;border-collapse:collapse;}
    th{text-align:left;font-size:11px;border-bottom:1px solid #000;padding-bottom:3px;}
    th:nth-child(2){text-align:center;}th:nth-child(3){text-align:right;}
    td{font-size:12px;padding:3px 0;vertical-align:top;}
    td:nth-child(2){text-align:center;}td:nth-child(3){text-align:right;font-weight:bold;}
    .row{display:flex;justify-content:space-between;font-size:12px;margin:2px 0;}
    .total-row{display:flex;justify-content:space-between;font-size:14px;font-weight:bold;margin-top:3px;border-top:1px solid #000;padding-top:3px;}
    .desconto-row{display:flex;justify-content:space-between;font-size:12px;margin:2px 0;}
    @media print{@page{size:80mm auto;margin:3mm;}body{max-width:100%;}}
  </style>
  </head><body>
  <h2>${config.nome||'POINT DO PASTEL'}</h2>
  <div class="centro">${config.tel||''}${config.endereco?'<br>'+config.endereco:''}<br>${agora}</div>
  <hr>
  <div><b>CANAL:</b> ${canalNome}</div>
  ${end?`<div><b>ENDEREÇO:</b> ${end}</div>`:''}
  <hr>
  <table>
    <thead><tr><th>Item</th><th>Qtd</th><th>Vlr</th></tr></thead>
    <tbody>${rows}</tbody>
  </table>
  <hr>
  <div class="row"><span>Subtotal</span><span>${fmtM(sub)}</span></div>
  ${taxaDel>0?`<div class="row"><span>Taxa entrega</span><span>${fmtM(taxaDel)}</span></div>`:''}
  ${desconto>0?`<div class="desconto-row"><span>🏷️ Desconto${cupomAtivo?' ('+cupomAtivo.codigo+')':''}</span><span>- ${fmtM(desconto)}</span></div>`:''}
  <div class="total-row"><span>TOTAL</span><span>${fmtM(total)}</span></div>
  <div style="font-size:12px;margin-top:5px;"><b>Pgto:</b> ${pag}</div>
  ${obs?`<div style="font-size:11px;margin-top:3px;"><b>Obs:</b> ${obs}</div>`:''}
  <hr>
  <div style="text-align:center;font-size:11px;">Obrigado pela preferência! 🥟<br>PIX: ${config.pix}</div>
  <script>window.onload=function(){setTimeout(function(){window.print();},500);};<\/script>
  </body></html>`);pw.document.close();
}

function limparCarrinho(){
  carrinho=[];cupomAtivo=null;
  document.getElementById('cupom-input').value='';
  document.getElementById('cupom-status').style.display='none';
  // Limpar campos iFood
  try{
    document.getElementById('ifood-pedido').value='';
    document.getElementById('ifood-pagamento').value='dinheiro';
    document.getElementById('ifood-taxa-motoboy').value='5.50';
    ['ifd-desc-loja5','ifd-desc-ifood','ifd-desc-misto','ifd-frete-ifood','ifd-frete-loja'].forEach(id=>document.getElementById(id).checked=false);
    document.getElementById('ifood-resumo').style.display='none';
    const cr=document.getElementById('ifood-custo-row');if(cr)cr.style.display='none';
  }catch(e){}
  ['cart-recebido','delivery-endereco','ifood-pedido','cart-obs'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  renderCart();
}

// ═══════════════════════════════
// DELIVERY
// ═══════════════════════════════
const STATUS_DEL={aguardando:{label:'⏳ Aguardando',cls:'badge-gold'},preparando:{label:'👨‍🍳 Preparando',cls:'badge-blue'},rota:{label:'🛵 Em Rota',cls:'badge-delivery'},entregue:{label:'✅ Entregue',cls:'badge-green'},cancelado:{label:'❌ Cancelado',cls:'badge-red'}};
function tempoDecorrido(isoData){
  const diff = Math.floor((Date.now() - new Date(isoData).getTime()) / 60000);
  if(diff < 60) return {txt: diff+'min', alerta: diff >= 45, critico: diff >= 60};
  const h = Math.floor(diff/60), m = diff%60;
  return {txt: h+'h'+(m>0?m+'min':''), alerta: true, critico: diff >= 90};
}

function renderDelivery(){
  const hoje=todayISO();
  const pedidos=state.pedidosDelivery.filter(p=>p.data.startsWith(hoje));
  document.getElementById('del-aguardando').textContent=pedidos.filter(p=>p.status==='aguardando').length;
  document.getElementById('del-rota').textContent=pedidos.filter(p=>p.status==='rota').length;
  document.getElementById('del-entregues').textContent=pedidos.filter(p=>p.status==='entregue').length;
  document.getElementById('del-ifood').textContent=pedidos.filter(p=>p.canal==='ifood').length;
  const tb=document.getElementById('delivery-tbody');
  if(!pedidos.length){tb.innerHTML='<tr><td colspan="9" class="empty-state">Nenhum pedido hoje</td></tr>';return;}
  tb.innerHTML=[...pedidos].reverse().map(p=>{
    const cli=state.clientes.find(c=>c.id==p.clienteId);
    const nome=cli?cli.nome:(p.clienteId||'—');
    const st=STATUS_DEL[p.status]||STATUS_DEL.aguardando;
    const nexts=p.status==='aguardando'?['preparando','cancelado']:p.status==='preparando'?['rota','cancelado']:p.status==='rota'?['entregue','cancelado']:[];
    const btns=nexts.map(ns=>`<button class="btn btn-primary btn-sm" onclick="updateDeliveryStatus(${p.id},'${ns}')" style="font-size:12px;padding:6px 12px;">${STATUS_DEL[ns].label}</button>`).join('');
    const btnReprint=`<button class="btn btn-outline btn-sm" onclick="reimprimirPedido(${p.id})" style="font-size:12px;padding:6px 10px;" title="Reimprimir">🖨️</button>`;
    const itensStr=p.itens.map(i=>i.qty+'x '+i.nome.split(' ')[0]).join(', ');
    const taxaMb=p.taxaMotoboy||p.taxaDelivery||0;
    let timerHtml='';
    if(p.status!=='entregue'&&p.status!=='cancelado'){
      const t=tempoDecorrido(p.data);
      const cor=t.critico?'var(--danger)':t.alerta?'var(--gold)':'var(--success)';
      timerHtml=`<span style="font-weight:700;color:${cor};font-size:13px;margin-left:8px;">⏱️ ${t.txt}</span>`;
    }
    return `<div style="background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin-bottom:10px;">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;">
        <div>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:3px;">
            <span style="font-weight:700;font-size:14px;">${nome}</span>
            <span class="badge ${st.cls}">${st.label}</span>
          </div>
          <div style="font-size:12px;color:var(--text3);">${fmtH(p.data)} ${timerHtml}</div>
        </div>
        <div style="text-align:right;">
          ${canalLabel(p.canal)}
          <div style="font-size:16px;font-weight:700;color:var(--gold);margin-top:3px;">${fmtM(p.total)}</div>
        </div>
      </div>
      ${p.endereco?`<div style="font-size:12px;color:var(--text2);margin-bottom:6px;">📍 ${p.endereco}</div>`:''}
      <div style="font-size:12px;color:var(--text3);margin-bottom:8px;">🛒 ${itensStr}</div>
      ${taxaMb>0?`<div style="font-size:12px;color:var(--delivery);margin-bottom:8px;">🏍️ Motoboy: ${fmtM(taxaMb)}</div>`:''}
      <div style="display:flex;gap:6px;flex-wrap:wrap;">
        ${btns}
        ${btnReprint}
      </div>
    </div>`;
  }).join('');
}
function updateDeliveryStatus(id,status){
  const p=state.pedidosDelivery.find(x=>x.id==id);if(!p)return;
  p.status=status;const v=state.vendas.find(x=>x.id==id);if(v)v.status=status;
  saveState();renderDelivery();updateDashboard();
  showNotif(`Pedido: ${STATUS_DEL[status].label}`,'success');
}

// ═══════════════════════════════
// CLIENTES
// ═══════════════════════════════
function abrirNovoCliente(){
  document.getElementById('cli-edit-id').value='';document.getElementById('modal-cliente-title').textContent='Novo Cliente';
  ['cli-nome','cli-tel','cli-end','cli-bairro','cli-cep','cli-taxa','cli-obs'].forEach(id=>document.getElementById(id).value='');
  openModal('modal-cliente');
}
function renderClientes(){
  const busca=(document.getElementById('clientes-search').value||'').toLowerCase();
  let lista=[...state.clientes].sort((a,b)=>a.nome.localeCompare(b.nome,'pt-BR'));
  if(busca)lista=lista.filter(c=>(c.nome+c.tel+(c.bairro||'')).toLowerCase().includes(busca));
  const grid=document.getElementById('clientes-grid');
  if(!lista.length){grid.innerHTML='<div class="empty-state" style="grid-column:1/-1;">Nenhum cliente encontrado</div>';return;}
  grid.innerHTML=lista.map(c=>{
    const pedidos=state.vendas.filter(v=>v.clienteId==c.id);
    const totalGasto=pedidos.reduce((s,v)=>s+v.total,0);
    return `<div class="client-card" onclick="verCliente(${c.id})">
      <div class="client-name">👤 ${c.nome}</div>
      ${c.tel?`<div class="client-info">📱 ${c.tel}</div>`:''}
      ${c.endereco?`<div class="client-info">📍 ${c.endereco}${c.bairro?', '+c.bairro:''}</div>`:''}
      ${c.taxaEntrega?`<div class="client-info">🛵 Taxa: ${fmtM(c.taxaEntrega)}</div>`:''}
      <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;">
        <span class="badge badge-gold">${pedidos.length} pedido(s)</span>
        <span class="badge badge-green">${fmtM(totalGasto)}</span>
        ${c.bairro?`<span class="badge badge-blue">${c.bairro}</span>`:''}
      </div>
    </div>`;
  }).join('');
  // Atualizar select de clientes no PDV
  const sel=document.getElementById('delivery-cliente');const prev=sel.value;
  sel.innerHTML='<option value="">— Selecionar —</option>'+[...state.clientes].sort((a,b)=>a.nome.localeCompare(b.nome,'pt-BR')).map(c=>`<option value="${c.id}">${c.nome}${c.bairro?' ('+c.bairro+')':''}</option>`).join('');
  sel.value=prev;
}
function verCliente(id){
  const c=state.clientes.find(x=>x.id==id);if(!c)return;
  const pedidos=state.vendas.filter(v=>v.clienteId==id);
  const total=pedidos.reduce((s,v)=>s+v.total,0);
  document.getElementById('modal-cliente-detalhe-content').innerHTML=`
    <h3>👤 ${c.nome}</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;">
      <div><div class="stat-label">Telefone</div><div style="font-size:14px;">${c.tel||'—'}</div></div>
      <div><div class="stat-label">Taxa Entrega</div><div style="font-size:14px;color:var(--gold);">${c.taxaEntrega?fmtM(c.taxaEntrega):'—'}</div></div>
      <div style="grid-column:span 2;"><div class="stat-label">Endereço</div><div style="font-size:13px;">${c.endereco||'—'}${c.bairro?', '+c.bairro:''}${c.cep?' — CEP: '+c.cep:''}</div></div>
      ${c.obs?`<div style="grid-column:span 2;"><div class="stat-label">Obs</div><div style="font-size:12px;color:var(--text3);">${c.obs}</div></div>`:''}
    </div>
    <div style="display:flex;gap:10px;margin-bottom:14px;">
      <div class="stat-card gold" style="flex:1;padding:10px;"><div class="stat-label">Pedidos</div><div class="stat-value gold" style="font-size:20px;">${pedidos.length}</div></div>
      <div class="stat-card green" style="flex:1;padding:10px;"><div class="stat-label">Total Gasto</div><div class="stat-value green" style="font-size:16px;">${fmtM(total)}</div></div>
      <div class="stat-card" style="flex:1;padding:10px;"><div class="stat-label">Ticket Médio</div><div class="stat-value" style="font-size:16px;">${pedidos.length?fmtM(total/pedidos.length):'—'}</div></div>
    </div>
    <div style="font-size:13px;font-weight:600;color:var(--text2);margin-bottom:8px;">Últimos Pedidos</div>
    ${pedidos.length?'<div style="max-height:180px;overflow-y:auto;">'+ [...pedidos].reverse().slice(0,10).map(v=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);font-size:12px;"><span>${fmtDT(v.data)}</span>${canalLabel(v.canal)}<span style="color:var(--gold);font-weight:600;">${fmtM(v.total)}</span></div>`).join('')+'</div>':`<p style="color:var(--text3);font-size:13px;">Nenhum pedido ainda</p>`}
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="editarCliente(${c.id})">✏️ Editar</button>
      <button class="btn btn-primary" onclick="closeModal('modal-cliente-detalhe');nav('vendas');setChannel('delivery');setTimeout(()=>{document.getElementById('delivery-cliente').value='${c.id}';preencherEndCliente();},100)">🛵 Novo Pedido</button>
      <button class="btn btn-outline" onclick="closeModal('modal-cliente-detalhe')">Fechar</button>
    </div>`;
  openModal('modal-cliente-detalhe');
}
function editarCliente(id){
  const c=state.clientes.find(x=>x.id==id);if(!c)return;
  closeModal('modal-cliente-detalhe');
  document.getElementById('cli-edit-id').value=c.id;document.getElementById('modal-cliente-title').textContent='Editar Cliente';
  document.getElementById('cli-nome').value=c.nome||'';document.getElementById('cli-tel').value=c.tel||'';
  document.getElementById('cli-end').value=c.endereco||'';document.getElementById('cli-bairro').value=c.bairro||'';
  document.getElementById('cli-cep').value=c.cep||'';document.getElementById('cli-taxa').value=c.taxaEntrega||'';
  document.getElementById('cli-obs').value=c.obs||'';openModal('modal-cliente');
}
function salvarCliente(){
  const nome=document.getElementById('cli-nome').value.trim();
  if(!nome){showNotif('Informe o nome','error');return;}
  const editId=document.getElementById('cli-edit-id').value;
  const dados={nome,tel:document.getElementById('cli-tel').value,endereco:document.getElementById('cli-end').value,bairro:document.getElementById('cli-bairro').value,cep:document.getElementById('cli-cep').value,taxaEntrega:parseFloat(document.getElementById('cli-taxa').value)||0,obs:document.getElementById('cli-obs').value};
  if(editId){const idx=state.clientes.findIndex(c=>c.id==editId);if(idx>-1)state.clientes[idx]={...state.clientes[idx],...dados};}
  else state.clientes.push({id:Date.now(),...dados,totalCompras:0,qtdPedidos:0});
  saveState();renderClientes();closeModal('modal-cliente');showNotif(editId?'Cliente atualizado!':'Cliente cadastrado! 👤','success');
}
function preencherEndCliente(){
  const id=document.getElementById('delivery-cliente').value;if(!id)return;
  const cli=state.clientes.find(c=>c.id==id);
  if(cli){
    document.getElementById('delivery-endereco').value=cli.endereco+(cli.bairro?', '+cli.bairro:'');
    if(cli.taxaEntrega){document.getElementById('delivery-taxa').value=cli.taxaEntrega;renderCart();}
  }
}

// ═══════════════════════════════
// ESTOQUE
// ═══════════════════════════════
function renderEstoque(filtro,busca){
  filtro=filtro||document.getElementById('estoque-filter').value||'todos';
  busca=busca||document.getElementById('estoque-search').value||'';
  let items=state.estoque;
  if(busca)items=items.filter(i=>i.nome.toLowerCase().includes(busca.toLowerCase()));
  if(filtro==='critico')items=items.filter(i=>i.estoque<=i.minimo);
  else if(filtro==='baixo')items=items.filter(i=>i.estoque>i.minimo&&i.estoque<=i.minimo*1.5);
  else if(filtro==='ok')items=items.filter(i=>i.estoque>i.minimo*1.5);
  const tb=document.getElementById('estoque-tbody');
  if(!items.length){tb.innerHTML='<tr><td colspan="7" class="empty-state">Nenhum item</td></tr>';return;}
  tb.innerHTML=items.map(i=>{
    const pct=Math.min((i.estoque/Math.max(i.minimo*2,0.01))*100,100);
    let cls='badge-green',sit='✅ OK';
    if(i.estoque<=i.minimo){cls='badge-red';sit='⚠️ Crítico';}
    else if(i.estoque<=i.minimo*1.5){cls='badge-gold';sit='🟡 Baixo';}
    // Divergência: físico cadastrado vs sistema
    const fisico = i.fisico !== undefined ? i.fisico : null;
    const diff = fisico !== null ? Math.round((fisico - i.estoque)*1000)/1000 : null;
    const divCell = fisico !== null
      ? diff < -0.001
        ? `<td style="color:var(--danger);font-weight:700;">${diff.toFixed(3)} ${i.unidade} ⚠️</td>`
        : diff > 0.001
          ? `<td style="color:var(--gold);">${diff > 0 ? '+':''}${diff.toFixed(3)} ${i.unidade}</td>`
          : `<td style="color:var(--success);">✅ Conferido</td>`
      : `<td><button class="btn btn-outline btn-sm" onclick="contarFisico('${i.id}')" style="font-size:11px;padding:3px 8px;">📦 Contar</button></td>`;
    return `<tr>
      <td><strong>${i.nome}</strong><br><span style="font-size:11px;color:var(--text3);">Compra: ${fmtM(i.preco_ref||0)}/${i.unidade}</span></td>
      <td style="font-weight:600;color:var(--gold);">${i.estoque} ${i.unidade}</td>
      ${divCell}
      <td>${fisico!==null?`<span style="font-size:12px;">${fisico} ${i.unidade} <button onclick="resetFisico('${i.id}')" style="background:none;border:none;cursor:pointer;color:var(--text3);font-size:10px;">✕</button></span>`:`<span style="color:var(--text3);font-size:12px;">—</span>`}</td>
      <td style="color:var(--text2);">${i.unidade}</td>
      <td><span class="badge ${cls}">${sit}</span></td>
      <td style="display:flex;gap:4px;">
        <button class="btn btn-outline btn-sm" onclick="abrirEdicaoEstoque('${i.id}')">✏️</button>
        <button class="btn btn-outline btn-sm" onclick="contarFisico('${i.id}')" title="Registrar contagem física" style="font-size:11px;">📦</button>
      </td>
    </tr>`;
  }).join('');
}


function filterEstoque(){renderEstoque();}
function quickAdd(id){
  const item=state.estoque.find(i=>i.id===id);if(!item)return;
  const q=prompt(`Adicionar ao estoque de "${item.nome}" (atual: ${item.estoque} ${item.unidade}):`);
  const n=parseFloat(q);if(isNaN(n)||n<=0)return;
  item.estoque+=n;saveState();renderEstoque();updateDashboard();showNotif(`${item.nome}: +${n}!`,'success');
}
let _estModo = 'definir'; // 'definir' ou 'adicionar'

function setModoEstoque(modo){
  _estModo = modo;
  const btnDef = document.getElementById('est-btn-definir');
  const btnAdd = document.getElementById('est-btn-adicionar');
  const lbl    = document.getElementById('est-modo-label');
  if(modo==='definir'){
    btnDef.className='btn btn-primary btn-sm'; btnAdd.className='btn btn-outline btn-sm';
    lbl.textContent='Define o total exato que você tem agora na prateleira';
  } else {
    btnAdd.className='btn btn-primary btn-sm'; btnDef.className='btn btn-outline btn-sm';
    lbl.textContent='Adiciona ao estoque atual (ex: chegou mais mercadoria)';
  }
}

function abrirEdicaoEstoque(ingId){
  const ing = state.estoque.find(x=>x.id===ingId);
  if(!ing) return;
  document.getElementById('est-ingrediente').value = ingId;
  document.getElementById('est-nome-display').textContent = ing.nome + ' (' + ing.unidade + ')';
  document.getElementById('est-atual-display').textContent = ing.estoque + ' ' + ing.unidade;
  document.getElementById('est-preco').value = ing.preco_ref || '';
  document.getElementById('est-minimo').value = ing.minimo || '';
  document.getElementById('est-qtd').value = '';
  setModoEstoque('definir');
  openModal('modal-estoque');
}

function abrirModalEstoque(){
  if(!state.estoque.length){ showNotif('Nenhum ingrediente cadastrado. Vá em Configurações para adicionar.','error'); return; }
  // Mostrar seletor de ingrediente
  const opts = state.estoque.map(i=>`<option value="${i.id}">${i.nome} (${i.estoque} ${i.unidade})</option>`).join('');
  const sel = `<div style="position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:500;display:flex;align-items:center;justify-content:center;" id="sel-ing-overlay">
    <div style="background:var(--bg2);border-radius:12px;padding:20px;width:90%;max-width:380px;">
      <h3 style="margin-bottom:12px;">📦 Qual ingrediente?</h3>
      <select id="sel-ing-pick" style="width:100%;background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:10px;border-radius:8px;font-size:14px;outline:none;margin-bottom:12px;">${opts}</select>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-outline" style="flex:1;" onclick="document.getElementById('sel-ing-overlay').remove()">Cancelar</button>
        <button class="btn btn-primary" style="flex:1;" onclick="const v=document.getElementById('sel-ing-pick').value;document.getElementById('sel-ing-overlay').remove();abrirEdicaoEstoque(v);">Continuar ➜</button>
      </div>
    </div>
  </div>`;
  document.body.insertAdjacentHTML('beforeend', sel);
}

function atualizarEstoque(){
  const id=document.getElementById('est-ingrediente').value;
  const qtd=parseFloat(document.getElementById('est-qtd').value);
  const preco=parseFloat(document.getElementById('est-preco').value)||0;
  const minimo=parseFloat(document.getElementById('est-minimo').value)||0;
  if(!id||isNaN(qtd)||qtd<0){showNotif('Preencha a quantidade','error');return;}
  const item=state.estoque.find(i=>i.id===id);
  if(!item){showNotif('Ingrediente não encontrado','error');return;}
  if(_estModo==='definir'){
    item.estoque = qtd;
    // Resetar contagem física ao definir novo valor
    delete item.fisico;
  } else {
    item.estoque = Math.round((item.estoque + qtd)*1000)/1000;
  }
  if(preco>0) item.preco_ref = preco;
  if(minimo>0) item.minimo = minimo;
  document.getElementById('est-qtd').value='';
  saveState();renderEstoque();updateDashboard();renderCardapio();
  closeModal('modal-estoque');
  showNotif(`✅ ${item.nome}: ${item.estoque} ${item.unidade}`,'success');closeModal('modal-estoque');showNotif('Estoque atualizado!','success');
}

// ═══════════════════════════════
// ENTRADAS + ALERTAS
// ═══════════════════════════════
function renderAlertasEntradas(){
  const criticos=state.estoque.filter(i=>i.estoque<=i.minimo);
  const banner=document.getElementById('alertas-estoque-banner');
  if(criticos.length){
    banner.style.display='block';
    banner.innerHTML='⚠️ <strong>Mercadorias para repor:</strong> '+criticos.map(i=>`${i.nome} (${i.estoque}/${i.minimo} ${i.unidade})`).join(' · ');
  }else{banner.style.display='none';}
}
function renderEntradas(){
  const tb=document.getElementById('entradas-tbody');
  if(!state.entradas.length){tb.innerHTML='<tr><td colspan="6" class="empty-state">Nenhuma entrada</td></tr>';return;}
  tb.innerHTML=[...state.entradas].reverse().map(e=>`<tr><td>${fmtDT(e.data)}</td><td>${e.ingrediente}</td><td>${e.qtd} ${e.unidade}</td><td>${fmtM(e.preco)}</td><td style="color:var(--danger);font-weight:600;">${fmtM(e.total)}</td><td style="color:var(--text3);">${e.fornecedor||'—'}</td></tr>`).join('');
}
function registrarEntrada(){
  const id=document.getElementById('ent-ingrediente').value;
  const qtd=parseFloat(document.getElementById('ent-qtd').value);
  const preco=parseFloat(document.getElementById('ent-preco').value);
  const forn=document.getElementById('ent-fornecedor').value;
  if(!id||isNaN(qtd)||qtd<=0||isNaN(preco)||preco<=0){showNotif('Preencha todos os campos','error');return;}
  const item=state.estoque.find(i=>i.id===id);const total=qtd*preco;
  state.entradas.push({id:Date.now(),data:new Date().toISOString(),ingrediente:item.nome,unidade:item.unidade,qtd,preco,total,fornecedor:forn});
  item.estoque+=qtd;
  state.caixa.push({id:Date.now()+1,data:new Date().toISOString(),tipo:'saida',descricao:`Compra: ${item.nome}`,valor:total,pagamento:'dinheiro',canal:'compra'});
  ['ent-qtd','ent-preco','ent-fornecedor'].forEach(i=>document.getElementById(i).value='');
  saveState();renderEntradas();renderEstoque();renderCaixa();updateDashboard();closeModal('modal-entrada');renderAlertasEntradas();
  showNotif(`Compra registrada: ${item.nome}!`,'success');
}
function autoFillPreco(){
  const id=document.getElementById('ent-ingrediente').value;
  const item=state.estoque.find(i=>i.id===id);
  if(item)document.getElementById('ent-preco').value=item.preco_ref.toFixed(2);
}

// ═══════════════════════════════
// CAIXA
// ═══════════════════════════════
function calcSaldo(){return state.caixa.reduce((s,m)=>m.tipo==='entrada'?s+m.valor:s-m.valor,0);}
function filtrarCaixa(tipo,btn){
  caixaFiltro=tipo;
  document.querySelectorAll('.caixa-tab').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  renderCaixa();
}
function renderCaixa(){
  const ent=state.caixa.filter(m=>m.tipo==='entrada').reduce((s,m)=>s+m.valor,0);
  const sai=state.caixa.filter(m=>m.tipo==='saida').reduce((s,m)=>s+m.valor,0);
  document.getElementById('caixa-saldo').textContent=fmtM(ent-sai);
  document.getElementById('caixa-entradas').textContent=fmtM(ent);
  document.getElementById('caixa-saidas').textContent=fmtM(sai);
  document.getElementById('dash-caixa').textContent=fmtM(ent-sai);
  const hoje=todayISO();
  let items=state.caixa;
  if(caixaFiltro==='entrada')items=items.filter(m=>m.tipo==='entrada');
  else if(caixaFiltro==='saida')items=items.filter(m=>m.tipo==='saida');
  else if(caixaFiltro==='hoje')items=items.filter(m=>m.data.startsWith(hoje));
  const pL={dinheiro:'💵 Dinheiro',cartao_credito:'💳 Crédito',cartao_debito:'💳 Débito',vale_refeicao:'🍽️ V.Refeição',vale_alimentacao:'🛒 V.Alimentação',pix:'📱 Pix',ifood:'🔴 iFood',compra:'🛒 Compra','-':'-'};
  const tb=document.getElementById('caixa-tbody');
  if(!items.length){tb.innerHTML='<tr><td colspan="6" class="empty-state">Nenhum movimento</td></tr>';return;}
  tb.innerHTML=[...items].reverse().map(m=>`<tr>
    <td>${fmtDT(m.data)}</td>
    <td><span class="badge ${m.tipo==='entrada'?'badge-green':'badge-red'}">${m.tipo==='entrada'?'📥 Entrada':'📤 Saída'}</span></td>
    <td style="font-size:12px;">${m.descricao}</td>
    <td>${canalLabel(m.canal||'-')}</td>
    <td style="color:${m.tipo==='entrada'?'var(--success)':'var(--danger)'};font-weight:600;">${m.tipo==='entrada'?'+':'-'} ${fmtM(m.valor)}</td>
    <td style="color:var(--text3);font-size:12px;">${pL[m.pagamento]||m.pagamento}</td>
  </tr>`).join('');
}
function registrarSangria(){
  const v=parseFloat(document.getElementById('sangria-valor').value);const m=document.getElementById('sangria-motivo').value||'Sangria';
  if(isNaN(v)||v<=0){showNotif('Informe o valor','error');return;}
  state.caixa.push({id:Date.now(),data:new Date().toISOString(),tipo:'saida',descricao:'Sangria: '+m,valor:v,pagamento:'-',canal:'-'});
  document.getElementById('sangria-valor').value='';document.getElementById('sangria-motivo').value='';
  saveState();renderCaixa();updateDashboard();closeModal('modal-sangria');showNotif(`Sangria de ${fmtM(v)}`,'success');
}
function registrarReforco(){
  const v=parseFloat(document.getElementById('reforco-valor').value);const o=document.getElementById('reforco-origem').value||'Reforço';
  if(isNaN(v)||v<=0){showNotif('Informe o valor','error');return;}
  state.caixa.push({id:Date.now(),data:new Date().toISOString(),tipo:'entrada',descricao:'Reforço: '+o,valor:v,pagamento:'-',canal:'-'});
  document.getElementById('reforco-valor').value='';document.getElementById('reforco-origem').value='';
  saveState();renderCaixa();updateDashboard();closeModal('modal-reforco');showNotif(`Reforço de ${fmtM(v)}`,'success');
}

// ═══════════════════════════════
// RELATÓRIOS
// ═══════════════════════════════
function gerarRelatorio(){
  const per=document.getElementById('rel-periodo').value;
  const hoje=new Date();hoje.setHours(0,0,0,0);
  const fil=v=>{const d=new Date(v.data);if(per==='hoje'){const h=new Date(d);h.setHours(0,0,0,0);return h.getTime()===hoje.getTime();}if(per==='semana'){const s=new Date(hoje);s.setDate(s.getDate()-7);return d>=s;}if(per==='mes'){const m=new Date(hoje);m.setDate(1);return d>=m;}return true;};
  const vendas=state.vendas.filter(fil);
  const totV=vendas.reduce((s,v)=>s+v.total,0);const totC=vendas.reduce((s,v)=>s+v.custo,0);const lucro=totV-totC;
  const margem=totV>0?(lucro/totV*100).toFixed(1):0;const ticket=vendas.length?totV/vendas.length:0;
  document.getElementById('rel-cards').innerHTML=`
    <div class="stat-card gold"><div class="stat-label">Total Vendas</div><div class="stat-value gold">${fmtM(totV)}</div><div class="stat-sub">${vendas.length} pedido(s)</div></div>
    <div class="stat-card green"><div class="stat-label">Lucro Est.</div><div class="stat-value green">${fmtM(lucro)}</div><div class="stat-sub">Margem: ${margem}%</div></div>
    <div class="stat-card blue"><div class="stat-label">Ticket Médio</div><div class="stat-value">${fmtM(ticket)}</div></div>
    <div class="stat-card ifood"><div class="stat-label">iFood</div><div class="stat-value ifood">${fmtM(vendas.filter(v=>v.canal==='ifood').reduce((s,v)=>s+v.total,0))}</div><div class="stat-sub">${vendas.filter(v=>v.canal==='ifood').length} pedidos</div></div>`;
  const canais={balcao:{n:'🏪 Balcão',tot:0,qtd:0},delivery:{n:'🛵 Delivery',tot:0,qtd:0},ifood:{n:'🔴 iFood',tot:0,qtd:0}};
  vendas.forEach(v=>{if(canais[v.canal]){canais[v.canal].tot+=v.total;canais[v.canal].qtd++;}});
  const totCan=Object.values(canais).reduce((s,c)=>s+c.tot,0);
  const coresCan={balcao:'#C8923A',delivery:'#E8832A',ifood:'#EA1D2C'};
  const ec=document.getElementById('rel-canais');
  if(!totCan)ec.innerHTML='<p class="empty-state">Sem dados</p>';
  else ec.innerHTML='<div class="chart-bar-container">'+Object.entries(canais).map(([k,c])=>`<div class="chart-bar-row"><div class="chart-bar-label">${c.n}</div><div class="chart-bar-track"><div class="chart-bar-fill" style="width:${totCan?(c.tot/totCan*100).toFixed(0):0}%;background:${coresCan[k]};color:#0F0D0A;">${c.qtd}x</div></div><div class="chart-bar-val">${fmtM(c.tot)}</div></div>`).join('')+'</div>';
  const pags={};vendas.forEach(v=>{pags[v.pagamento]=(pags[v.pagamento]||0)+v.total;});
  const totP=Object.values(pags).reduce((s,v)=>s+v,0);
  const pL={dinheiro:'💵 Dinheiro',cartao_credito:'💳 Crédito',cartao_debito:'💳 Débito',vale_refeicao:'🍽️ V.Refeição',vale_alimentacao:'🛒 V.Alimentação',pix:'📱 Pix',ifood:'🔴 iFood'};
  const pc={dinheiro:'#5C9E6A',cartao_credito:'#4A7FA5',cartao_debito:'#9C7AB5',pix:'#C8923A',ifood:'#EA1D2C',vale_refeicao:'#6B8F71',vale_alimentacao:'#8FA8C8'};
  const ep=document.getElementById('rel-pagamentos');
  if(!totP)ep.innerHTML='<p class="empty-state">Sem dados</p>';
  else ep.innerHTML='<div class="chart-bar-container">'+Object.entries(pags).sort((a,b)=>b[1]-a[1]).map(([p,v])=>`<div class="chart-bar-row"><div class="chart-bar-label">${pL[p]||p}</div><div class="chart-bar-track"><div class="chart-bar-fill" style="width:${(v/totP*100).toFixed(0)}%;background:${pc[p]||'#C8923A'};color:#0F0D0A;">${(v/totP*100).toFixed(0)}%</div></div><div class="chart-bar-val">${fmtM(v)}</div></div>`).join('')+'</div>';
  const cnt={};vendas.forEach(v=>v.itens.forEach(i=>{if(!cnt[i.nome])cnt[i.nome]={qtd:0,tot:0};cnt[i.nome].qtd+=i.qty;cnt[i.nome].tot+=i.preco*i.qty;}));
  const srt=Object.entries(cnt).sort((a,b)=>b[1].qtd-a[1].qtd).slice(0,10);
  const er=document.getElementById('rel-ranking');
  if(!srt.length)er.innerHTML='<p class="empty-state">Sem dados</p>';
  else{const mx=srt[0][1].qtd;const cores=['#C8923A','#E8B96A','#5C9E6A','#4A7FA5','#9C7AB5','#C05050','#6B8F71','#8FA8C8','#C8A45A','#7A9CC8'];
  er.innerHTML='<div class="chart-bar-container">'+srt.map(([n,d],i)=>`<div class="chart-bar-row"><div class="chart-bar-label" title="${n}">${n}</div><div class="chart-bar-track"><div class="chart-bar-fill" style="width:${(d.qtd/mx*100).toFixed(0)}%;background:${cores[i%10]};color:#0F0D0A;">${d.qtd}x</div></div><div class="chart-bar-val">${fmtM(d.tot)}</div></div>`).join('')+'</div>';}

  // iFood por loja
  const lojas = {
    grasi: {nome:'Point do Pastel (Grasi)', fat:0, liquido:0, custoLoja:0, qtd:0},
    vi:    {nome:'Point do Pastel (Vi)',    fat:0, liquido:0, custoLoja:0, qtd:0},
    acai:  {nome:'Açaí das 3 Irmãs',       fat:0, liquido:0, custoLoja:0, qtd:0},
  };
  vendas.filter(v=>v.canal==='ifood').forEach(v=>{
    const l = lojas[v.ifoodLoja||'grasi'];
    if(!l) return;
    l.fat    += v.subtotal||v.total;
    l.liquido+= (v.subtotal||v.total) - (v.custoIfoodLoja||0);
    l.custoLoja += v.custoIfoodLoja||0;
    l.qtd++;
  });
  const elLojas = document.getElementById('rel-ifood-lojas');
  if(!elLojas) return;
  const lojaEntries = Object.values(lojas);
  if(!lojaEntries.some(l=>l.qtd>0)){ elLojas.innerHTML='<p class="empty-state">Nenhum pedido iFood no período</p>'; }
  else {
    elLojas.innerHTML = '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;">' +
    lojaEntries.map(l=>{
      const mensalidade = l.fat >= 1000 ? 120 : 0;
      const liquido_final = l.liquido - mensalidade;
      return `<div class="stat-card" style="border-color:rgba(234,29,44,0.3);">
        <div class="stat-label" style="color:var(--ifood);">${l.nome}</div>
        <div style="font-size:13px;color:var(--text);margin-bottom:2px;">${l.qtd} pedido(s)</div>
        <div style="font-size:12px;color:var(--text2);">Faturado: <strong style="color:var(--gold);">${fmtM(l.fat)}</strong></div>
        <div style="font-size:12px;color:var(--text2);">(-) Custos loja: <strong style="color:var(--danger);">${fmtM(l.custoLoja)}</strong></div>
        ${mensalidade>0?`<div style="font-size:12px;color:var(--danger);">(-) Mensalidade: <strong>R$ 120,00</strong></div>`:''}
        <div style="font-size:13px;font-weight:700;color:var(--success);border-top:1px solid var(--border);padding-top:6px;margin-top:6px;">Líquido: ${fmtM(liquido_final)}</div>
        ${l.fat>=900&&l.fat<1000?`<div style="font-size:10px;color:var(--gold);margin-top:3px;">⚠️ Faltam ${fmtM(1000-l.fat)} para mensalidade</div>`:''}
      </div>`;
    }).join('') + '</div>';
  }
}

// ═══════════════════════════════
// CARDÁPIO — com edição de preço/custo
// ═══════════════════════════════
function renderCardapioTabs(){document.getElementById('cardapio-tabs').innerHTML=Object.keys(CATEGORIAS).map(c=>`<button class="tab-btn ${c===cardapioCat?'active':''}" onclick="setCardapioCat('${c}')">${c}</button>`).join('');}
function setCardapioCat(c){cardapioCat=c;renderCardapioTabs();renderCardapio();}
function renderCardapio(){
  const cats=getCategorias();
  const prods=cats[cardapioCat]||[];
  document.getElementById('cardapio-tbody').innerHTML=prods.map(p=>{
    const custoReal = calcCustoProduto(p.id);
    const temReceita = (state.receitas[p.id]||[]).length > 0;
    const custoExibir = custoReal; // sempre usa custo calculado
    const l=p.preco-custoExibir;
    const m=p.preco>0?(l/p.preco*100).toFixed(1):0;
    let cls='badge-green';if(parseFloat(m)<50)cls='badge-red';else if(parseFloat(m)<65)cls='badge-gold';
    const rec=state.receitas[p.id]||[];
    const temEst=temEstoque(p);
    const estLabel=p.estoque_unit!==undefined&&p.estoque_unit!==null
      ? `<span style="font-size:11px;${temEst?'color:var(--success)':'color:var(--danger);font-weight:600;'};">${p.estoque_unit} un</span>`
      : rec.length
        ? `<span style="font-size:11px;${temEst?'color:var(--success)':'color:var(--danger);font-weight:600;'};">${temEst?'✅':'⛔'} Receita</span>`
        : '<span style="font-size:11px;color:var(--text3);">—</span>';
    return `<tr><td><strong>${p.nome}</strong>${!temEst?'<span style="color:var(--danger);font-size:10px;margin-left:5px;">⛔ Sem estoque</span>':''}</td><td style="color:var(--gold);font-weight:600;">${fmtM(p.preco)}</td><td style="color:var(--danger);">${fmtM(custoExibir)}${temReceita?'<span title="Calculado por receita" style="font-size:9px;color:var(--text3);margin-left:3px;">🧾</span>':'<span title="Custo manual" style="font-size:9px;color:var(--text3);margin-left:3px;">✏️</span>'}</td><td><span class="badge ${cls}">${m}%</span></td><td>${estLabel}</td><td><button class="btn btn-outline btn-sm" onclick="abrirEditarProduto('${p.id}','${cardapioCat}')" title="Editar">✏️</button>
        <button class="btn btn-outline btn-sm" onclick="abrirReceita('${p.id}','${cardapioCat}')" title="Receita" style="font-size:11px;">🧾</button>
        <button class="btn btn-danger btn-sm" onclick="excluirProduto('${p.id}','${cardapioCat}')" title="Excluir">🗑️</button></td></tr>`;
  }).join('');
}
function abrirEdicaoProduto(prodId,cat){
  const prods=CATEGORIAS[cat]||[];const p=prods.find(x=>x.id===prodId);if(!p)return;
  document.getElementById('edit-prod-id').value=prodId;
  document.getElementById('edit-prod-cat').value=cat;
  document.getElementById('edit-prod-nome-label').textContent=p.nome;
  document.getElementById('edit-prod-preco').value=p.preco;
  document.getElementById('edit-prod-custo').value=p.custo;
  openModal('modal-editar-produto');
}
function salvarEdicaoProduto(){
  const id=document.getElementById('edit-prod-id').value;
  const cat=document.getElementById('edit-prod-cat').value;
  const preco=parseFloat(document.getElementById('edit-prod-preco').value);
  const custo=parseFloat(document.getElementById('edit-prod-custo').value);
  if(isNaN(preco)||isNaN(custo)||preco<=0){showNotif('Valores inválidos','error');return;}
  const p=CATEGORIAS[cat]?.find(x=>x.id===id);
  if(p){p.preco=preco;p.custo=custo;}
  saveState();renderCardapio();closeModal('modal-editar-produto');showNotif('Produto atualizado!','success');
}

// ═══════════════════════════════
// MODALS
// ═══════════════════════════════
function openModal(id){
  if(id==='modal-estoque'||id==='modal-entrada'){
    const sid=id==='modal-estoque'?'est-ingrediente':'ent-ingrediente';
    document.getElementById(sid).innerHTML=state.estoque.map(i=>`<option value="${i.id}">${i.nome} (${i.unidade})</option>`).join('');
    if(id==='modal-entrada')autoFillPreco();
  }
  document.getElementById(id).classList.add('open');
}
function closeModal(id){document.getElementById(id).classList.remove('open');}






// ═══════════════════════════════
// CONTAGEM FÍSICA DE ESTOQUE
// ═══════════════════════════════

function contarFisico(ingId){
  const ing = state.estoque.find(x=>x.id===ingId);
  if(!ing) return;
  const val = prompt(`📦 Contagem física de "${ing.nome}"
Sistema: ${ing.estoque} ${ing.unidade}

Digite o que você tem na prateleira agora (${ing.unidade}):`);
  if(val===null) return;
  const num = parseFloat(val.replace(',','.'));
  if(isNaN(num)||num<0){showNotif('Valor inválido','error');return;}
  ing.fisico = num;
  const diff = Math.round((num - ing.estoque)*1000)/1000;
  saveState();
  renderEstoque();
  if(diff < -0.001){
    showNotif(`⚠️ Divergência! Sistema: ${ing.estoque} / Físico: ${num} / Diferença: ${diff} ${ing.unidade}`, 'error');
  } else if(diff > 0.001){
    showNotif(`🟡 Físico maior que sistema: +${diff} ${ing.unidade}`, 'info');
  } else {
    showNotif(`✅ Estoque conferido: ${ing.nome}`, 'success');
  }
}

function resetFisico(ingId){
  const ing = state.estoque.find(x=>x.id===ingId);
  if(!ing) return;
  delete ing.fisico;
  saveState();
  renderEstoque();
}

// ═══════════════════════════════
// RESUMO CUSTOS NA TELA DE VENDA
// ═══════════════════════════════

function calcCustoCarrinho(){
  return carrinho.reduce((s,item)=> s + calcCustoProduto(item.id) * item.qty, 0);
}

// ═══════════════════════════════
// CUSTO REAL POR RECEITA
// ═══════════════════════════════

// Retorna custo real calculado pelos ingredientes da receita
// Se não tiver receita, usa custo manual do produto
function calcCustoProduto(prodId, catHint){
  const rec = state.receitas[prodId];
  if(rec && rec.length){
    return rec.reduce((total, r)=>{
      const ing = state.estoque.find(x=>x.id===r.ingId);
      if(!ing) return total;
      return total + (ing.preco_ref||0) * r.qty;
    }, 0);
  }
  // Fallback: custo manual
  const cats = getCategorias();
  for(const prods of Object.values(cats)){
    const p = prods.find(x=>x.id===prodId);
    if(p) return p.custo||0;
  }
  return 0;
}

// Calcula custo real de uma venda completa
function calcCustoVenda(venda){
  let custo = 0;
  // Custo dos ingredientes por produto
  (venda.itens||[]).forEach(item=>{
    custo += calcCustoProduto(item.id) * item.qty;
  });
  // Custo motoboy (delivery/ifood)
  custo += venda.taxaMotoboy||0;
  // Taxas iFood
  if(venda.canal==='ifood'){
    const sub = venda.subtotal||venda.total;
    custo += Math.round(sub * 0.12 * 100)/100; // 12% sempre
    if((venda.ifoodPagto||venda.pagamento)==='online'){
      custo += Math.round(sub * 0.035 * 100)/100; // +3,5% online
    }
    // Custos de promoção loja
    custo += venda.custoIfoodLoja||0;
  }
  return Math.round(custo*100)/100;
}

// Lucro real de uma venda
function calcLucroVenda(venda){
  return Math.round((venda.total - calcCustoVenda(venda))*100)/100;
}

// ═══════════════════════════════
// GESTÃO DO CARDÁPIO
// ═══════════════════════════════

function getCategorias(){
  // Retorna todas categorias (base + extras do state)
  const cats = {...CATEGORIAS};
  Object.entries(state.cardapio_extra).forEach(([cat,prods])=>{
    if(!cats[cat]) cats[cat]=[];
    // Mescla produtos extras
    prods.forEach(ep=>{
      if(!cats[cat].find(p=>p.id===ep.id)) cats[cat].push(ep);
    });
  });
  return cats;
}

function popularSelectCategorias(selId, valorAtual){
  const sel = document.getElementById(selId);
  if(!sel) return;
  const cats = Object.keys(getCategorias());
  sel.innerHTML = cats.map(c=>`<option value="${c}" ${c===valorAtual?'selected':''}>${c}</option>`).join('');
}

function salvarNovaCategoria(){
  const nome = document.getElementById('nova-cat-nome').value.trim();
  if(!nome){showNotif('Digite o nome da categoria','error');return;}
  if(getCategorias()[nome]){showNotif('Categoria já existe!','error');return;}
  if(!state.cardapio_extra[nome]) state.cardapio_extra[nome]=[];
  saveState();
  renderCardapioTabs();renderCardapio();
  closeModal('modal-nova-categoria');
  document.getElementById('nova-cat-nome').value='';
  showNotif(`Categoria "${nome}" criada!`,'success');
}

function abrirNovoProduto(){
  document.getElementById('modal-prod-title').textContent='➕ Novo Produto';
  document.getElementById('prod-edit-id').value='';
  document.getElementById('prod-nome').value='';
  document.getElementById('prod-preco').value='';
  document.getElementById('prod-custo').value='';
  document.getElementById('prod-estoque').value='';
  popularSelectCategorias('prod-categoria', cardapioCat);
  openModal('modal-novo-produto');
}

function abrirEditarProduto(prodId, cat){
  const cats = getCategorias();
  const prod = cats[cat]?.find(p=>p.id===prodId);
  if(!prod) return;
  document.getElementById('modal-prod-title').textContent='✏️ Editar Produto';
  document.getElementById('prod-edit-id').value=prodId+'|'+cat;
  document.getElementById('prod-nome').value=prod.nome;
  document.getElementById('prod-preco').value=prod.preco;
  document.getElementById('prod-custo').value=prod.custo;
  document.getElementById('prod-estoque').value=prod.estoque_unit||'';
  popularSelectCategorias('prod-categoria', cat);
  openModal('modal-novo-produto');
}

function salvarProduto(){
  const nome   = document.getElementById('prod-nome').value.trim();
  const cat    = document.getElementById('prod-categoria').value;
  const preco  = parseFloat(document.getElementById('prod-preco').value);
  const custo  = parseFloat(document.getElementById('prod-custo').value)||0;
  const estUnit= parseFloat(document.getElementById('prod-estoque').value)||null;
  if(!nome||!cat||isNaN(preco)||preco<=0){showNotif('Preencha nome, categoria e preço','error');return;}

  const editId = document.getElementById('prod-edit-id').value;

  if(editId){
    // Editar produto existente
    const [prodId, oldCat] = editId.split('|');
    // Atualizar em CATEGORIAS base
    if(CATEGORIAS[oldCat]){
      const p=CATEGORIAS[oldCat].find(x=>x.id===prodId);
      if(p){p.nome=nome;p.preco=preco;p.custo=custo;if(estUnit!==null)p.estoque_unit=estUnit;}
    }
    // Atualizar em cardapio_extra
    if(state.cardapio_extra[oldCat]){
      const p=state.cardapio_extra[oldCat].find(x=>x.id===prodId);
      if(p){p.nome=nome;p.preco=preco;p.custo=custo;if(estUnit!==null)p.estoque_unit=estUnit;}
    }
    // Se mudou de categoria
    if(oldCat !== cat){
      // Remove da categoria antiga
      if(CATEGORIAS[oldCat]) CATEGORIAS[oldCat]=CATEGORIAS[oldCat].filter(x=>x.id!==prodId);
      if(state.cardapio_extra[oldCat]) state.cardapio_extra[oldCat]=state.cardapio_extra[oldCat].filter(x=>x.id!==prodId);
      // Adiciona na nova
      const novoProd={id:prodId,nome,preco,custo,estoque_unit:estUnit};
      if(!state.cardapio_extra[cat]) state.cardapio_extra[cat]=[];
      state.cardapio_extra[cat].push(novoProd);
    }
    showNotif(`"${nome}" atualizado!`,'success');
  } else {
    // Novo produto
    const newId = 'cx_'+Date.now();
    const novoProd={id:newId,nome,preco,custo};
    if(estUnit!==null) novoProd.estoque_unit=estUnit;
    if(!state.cardapio_extra[cat]) state.cardapio_extra[cat]=[];
    state.cardapio_extra[cat].push(novoProd);
    showNotif(`"${nome}" adicionado ao cardápio!`,'success');
  }
  saveState();
  renderCardapioTabs();renderCardapio();renderPdvProducts();
  closeModal('modal-novo-produto');
}

function excluirProduto(prodId, cat){
  if(!confirm('Excluir este produto do cardápio?')) return;
  // Remove de CATEGORIAS base
  if(CATEGORIAS[cat]) CATEGORIAS[cat]=CATEGORIAS[cat].filter(p=>p.id!==prodId);
  // Remove de cardapio_extra
  if(state.cardapio_extra[cat]) state.cardapio_extra[cat]=state.cardapio_extra[cat].filter(p=>p.id!==prodId);
  // Remove receita
  delete state.receitas[prodId];
  saveState();
  renderCardapioTabs();renderCardapio();renderPdvProducts();
  showNotif('Produto removido!','success');
}

// ═══════════════════════════════
// RECEITAS (INGREDIENTES POR PRODUTO)
// ═══════════════════════════════

function abrirReceita(prodId, cat){
  const cats = getCategorias();
  const prod = cats[cat]?.find(p=>p.id===prodId);
  if(!prod) return;
  document.getElementById('receita-prod-id').value = prodId;
  document.getElementById('receita-prod-nome').textContent = prod.nome;
  // Popular select de ingredientes
  const sel = document.getElementById('rec-ing-sel');
  sel.innerHTML='<option value="">— Selecionar —</option>'+
    state.estoque.map(i=>`<option value="${i.id}">${i.nome} (${i.unidade})</option>`).join('');
  renderReceitaLista(prodId);
  openModal('modal-receita');
}

function renderReceitaLista(prodId){
  const rec = state.receitas[prodId]||[];
  const el = document.getElementById('receita-ingredientes-lista');
  if(!rec.length){el.innerHTML='<p style="color:var(--text3);font-size:12px;">Nenhum ingrediente cadastrado ainda.</p>';return;}
  el.innerHTML=rec.map((r,i)=>{
    const ing = state.estoque.find(x=>x.id===r.ingId);
    return `<div style="display:flex;justify-content:space-between;align-items:center;padding:6px 10px;background:var(--bg3);border-radius:6px;margin-bottom:5px;font-size:13px;">
      <span>🧂 ${ing?ing.nome:'?'}</span>
      <span style="color:var(--gold);">${r.qty} ${ing?ing.unidade:''}</span>
      <button class="btn btn-danger btn-sm" onclick="removeIngReceita(${i})" style="padding:2px 8px;font-size:11px;">✕</button>
    </div>`;
  }).join('');
}

function addIngredienteReceita(){
  const prodId = document.getElementById('receita-prod-id').value;
  const ingId  = document.getElementById('rec-ing-sel').value;
  const qty    = parseFloat(document.getElementById('rec-ing-qty').value);
  if(!ingId||isNaN(qty)||qty<=0){showNotif('Selecione ingrediente e quantidade','error');return;}
  if(!state.receitas[prodId]) state.receitas[prodId]=[];
  // Remove se já existe esse ingrediente
  state.receitas[prodId]=state.receitas[prodId].filter(r=>r.ingId!==ingId);
  state.receitas[prodId].push({ingId,qty});
  document.getElementById('rec-ing-sel').value='';
  document.getElementById('rec-ing-qty').value='';
  renderReceitaLista(prodId);
}

function removeIngReceita(idx){
  const prodId = document.getElementById('receita-prod-id').value;
  state.receitas[prodId].splice(idx,1);
  renderReceitaLista(prodId);
}

function salvarReceita(){
  saveState();
  closeModal('modal-receita');
  showNotif('Receita salva!','success');
}

// Verifica se produto tem estoque de ingredientes suficiente
function temEstoque(prod){
  const rec = state.receitas[prod.id];
  if(!rec||!rec.length){
    // Sem receita: verifica estoque_unit direto
    if(prod.estoque_unit!==undefined && prod.estoque_unit!==null){
      return prod.estoque_unit > 0;
    }
    return true; // sem controle
  }
  return rec.every(r=>{
    const ing = state.estoque.find(x=>x.id===r.ingId);
    return ing && ing.estoque >= r.qty;
  });
}

// Abate ingredientes após venda
function abaterEstoque(itens){
  itens.forEach(item=>{
    const rec = state.receitas[item.id];
    if(rec&&rec.length){
      rec.forEach(r=>{
        const ing = state.estoque.find(x=>x.id===r.ingId);
        if(ing) ing.estoque = Math.max(0, ing.estoque - r.qty*item.qty);
      });
    }
    // Abater estoque_unit
    const cats = getCategorias();
    for(const prods of Object.values(cats)){
      const p = prods.find(x=>x.id===item.id);
      if(p&&p.estoque_unit!==undefined&&p.estoque_unit!==null){
        p.estoque_unit = Math.max(0, p.estoque_unit - item.qty);
        // Atualizar em cardapio_extra se for produto extra
        if(state.cardapio_extra){
          for(const ep of Object.values(state.cardapio_extra)){
            const ep2=ep.find(x=>x.id===item.id);
            if(ep2&&ep2.estoque_unit!==undefined) ep2.estoque_unit=p.estoque_unit;
          }
        }
      }
    }
  });
}

// ═══════════════════════════════
// FECHAMENTO SEMANAL IFOOD
// ═══════════════════════════════

function abrirFechamentoIfood(){
  // Preencher datas automaticamente com semana atual (seg-dom)
  const hoje = new Date();
  const diaSemana = hoje.getDay(); // 0=dom
  const diasAteDom = diaSemana === 0 ? 0 : 7 - diaSemana;
  const dom = new Date(hoje); dom.setDate(hoje.getDate() + diasAteDom);
  const seg = new Date(dom); seg.setDate(dom.getDate() - 6);
  document.getElementById('fif-inicio').value = seg.toISOString().split('T')[0];
  document.getElementById('fif-fim').value    = dom.toISOString().split('T')[0];
  document.getElementById('fif-resultado').innerHTML='<p style="color:var(--text3);font-size:12px;">Clique em Calcular para ver o fechamento.</p>';
  openModal('modal-fechamento-ifood');
}

function calcFechamentoIfood(){
  const ini = document.getElementById('fif-inicio').value;
  const fim = document.getElementById('fif-fim').value;
  if(!ini||!fim){showNotif('Selecione o período','error');return;}
  const iniD = new Date(ini+'T00:00:00');
  const fimD = new Date(fim+'T23:59:59');

  const vendasIfood = state.vendas.filter(v=>{
    const d=new Date(v.data);
    return v.canal==='ifood' && d>=iniD && d<=fimD;
  });

  const LOJAS = {
    grasi: 'Point do Pastel (Grasi)',
    vi:    'Point do Pastel (Vi)',
    acai:  'Açaí das 3 Irmãs',
  };

  let html='';
  let totalGeral=0, totalTaxa=0, totalLiquido=0;

  Object.entries(LOJAS).forEach(([key,nome])=>{
    const vendas = vendasIfood.filter(v=>(v.ifoodLoja||'grasi')===key);
    if(!vendas.length) return;

    let fatOnline=0, fatLoja=0;
    vendas.forEach(v=>{
      const sub=v.subtotal||v.total;
      if(v.ifoodPagto==='online') fatOnline+=sub;
      else fatLoja+=sub;
    });

    const fatTotal   = fatOnline + fatLoja;
    const taxa12     = Math.round(fatTotal*0.12*100)/100;
    const taxa35     = Math.round(fatOnline*0.035*100)/100;
    const taxaTotal  = taxa12 + taxa35;
    const liquido    = fatTotal - taxaTotal;
    const mensalidade= fatTotal>=1000 ? 120 : 0;
    const liquidoFinal = liquido - mensalidade;

    totalGeral  += fatTotal;
    totalTaxa   += taxaTotal+mensalidade;
    totalLiquido+= liquidoFinal;

    html+=`<div style="background:var(--bg3);border:1px solid rgba(234,29,44,0.2);border-radius:10px;padding:14px;margin-bottom:12px;">
      <div style="font-weight:700;color:var(--ifood);margin-bottom:8px;">🔴 ${nome}</div>
      <div style="font-size:13px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:3px;"><span>Vendas na loja</span><span>${fmtM(fatLoja)}</span></div>
        <div style="display:flex;justify-content:space-between;margin-bottom:3px;"><span>Vendas online</span><span>${fmtM(fatOnline)}</span></div>
        <div style="display:flex;justify-content:space-between;margin-bottom:3px;font-weight:600;border-top:1px solid var(--border);padding-top:3px;"><span>Total faturado</span><span style="color:var(--gold);">${fmtM(fatTotal)}</span></div>
        <div style="display:flex;justify-content:space-between;margin-bottom:3px;color:var(--danger);"><span>(-) Taxa 12% iFood</span><span>${fmtM(taxa12)}</span></div>
        ${taxa35>0?`<div style="display:flex;justify-content:space-between;margin-bottom:3px;color:var(--danger);"><span>(-) Taxa 3,5% online</span><span>${fmtM(taxa35)}</span></div>`:''}
        ${mensalidade>0?`<div style="display:flex;justify-content:space-between;margin-bottom:3px;color:var(--danger);"><span>(-) Mensalidade</span><span>R$ 120,00</span></div>`:''}
        <div style="display:flex;justify-content:space-between;font-size:15px;font-weight:700;color:var(--success);border-top:1px solid var(--border);padding-top:6px;margin-top:4px;"><span>= Líquido a receber</span><span>${fmtM(liquidoFinal)}</span></div>
        <div style="font-size:11px;color:var(--text3);margin-top:4px;">📅 Repasse previsto: quarta-feira após ${new Date(fim+'T00:00:00').toLocaleDateString('pt-BR')}</div>
        ${fatTotal>=900&&fatTotal<1000?`<div style="font-size:11px;color:var(--gold);margin-top:3px;">⚠️ Faltam ${fmtM(1000-fatTotal)} para cobrar mensalidade</div>`:''}
      </div>
    </div>`;
  });

  if(!html){
    document.getElementById('fif-resultado').innerHTML='<p class="empty-state">Nenhuma venda iFood no período selecionado.</p>';
    return;
  }

  // Totalizador geral
  html+=`<div style="background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:14px;">
    <div style="font-weight:700;color:var(--text);margin-bottom:8px;">📊 Total Geral</div>
    <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:3px;"><span>Total faturado</span><span style="color:var(--gold);font-weight:600;">${fmtM(totalGeral)}</span></div>
    <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:3px;color:var(--danger);"><span>(-) Total taxas</span><span>${fmtM(totalTaxa)}</span></div>
    <div style="display:flex;justify-content:space-between;font-size:16px;font-weight:700;color:var(--success);border-top:1px solid var(--border);padding-top:6px;margin-top:4px;"><span>= Total a receber</span><span>${fmtM(totalLiquido)}</span></div>
  </div>`;

  document.getElementById('fif-resultado').innerHTML=html;
}

function imprimirFechamentoIfood(){
  const conteudo = document.getElementById('fif-resultado').innerHTML;
  if(!conteudo||conteudo.includes('empty-state')){showNotif('Calcule o fechamento primeiro','error');return;}
  const ini=document.getElementById('fif-inicio').value;
  const fim=document.getElementById('fif-fim').value;
  const pw=window.open('','_blank','width=420,height=700');
  if(!pw){showNotif('Permita pop-ups','error');return;}
  pw.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Fechamento iFood</title>
  <style>body{font-family:sans-serif;font-size:13px;padding:16px;color:#000;max-width:380px;}
  h2{text-align:center;}hr{border:none;border-top:1px dashed #000;margin:8px 0;}
  @media print{@page{size:A4;margin:10mm;}}</style></head><body>
  <h2>🔴 Fechamento iFood</h2>
  <p style="text-align:center;font-size:12px;">${new Date(ini+'T00:00:00').toLocaleDateString('pt-BR')} a ${new Date(fim+'T00:00:00').toLocaleDateString('pt-BR')}</p>
  <hr>${conteudo}
  <script>window.onload=function(){setTimeout(function(){window.print();},500);};<\/script>
  </body></html>`);
  pw.document.close();
}

// ═══════════════════════════════
// IFOOD — CÁLCULO AO VIVO
// ═══════════════════════════════
function calcDescontoIfood(){
  if(canal!=='ifood') return;
  const sub = carrinho.reduce((s,i)=>s+i.preco*i.qty, 0);
  if(!sub){ document.getElementById('ifood-resumo').style.display='none'; return; }

  const pagto      = document.getElementById('ifood-pagamento').value;
  const taxaMb     = parseFloat(document.getElementById('ifood-taxa-motoboy').value||0);
  const descLoja5  = document.getElementById('ifd-desc-loja5').checked;
  const descIfood  = document.getElementById('ifd-desc-ifood').checked;
  const descMisto  = document.getElementById('ifd-desc-misto').checked;
  const freteIfood = document.getElementById('ifd-frete-ifood').checked;
  const freteLoja  = document.getElementById('ifd-frete-loja').checked;

  // Quanto a loja perde
  let descLoja = 0;
  if(descLoja5)  descLoja += 5;
  if(descMisto)  descLoja += 5; // loja paga os R$5 do misto

  // Taxa online (3,5% sobre valor do pedido)
  const taxaOnline = pagto==='online' ? Math.round(sub*0.035*100)/100 : 0;

  // Motoboy — só entra como custo da loja se freteLoja marcado
  // se freteIfood, iFood banca — não custa pra loja
  const mbLoja = freteLoja ? taxaMb : 0;

  const liquido = Math.max(0, sub - descLoja - taxaOnline - mbLoja);

  // Mostrar resumo
  const resumo = document.getElementById('ifood-resumo');
  resumo.style.display = 'block';
  document.getElementById('ifd-r-pedido').textContent   = fmtM(sub);
  document.getElementById('ifd-r-desc-loja').textContent = fmtM(descLoja);
  document.getElementById('ifd-r-desc-loja-row').style.display = descLoja>0 ? 'flex':'none';
  document.getElementById('ifd-r-taxa-online').textContent = fmtM(taxaOnline);
  document.getElementById('ifd-r-taxa-online-row').style.display = taxaOnline>0 ? 'flex':'none';
  document.getElementById('ifd-r-motoboy').textContent   = fmtM(mbLoja);
  document.getElementById('ifd-r-motoboy-row').style.display = mbLoja>0 ? 'flex':'none';
  document.getElementById('ifd-r-liquido').textContent   = fmtM(liquido);

  // Mostrar custo iFood no carrinho
  const custoTotal = descLoja + taxaOnline + mbLoja;
  const custoRow = document.getElementById('ifood-custo-row');
  if(custoRow){
    if(custoTotal > 0){
      custoRow.style.display = 'flex';
      document.getElementById('ifood-custo-val').textContent = '- ' + fmtM(custoTotal);
    } else {
      custoRow.style.display = 'none';
    }
  }
}

// ═══════════════════════════════
// CUPONS
// ═══════════════════════════════
function aplicarCupom(){
  const codigo=document.getElementById('cupom-input').value.trim().toUpperCase();
  const st=document.getElementById('cupom-status');
  if(!codigo){st.style.display='block';st.style.color='var(--danger)';st.textContent='❌ Digite um código de cupom';return;}
  const cup=state.cupons.find(x=>x.codigo===codigo);
  if(!cup){st.style.display='block';st.style.color='var(--danger)';st.textContent='❌ Cupom não encontrado';cupomAtivo=null;renderCart();return;}
  if(!cup.ativo){st.style.display='block';st.style.color='var(--danger)';st.textContent='❌ Cupom inativo ou já utilizado';cupomAtivo=null;renderCart();return;}
  // Check validade
  if(cup.validade){const hoje=new Date();hoje.setHours(0,0,0,0);const val=new Date(cup.validade+'T00:00:00');if(val<hoje){st.style.display='block';st.style.color='var(--danger)';st.textContent='❌ Cupom vencido em '+new Date(cup.validade+'T00:00:00').toLocaleDateString('pt-BR');cupomAtivo=null;renderCart();return;}}
  // Check usos
  if(cup.usosMax&&(cup.usosFeitos||0)>=cup.usosMax){st.style.display='block';st.style.color='var(--danger)';st.textContent='❌ Cupom atingiu o limite de usos';cupomAtivo=null;renderCart();return;}
  // Check valor mínimo
  const sub=carrinho.reduce((s,i)=>s+i.preco*i.qty,0);
  if(cup.minimo&&sub<cup.minimo){st.style.display='block';st.style.color='var(--danger)';st.textContent=`❌ Pedido mínimo de ${fmtM(cup.minimo)} para usar este cupom`;cupomAtivo=null;renderCart();return;}
  // Check cliente específico
  if(cup.clienteId&&canal==='delivery'){const cliSel=document.getElementById('delivery-cliente').value;if(cliSel&&cliSel!=cup.clienteId){st.style.display='block';st.style.color='var(--danger)';st.textContent='❌ Cupom exclusivo para outro cliente';cupomAtivo=null;renderCart();return;}}
  // Aplicar
  cupomAtivo=cup;
  let desc='';
  if(cup.tipo==='percentual')desc=cup.valor+'% de desconto';
  else if(cup.tipo==='fixo')desc='R$ '+cup.valor.toFixed(2)+' de desconto';
  else if(cup.tipo==='frete')desc='Frete grátis';
  st.style.display='block';st.style.color='var(--success)';st.textContent='✅ Cupom aplicado! '+desc;
  renderCart();
}

function renderCupons(){
  const ativos=state.cupons.filter(c=>c.ativo).length;
  const usados=state.cupons.filter(c=>!c.ativo&&c.usosFeitos>0).length;
  const totDesc=state.vendas.filter(v=>v.cupom).reduce((s,v)=>s+(v.desconto||0),0);
  document.getElementById('cup-total').textContent=state.cupons.length;
  document.getElementById('cup-ativos').textContent=ativos;
  document.getElementById('cup-usados').textContent=usados;
  document.getElementById('cup-desconto-total').textContent=fmtM(totDesc);
  const tb=document.getElementById('cupons-tbody');
  if(!state.cupons.length){tb.innerHTML='<tr><td colspan="8" class="empty-state">Nenhum cupom criado</td></tr>';return;}
  const tipoLabel={percentual:'%',fixo:'R$',frete:'Frete'};
  const cores={percentual:'badge-gold',fixo:'badge-green',frete:'badge-blue'};
  tb.innerHTML=[...state.cupons].reverse().map(cup=>{
    const cli=cup.clienteId?state.clientes.find(c=>c.id==cup.clienteId):null;
    const usos=cup.usosMax?`${cup.usosFeitos||0}/${cup.usosMax}`:''+(cup.usosFeitos||0)+'/∞';
    const val=cup.validade?new Date(cup.validade+'T00:00:00').toLocaleDateString('pt-BR'):'—';
    const vencido=cup.validade&&new Date(cup.validade+'T00:00:00')<new Date();
    const statusLabel=!cup.ativo?'<span class="badge badge-red">Inativo</span>':vencido?'<span class="badge badge-red">Vencido</span>':'<span class="badge badge-green">✅ Ativo</span>';
    const descLabel=cup.tipo==='frete'?'Frete Grátis':cup.tipo==='percentual'?cup.valor+'%':fmtM(cup.valor);
    return `<tr>
      <td><strong style="color:var(--gold);font-family:monospace;">${cup.codigo}</strong>${cup.obs?`<div style="font-size:10px;color:var(--text3);">${cup.obs}</div>`:''}</td>
      <td><span class="badge ${cores[cup.tipo]}">${tipoLabel[cup.tipo]}</span></td>
      <td style="font-weight:600;">${descLabel}${cup.minimo?`<div style="font-size:10px;color:var(--text3);">Mín: ${fmtM(cup.minimo)}</div>`:''}</td>
      <td style="font-size:12px;">${val}</td>
      <td style="font-size:12px;">${usos}</td>
      <td style="font-size:12px;color:var(--text3);">${cli?cli.nome:'Qualquer'}</td>
      <td>${statusLabel}</td>
      <td style="display:flex;gap:4px;flex-wrap:wrap;">
        ${cup.ativo?`<button class="btn btn-outline btn-sm" onclick="toggleCupom('${cup.codigo}',false)" style="font-size:10px;">🚫 Desativar</button>`:`<button class="btn btn-outline btn-sm" onclick="toggleCupom('${cup.codigo}',true)" style="font-size:10px;">✅ Ativar</button>`}
        <button class="btn btn-danger btn-sm" onclick="excluirCupom('${cup.codigo}')" style="font-size:10px;">🗑️</button>
      </td>
    </tr>`;
  }).join('');
}

function toggleCupomTipo(){
  const tipo=document.getElementById('cup-tipo').value;
  const wrap=document.getElementById('cup-valor-wrap');
  const lbl=document.getElementById('cup-valor-label');
  if(tipo==='frete'){wrap.style.display='none';}
  else{wrap.style.display='flex';lbl.textContent=tipo==='percentual'?'Desconto (%)':'Desconto (R$)';}
}

function salvarCupom(){
  const codigo=document.getElementById('cup-codigo').value.trim().toUpperCase();
  if(!codigo){showNotif('Digite o código do cupom','error');return;}
  if(state.cupons.find(c=>c.codigo===codigo)){showNotif('Já existe um cupom com este código!','error');return;}
  const tipo=document.getElementById('cup-tipo').value;
  const valor=tipo==='frete'?0:parseFloat(document.getElementById('cup-valor').value);
  if(tipo!=='frete'&&(isNaN(valor)||valor<=0)){showNotif('Informe o valor do desconto','error');return;}
  const usosMax=parseInt(document.getElementById('cup-usos').value)||null;
  const validade=document.getElementById('cup-validade').value||null;
  const minimo=parseFloat(document.getElementById('cup-minimo').value)||0;
  const clienteId=document.getElementById('cup-cliente').value||null;
  const obs=document.getElementById('cup-obs').value;
  state.cupons.push({codigo,tipo,valor,usosMax,usosFeitos:0,validade,minimo,clienteId,obs,ativo:true,criado:new Date().toISOString()});
  saveState();renderCupons();closeModal('modal-novo-cupom');
  // Reset form
  ['cup-codigo','cup-valor','cup-usos','cup-validade','cup-minimo','cup-obs'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('cup-cliente').value='';document.getElementById('cup-tipo').value='percentual';toggleCupomTipo();
  showNotif(`Cupom ${codigo} criado! 🏷️`,'success');
}

function toggleCupom(codigo,ativo){
  const cup=state.cupons.find(c=>c.codigo===codigo);if(!cup)return;
  cup.ativo=ativo;saveState();renderCupons();showNotif(ativo?`Cupom ${codigo} ativado!`:`Cupom ${codigo} desativado!`,'success');
}

function excluirCupom(codigo){
  if(!confirm(`Excluir o cupom "${codigo}"?`))return;
  state.cupons=state.cupons.filter(c=>c.codigo!==codigo);
  saveState();renderCupons();showNotif('Cupom excluído!','success');
}



// ═══════════════════════════════
// REIMPRESSÃO DE PEDIDO
// ═══════════════════════════════
function reimprimirPedido(vendaId){
  const venda = state.vendas.find(v=>v.id==vendaId) || state.pedidosDelivery.find(v=>v.id==vendaId);
  if(!venda){showNotif('Pedido não encontrado','error');return;}
  const agora = new Date().toLocaleString('pt-BR');
  const dtPedido = new Date(venda.data).toLocaleString('pt-BR');
  const canalNome = {balcao:'Balcão',delivery:'Delivery',ifood:'iFood'}[venda.canal]||venda.canal;
  const pL={dinheiro:'💵 Dinheiro',cartao_credito:'💳 Crédito',cartao_debito:'💳 Débito',vale_refeicao:'🍽️ V.Refeição',vale_alimentacao:'🛒 V.Alimentação',pix:'📱 Pix',ifood:'🔴 iFood'};
  let rows='';
  (venda.itens||[]).forEach(i=>{
    const adicsStr=i.adics&&i.adics.length?' (+'+i.adics.map(a=>a.nome).join(', ')+')':'';
    const detHtml=i.detalhe?`<br><span style='color:#555;font-size:10px;'>📋 ${i.detalhe}</span>`:'';
    const obsHtml=i.obs?`<br><span style='color:#555;font-size:10px;'>💬 ${i.obs}</span>`:'';
    rows+=`<tr>
      <td style="padding:4px 0;font-size:12px;vertical-align:top;">${i.nome}${adicsStr}${detHtml}${obsHtml}</td>
      <td style="text-align:center;width:28px;font-size:12px;vertical-align:top;">${i.qty}x</td>
      <td style="text-align:right;width:65px;font-size:12px;vertical-align:top;font-weight:600;">${fmtM(i.preco*i.qty)}</td>
    </tr>`;
  });
  const sub = venda.subtotal || venda.itens.reduce((s,i)=>s+i.preco*i.qty,0);
  const taxaDel = venda.taxaDelivery||0;
  const desconto = venda.desconto||0;
  const total = venda.total;
  const cli = venda.clienteId ? state.clientes.find(c=>c.id==venda.clienteId) : null;
  const pw = window.open('','_blank','width=380,height=750');
  if(!pw){showNotif('Permita pop-ups para imprimir!','error');return;}
  pw.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>2ª Via - Pedido</title>
  <style>
    *{box-sizing:border-box;}
    body{font-family:'Courier New',monospace;font-size:12px;margin:0;padding:10px;color:#000;max-width:300px;}
    h2{text-align:center;font-size:15px;margin:0 0 2px;font-family:sans-serif;}
    .centro{text-align:center;font-size:11px;color:#444;margin-bottom:6px;}
    .via{text-align:center;font-size:10px;color:#888;margin-bottom:4px;font-style:italic;}
    hr{border:none;border-top:1px dashed #000;margin:5px 0;}
    table{width:100%;border-collapse:collapse;}
    th{text-align:left;font-size:11px;border-bottom:1px solid #000;padding-bottom:3px;}
    th:nth-child(2){text-align:center;}th:nth-child(3){text-align:right;}
    td{font-size:12px;padding:3px 0;vertical-align:top;}
    td:nth-child(2){text-align:center;}td:nth-child(3){text-align:right;font-weight:bold;}
    .row{display:flex;justify-content:space-between;font-size:12px;margin:2px 0;}
    .total-row{display:flex;justify-content:space-between;font-size:14px;font-weight:bold;margin-top:3px;border-top:1px solid #000;padding-top:3px;}
    @media print{@page{size:80mm auto;margin:3mm;}body{max-width:100%;}}
  </style>
  </head><body>
  <h2>${config.nome||'POINT DO PASTEL'}</h2>
  <div class="via">— 2ª VIA —</div>
  <div class="centro">${config.tel||''}${config.endereco?'<br>'+config.endereco:''}<br>Emitida em: ${agora}</div>
  <hr>
  <div><b>PEDIDO:</b> ${dtPedido}</div>
  <div><b>CANAL:</b> ${canalNome}${venda.ifoodNumero?' — Nº '+venda.ifoodNumero:''}</div>
  ${venda.endereco?`<div><b>ENDEREÇO:</b> ${venda.endereco}</div>`:''}
  ${cli?`<div><b>CLIENTE:</b> ${cli.nome}</div>`:''}
  <hr>
  <table>
    <thead><tr><th>Item</th><th>Qtd</th><th>Vlr</th></tr></thead>
    <tbody>${rows}</tbody>
  </table>
  <hr>
  <div class="row"><span>Subtotal</span><span>${fmtM(sub)}</span></div>
  ${taxaDel>0?`<div class="row"><span>Taxa entrega</span><span>${fmtM(taxaDel)}</span></div>`:''}
  ${desconto>0?`<div class="row"><span>Desconto${venda.cupom?' ('+venda.cupom+')':''}</span><span>- ${fmtM(desconto)}</span></div>`:''}
  <div class="total-row"><span>TOTAL</span><span>${fmtM(total)}</span></div>
  <div style="font-size:12px;margin-top:5px;"><b>Pgto:</b> ${pL[venda.pagamento]||venda.pagamento}</div>
  ${venda.obs?`<div style="font-size:11px;margin-top:3px;"><b>Obs:</b> ${venda.obs}</div>`:''}
  <hr>
  <div style="text-align:center;font-size:11px;">Obrigado pela preferência! 🥟<br>PIX: ${config.pix}</div>
  <script>window.onload=function(){setTimeout(function(){window.print();},500);};<\/script>
  </body></html>`);
  pw.document.close();
}

// ═══════════════════════════════
// MOTOBOY
// ═══════════════════════════════
function setDeliveryTab(tab, btn){
  document.querySelectorAll('#page-delivery .tab-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('del-panel-pedidos').style.display = tab==='pedidos'?'block':'none';
  document.getElementById('del-panel-motoboy').style.display = tab==='motoboy'?'block':'none';
  if(tab==='motoboy') renderMotoboy();
}

function renderMotoboy(){
  const hoje = todayISO();
  const entregues = state.pedidosDelivery.filter(p=>p.data.startsWith(hoje) && p.status==='entregue');
  const taxaFixa = parseFloat(document.getElementById('mb-taxa-fixa')?.value||0);

  let totalRepasse = 0;
  const tb = document.getElementById('mb-tbody');
  if(!tb) return;

  if(!entregues.length){
    tb.innerHTML='<tr><td colspan="6" class="empty-state">Nenhuma entrega concluída hoje</td></tr>';
    document.getElementById('mb-total-entregas').textContent='0';
    document.getElementById('mb-valor-repasse').textContent='R$ 0,00';
    document.getElementById('mb-taxa-media').textContent='R$ 0,00';
    document.getElementById('mb-total-display').textContent='R$ 0,00';
    return;
  }

  tb.innerHTML = entregues.map(p=>{
    const taxa = taxaFixa > 0 ? taxaFixa : (p.taxaMotoboy || p.taxaDelivery || 0);
    totalRepasse += taxa;
    const cli = state.clientes.find(c=>c.id==p.clienteId);
    const itensStr = p.itens.map(i=>i.qty+'x '+i.nome.split(' ')[0]).join(', ').substring(0,30);
    return `<tr>
      <td>${fmtH(p.data)}</td>
      <td>${cli?cli.nome:(p.clienteId||'—')}</td>
      <td style="font-size:11px;color:var(--text3);max-width:110px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${p.endereco||'—'}</td>
      <td style="font-size:11px;color:var(--text3);">${itensStr}</td>
      <td style="color:var(--gold);font-weight:600;">${fmtM(taxa)}</td>
      <td style="color:var(--success);font-weight:600;">${fmtM(p.total)}</td>
    </tr>`;
  }).join('');

  const media = totalRepasse / entregues.length;
  document.getElementById('mb-total-entregas').textContent = entregues.length;
  document.getElementById('mb-valor-repasse').textContent = fmtM(totalRepasse);
  document.getElementById('mb-taxa-media').textContent = fmtM(media);
  document.getElementById('mb-total-display').textContent = fmtM(totalRepasse);
}

function imprimirFechamentoMotoboy(){
  const hoje = todayISO();
  const entregues = state.pedidosDelivery.filter(p=>p.data.startsWith(hoje) && p.status==='entregue');
  if(!entregues.length){showNotif('Nenhuma entrega concluída hoje','error');return;}
  const taxaFixa = parseFloat(document.getElementById('mb-taxa-fixa')?.value||0);
  const nomeMb = document.getElementById('mb-nome')?.value || 'Motoboy';
  let totalRepasse=0, rows='';
  entregues.forEach((p,i)=>{
    const taxa = taxaFixa>0 ? taxaFixa : (p.taxaMotoboy || p.taxaDelivery || 0);
    totalRepasse += taxa;
    const cli = state.clientes.find(c=>c.id==p.clienteId);
    rows+=`<tr>
      <td style="padding:3px 2px;font-size:11px;">${i+1}. ${cli?cli.nome:'—'}</td>
      <td style="font-size:11px;padding:3px 2px;">${p.endereco||'—'}</td>
      <td style="text-align:right;font-size:11px;padding:3px 2px;font-weight:600;">${fmtM(taxa)}</td>
    </tr>`;
  });
  const agora = new Date().toLocaleString('pt-BR');
  const pw = window.open('','_blank','width=380,height=700');
  if(!pw){showNotif('Permita pop-ups para imprimir!','error');return;}
  pw.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Fechamento Motoboy</title>
  <style>
    body{font-family:'Courier New',monospace;font-size:12px;margin:0;padding:10px;color:#000;max-width:300px;}
    h2{text-align:center;font-size:14px;margin:0 0 2px;}
    .centro{text-align:center;font-size:11px;color:#444;margin-bottom:5px;}
    hr{border:none;border-top:1px dashed #000;margin:5px 0;}
    table{width:100%;border-collapse:collapse;}
    .total{display:flex;justify-content:space-between;font-size:14px;font-weight:bold;border-top:2px solid #000;padding-top:4px;margin-top:4px;}
    @media print{@page{size:80mm auto;margin:3mm;}body{max-width:100%;}}
  </style>
  </head><body>
  <h2>FECHAMENTO MOTOBOY</h2>
  <div class="centro">${config.nome||'POINT DO PASTEL'}<br>${agora}</div>
  <hr>
  <div style="font-size:12px;margin-bottom:4px;"><b>Motoboy:</b> ${nomeMb}</div>
  <div style="font-size:12px;"><b>Data:</b> ${new Date().toLocaleDateString('pt-BR')}</div>
  <hr>
  <table>
    <thead><tr>
      <th style="text-align:left;font-size:11px;padding-bottom:3px;">Cliente</th>
      <th style="text-align:left;font-size:11px;">Endereço</th>
      <th style="text-align:right;font-size:11px;">Taxa</th>
    </tr></thead>
    <tbody>${rows}</tbody>
  </table>
  <hr>
  <div class="total"><span>TOTAL (${entregues.length} entregas)</span><span>${fmtM(totalRepasse)}</span></div>
  <div style="margin-top:16px;font-size:11px;">Assinatura: ________________________</div>
  <script>window.onload=function(){setTimeout(function(){window.print();},500);};<\/script>
  </body></html>`);
  pw.document.close();
}

// ═══════════════════════════════
// RESET DE DADOS
// ═══════════════════════════════
function resetarDados(){
  if(!confirm('⚠️ Isso vai apagar TODAS as vendas, caixa, entradas e pedidos de teste.\n\nClientes, estoque, cupons e configurações serão mantidos.\n\nConfirmar?'))return;
  state.vendas=[];
  state.entradas=[];
  state.caixa=[];
  state.pedidosDelivery=[];
  carrinho=[];
  cupomAtivo=null;
  saveState();
  if(firebaseOnline){
    fbSave('vendas',[]);fbSave('entradas',[]);fbSave('caixa',[]);fbSave('pedidosDelivery',[]);
  }
  updateDashboard();renderCaixa();renderEntradas();renderDelivery();renderCupons();renderCart();
  showNotif('Sistema restaurado! Dados de teste removidos. ✅','success');
}

// ═══════════════════════════════
// NOTIFICAÇÕES
// ═══════════════════════════════
let notifT;
function showNotif(msg,type='success'){
  const el=document.getElementById('notif');
  el.className='notif show '+type;
  el.innerHTML=(type==='success'?'✅ ':'❌ ')+msg;
  clearTimeout(notifT);notifT=setTimeout(()=>el.classList.remove('show'),3000);
}
</script>
</body>
</html>
